(()=>{"use strict";var e={4094:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ZOrderOperation=t.isRawSendXHRResponse=t.MermaidDiagramType=t.GetLLMContextType=t.GetItemsAtSearchType=t.GetDocumentChunksType=t.HashAlgorithmEnum=t.commandTitles=void 0;const n=i(8887);var o,r,a,s,l,c;t.commandTitles=new Map([["aci","AddCardIntegration"],["adfm","AddDiagramFromMermaid"],["adft","AddDiagramFromText"],["alta","AddLineTextArea"],["ami","AddMenuItem"],["asd","AddShapeData"],["asi","AddSpreadsheetIntegration"],["atc","AddTableColumn"],["atr","AddTableRow"],["a","Alert"],["av","AnimateViewport"],["adi","AwaitDataSourceImport"],["ai","AwaitImport"],["b","Bootstrap"],["ceps","CanEditPackageSettings"],["cdc","CancelDragBlockToCanvas"],["c","Confirm"],["cb","CreateBlock"],["cc","CreateCollection"],["cds","CreateDataSource"],["cde","CreateDocumentElement"],["cg","CreateGroup"],["cl","CreateLine"],["cp","CreatePage"],["die","DataItemExists"],["dde","DeleteDocumentElement"],["di","DeleteItem"],["dp","DeletePage"],["dsd","DeleteShapeData"],["dtc","DeleteTableColumn"],["dtr","DeleteTableRow"],["d","Download"],["dpm","DragPointerMove"],["dpu","DragPointerUp"],["dis","DuplicateItems"],["ee","ElementExists"],["ef","ExecuteFormula"],["fas","FindAvailableSpace"],["fbe","FireBeaconEvent"],["gcl","GetConnectedLines"],["gcp","GetCurrentPage"],["gcs","GetCustomShape"],["gdif","GetDataItemField"],["gdap","GetDocumentAccessPermission"],["gdc","GetDocumentChunks"],["gdid","GetDocumentId"],["get","GetElementType"],["gec","GetEnvironmentConfig"],["gip","GetItemPageId"],["gia","GetItemsAt"],["llm","GetLLMContextFromItems"],["goci","GetOAuthClientId"],["got","GetOAuthToken"],["gps","GetPackageSettings"],["gpr","GetProduct"],["gp","GetProperty"],["grk","GetReferenceKey"],["grlp","GetRelativeLinePosition"],["gs","GetSelection"],["gsd","GetShapeData"],["gsvg","GetSvg"],["gts","GetTextStyle"],["guid","GetUserId"],["gvr","GetVisibleRect"],["hm","HideModal"],["hp","HidePanel"],["hac","HookAllChanges"],["hci","HookCreateItems"],["hdi","HookDeleteItems"],["hs","HookSelection"],["hte","HookTextEdit"],["ic","ImportCards"],["il","ImportLinks"],["imp","ImportPage"],["k","KillExtension"],["lb","ListBlocks"],["lcf","ListCollectionFields"],["lc","ListCollections"],["ldi","ListDataItems"],["lds","ListDataSources"],["lde","ListDocumentElements"],["lg","ListGroups"],["ll","ListLines"],["lp","ListPages"],["lpr","ListProperties"],["lrk","ListReferenceKeys"],["lsd","ListShapeData"],["lta","ListTextAreas"],["lbc","LoadBlockClasses"],["log","LogForTestCase"],["mt","MeasureText"],["oi","OffsetItems"],["pdi","PatchDataItems"],["p","Prompt"],["rp","RegisterPanel"],["ru","RegisterUnfurl"],["r","ReloadExtension"],["aoauth","SendAsyncOAuthRequest"],["oauth","SendOAuthRequest"],["suim","SendUIMessage"],["xhr","SendXHR"],["scp","SetCurrentPage"],["sps","SetPackageSettings"],["sp","SetProperty"],["srk","SetReferenceKey"],["ss","SetSelection"],["ssd","SetShapeData"],["sts","SetTextStyle"],["sm","ShowModal"],["spsm","ShowPackageSettingsModal"],["spn","ShowPanel"],["sleep","SleepForTestCase"],["sdc","StartDragBlockToCanvas"],["pdf","StartPDFUploadRequest"],["throw","ThrowForTestCase"],["tauth","TriggerAuthFlow"],["uac","UnhookAllChanges"],["uci","UnhookCreateItems"],["udi","UnhookDeleteItems"],["us","UnhookSelection"],["ute","UnhookTextEdit"],["wm","WithMutex"],["wsa","WithSilentActions"],["z","ZOrder"]]),function(e){e.sha256="SHA256"}(o||(t.HashAlgorithmEnum=o={})),function(e){e[e.Geographic=0]="Geographic",e[e.Container=1]="Container"}(r||(t.GetDocumentChunksType=r={})),function(e){e[e.PossiblyOverlapping=0]="PossiblyOverlapping",e[e.Overlapping=1]="Overlapping",e[e.Contained=2]="Contained"}(a||(t.GetItemsAtSearchType=a={})),function(e){e[e.Relational=1]="Relational",e[e.PlainText=2]="PlainText",e[e.RelationalWithoutExpansion=3]="RelationalWithoutExpansion"}(s||(t.GetLLMContextType=s={})),function(e){e.FLOWCHART="flowchart",e.CLASS_DIAGRAM="class_diagram",e.ERD="erd"}(l||(t.MermaidDiagramType=l={})),t.isRawSendXHRResponse=function(e){return(0,n.isString)(e.url)&&(0,n.isString)(e.t)&&(0,n.isNumber)(e.s)&&(0,n.isObject)(e.h)},function(e){e[e.UP=1]="UP",e[e.TOP=2]="TOP",e[e.DOWN=3]="DOWN",e[e.BOTTOM=4]="BOTTOM"}(c||(t.ZOrderOperation=c={}))},8065:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.encodeBase64=t.decodeBase64=void 0;const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n=[];for(let e=0;e<65;e++)n[i.charCodeAt(e)]=e;t.decodeBase64=function(e){if((e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length%4!=0)throw new Error("Invalid base64 input; length must be a multiple of 4");let t=e.length/4*3;e.endsWith("==")?t-=2:e.endsWith("=")&&(t-=1);const i=new Uint8Array(t);let o=0;for(let r=0;r<t;r+=3){const t=n[e.charCodeAt(o++)],a=n[e.charCodeAt(o++)],s=n[e.charCodeAt(o++)],l=n[e.charCodeAt(o++)];if(void 0===t||void 0===a||void 0===s||void 0===l)throw new Error("char code to encoded int contains an undefined index");i[r]=t<<2|a>>4,64!=s&&(i[r+1]=(15&a)<<4|s>>2),64!=l&&(i[r+2]=(3&s)<<6|l)}return i},t.encodeBase64=function(e){const t=Math.floor(e.length/3),n=4*Math.ceil(e.length/3),o=new Array(n);let r=0,a=0;for(let n=0;n<t;n++){const t=e[r++],n=e[r++],s=e[r++];if(void 0===t||void 0===n||void 0===s)throw new Error("byteArray contains undefined indexes");const l=t>>2,c=(3&t)<<4|n>>4,d=(15&n)<<2|s>>6,u=63&s;o[a++]=i[l],o[a++]=i[c],o[a++]=i[d],o[a++]=i[u]}if(r<e.length){const t=e[r++],n=r<e.length,s=n?e[r++]:0,l=t>>2,c=(3&t)<<4|s>>4,d=n?(15&s)<<2:64;o[a++]=i[l],o[a++]=i[c],o[a++]=i[d],o[a++]="="}return o.join("")}},9730:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LucidCardFields=t.StatusValues=t.deserializeLucidCardFieldDisplaySettings=t.serializeLucidCardFieldDisplaySettings=t.isOnClickHandlerKey=t.OnClickHandlerKeys=t.isFieldDisplayType=t.FieldDisplayType=void 0;const n=i(2607);var o,r,a,s;!function(e){e.BasicTextBadge="BasicTextBadge",e.InitializedString="InitializedString",e.StandardEstimation="StandardEstimation",e.ImageBadge="ImageBadge",e.SquareImageBadge="SquareImageBadge",e.DateBadge="DateBadge",e.UserProfile="UserProfile"}(o||(t.FieldDisplayType=o={})),t.isFieldDisplayType=(0,n.enumValidator)(o),function(e){e.BasicEditPanel="BasicEditPanel",e.OpenBrowserWindow="OpenBrowserWindow",e.CustomEditAction="CustomEditAction"}(r||(t.OnClickHandlerKeys=r={})),t.isOnClickHandlerKey=(0,n.enumValidator)(r),t.serializeLucidCardFieldDisplaySettings=function(e){return{StencilConfig:e.stencilConfig&&{getterKey:e.stencilConfig.displayType,f:e.stencilConfig.valueFormula,t:e.stencilConfig.tooltipFormula,l:e.stencilConfig.linkFormula,fg:e.stencilConfig.foregroundColor,bg:e.stencilConfig.backgroundColor,h:e.stencilConfig.horizontalPosition,v:e.stencilConfig.verticalPosition,onClickHandlerKey:e.stencilConfig.onClickHandlerKey,imageBadgeSettings:e.stencilConfig.imageBadgeSettings,textBadgeSettings:e.stencilConfig.textBadgeSettings}}},t.deserializeLucidCardFieldDisplaySettings=function(e){return{stencilConfig:e.StencilConfig&&{displayType:e.StencilConfig.getterKey,valueFormula:e.StencilConfig.f,tooltipFormula:e.StencilConfig.t,linkFormula:e.StencilConfig.l,foregroundColor:e.StencilConfig.fg,backgroundColor:e.StencilConfig.bg,horizontalPosition:e.StencilConfig.h,verticalPosition:e.StencilConfig.v,onClickHandlerKey:e.StencilConfig.onClickHandlerKey,imageBadgeSettings:e.StencilConfig.imageBadgeSettings,textBadgeSettings:e.StencilConfig.textBadgeSettings}}},function(e){e.New="New",e.Todo="To Do",e.InProgress="In Progress",e.Done="Done",e.NotDoing="Not Doing",e.Blocked="Blocked"}(a||(t.StatusValues=a={})),function(e){e.Title="Title",e.Description="Description",e.Assignee="Assignee",e.Estimate="Estimate",e.Status="Status",e.StartTime="StartTime",e.EndTime="EndTime"}(s||(t.LucidCardFields=s={}))},2797:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeCardIntegrationConfig=t.serializeCardIntegrationConfig=void 0;const n=i(9730);t.serializeCardIntegrationConfig=function(e){return{cc:{f:e.cardConfig.fieldNames,fd:e.cardConfig.fieldDisplaySettings?[...e.cardConfig.fieldDisplaySettings].map((([e,t])=>[e,(0,n.serializeLucidCardFieldDisplaySettings)(t)])):void 0,fs:e.cardConfig.fieldStyles?[...e.cardConfig.fieldStyles]:void 0},cdpc:{f:e.cardDetailsPanelConfig.fields.map((e=>({n:e.name,l:e.locked})))}}},t.deserializeCardIntegrationConfig=function(e){return{cardConfig:{fieldNames:e.cc.f,fieldStyles:e.cc.fs?new Map(e.cc.fs):void 0,fieldDisplaySettings:e.cc.fd?new Map(e.cc.fd.map((([e,t])=>[e,(0,n.deserializeLucidCardFieldDisplaySettings)(t)]))):void 0},cardDetailsPanelConfig:{fields:e.cdpc.f.map((e=>({name:e.n,locked:e.l})))}}}},6805:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeCardFieldArrayDefinition=t.deserializeCardFieldDefinition=t.isSerializedExtensionCardFieldDefinition=t.isSerializedFieldOptions=t.isSerializedFieldOption=t.deserializeFieldOption=t.serializeCardFieldArrayDefinition=t.serializeCardFieldDefinition=t.serializeCardFieldOption=void 0;const n=i(3697),o=i(8887),r=i(3270),a=i(5043),s=i(1113),l=i(2607);function c(e){return{l:e.label,v:e.value,i:e.iconUrl}}function d(e){var t;return Object.assign(Object.assign({},(0,n.serializeFieldDefinition)(e)),{l:e.label,def:e.default,d:e.description,op:(0,o.isString)(e.options)?e.options:null===(t=e.options)||void 0===t?void 0:t.map(c),s:e.search})}function u(e){return{label:e.l,value:e.v,iconUrl:e.i}}function p(e){var t;return Object.assign(Object.assign({},(0,n.parseFieldDefinition)(e)),{label:e.l,description:e.d,default:e.def,options:(0,o.isString)(e.op)?e.op:null===(t=e.op)||void 0===t?void 0:t.map(u),search:e.s})}t.serializeCardFieldOption=c,t.serializeCardFieldDefinition=d,t.serializeCardFieldArrayDefinition=function(e){return e.map(d)},t.deserializeFieldOption=u,t.isSerializedFieldOption=(0,l.objectValidator)({l:o.isString,v:s.isSerializedFieldType,i:(0,l.option)(o.isString)}),t.isSerializedFieldOptions=(0,l.arrayValidator)(t.isSerializedFieldOption),t.isSerializedExtensionCardFieldDefinition=(0,l.objectValidator)({Name:o.isString,Type:r.isSerializedFieldTypeDefinition,Constraints:(0,l.option)((0,l.arrayValidator)(a.isSerializedFieldConstraint)),l:o.isString,d:(0,l.option)(o.isString),def:(0,l.option)(s.isSerializedFieldType),op:(0,l.option)((0,l.either)(o.isString,(0,l.arrayValidator)(t.isSerializedFieldOption))),s:(0,l.option)(o.isString)}),t.deserializeCardFieldDefinition=p,t.deserializeCardFieldArrayDefinition=function(e){return e.map(p)}},264:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LucidCardIntegration=void 0,t.LucidCardIntegration=class{constructor(e){this.client=e}showCardImport(e){return this.client.sendCommand("ic",e)}}},5585:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LucidCardIntegrationCustomImportModal=void 0;const n=i(3724);class o extends n.Modal{constructor(e,t,i){super(e,t),this.cardIntegrationLabel=i}createCards(e,t){return this.client.sendCommand("ca",{cid:this.cardIntegrationLabel,coid:e,pks:t})}}t.LucidCardIntegrationCustomImportModal=o},2147:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LucidCardIntegrationRegistry=void 0;const n=i(2942),o=i(5560),r=i(2797),a=i(6805),s=i(5585);class l{static nextHookName(){return"__lucidcard__hook"+l.nextHookId++}static registerFieldOptionsCallback(e,t){const i=l.nextHookName();return e.registerAction(i,(async({i:e})=>(await t(new Map(e))).map((e=>(0,a.serializeCardFieldOption)(e))))),i}static registerFieldSearchCallback(e,t){const i=l.nextHookName();return e.registerAction(i,(async({i:e,s:i})=>(await t(i,new Map(e))).map((e=>(0,a.serializeCardFieldOption)(e))))),i}static addCardIntegration(e,t){const i=l.nextHookName();let c;e.registerAction(i,(async i=>{const n=new o.DataSourceProxy(i.d,e);return await t.fieldConfiguration.getAllFields(n)}));const d=t.fieldConfiguration.onSelectedFieldsChange;d&&(c=l.nextHookName(),e.registerAction(c,(async t=>{const i=new o.DataSourceProxy(t.ds,e);await d(i,t.sf)})));const u=l.nextHookName();let p;e.registerAction(u,(async i=>{const n=new o.DataSourceProxy(i.d,e);return(0,r.serializeCardIntegrationConfig)(await t.getDefaultConfig(n))})),t.showIntro&&(p=l.nextHookName(),e.registerAction(p,t.showIntro));const h={n:t.label,dcn:t.dataConnectorName,il:t.itemLabel,isl:t.itemsLabel,u:t.iconUrl,ts:t.textStyle,fc:{gf:i,osfc:c,fvsc:t.fieldConfiguration.fieldValueSearchCallbacks?[...t.fieldConfiguration.fieldValueSearchCallbacks.entries()]:void 0},gdc:u,i:p};if(t.importModal){const i=t.importModal;i instanceof s.LucidCardIntegrationCustomImportModal?(h.cim={sh:l.nextHookName()},e.registerAction(h.cim.sh,(()=>i.show()))):(h.im={gsf:l.nextHookName(),s:l.nextHookName(),i:l.nextHookName(),os:i.onSetup?l.nextHookName():void 0},e.registerAction(h.im.gsf,(async({s:e})=>{const t=await i.getSearchFields(new Map(e));return(0,a.serializeCardFieldArrayDefinition)(t)})),e.registerAction(h.im.s,(async({s:e})=>{const t=await i.search(new Map(e));return{d:(0,n.serializeCollectionDefinition)(t.data),f:(0,a.serializeCardFieldArrayDefinition)(t.fields),m:t.partialImportMetadata&&{cid:t.partialImportMetadata.collectionId,sid:t.partialImportMetadata.syncDataSourceId}}})),e.registerAction(h.im.i,(async({pks:e,s:t})=>{const n=await i.import(e,new Map(t));return{c:n.collection.id,pks:n.primaryKeys}})),h.im.os&&e.registerAction(h.im.os,(async()=>{var e;await(null===(e=i.onSetup)||void 0===e?void 0:e.call(i))})))}if(t.addCard){const i=t.addCard;h.ac={gif:l.nextHookName(),cc:l.nextHookName()},e.registerAction(h.ac.gif,(async({i:e})=>{const t=await i.getInputFields(new Map(e));return(0,a.serializeCardFieldArrayDefinition)(t)})),e.registerAction(h.ac.cc,(async({i:e})=>{const t=await i.createCardData(new Map(e));return{c:t.collection.id,pk:t.primaryKey}}))}e.sendCommand("aci",h)}}t.LucidCardIntegrationRegistry=l,l.nextHookId=0},8887:(e,t)=>{function i(e){return null!=e}function n(e){return"number"==typeof e}function o(e){return"function"==typeof e}function r(e){const t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e){const t=typeof e;return"object"==t&&null!=e||"function"==t}function s(e){return Array.isArray(e)}function l(e,t){return e.length===t}Object.defineProperty(t,"__esModule",{value:!0}),t.isInstanceOf=t.isLiteral=t.isPromise=t.isUnknown=t.isAny=t.isEmptyOrNullishObject=t.isPair=t.isAtLeastLength=t.isExactLength=t.isTypedArray=t.isArray=t.isRecord=t.isObjectUnsafer=t.isObjectUnsafe=t.isObject=t.isFunction=t.isInfinite=t.isInt=t.isNumber=t.isBoolean=t.isString=t.isNullish=t.isDefAndNotNull=t.isVoid=t.isUndefined=t.isNull=t.isDef=void 0,t.isDef=function(e){return void 0!==e},t.isNull=function(e){return null===e},t.isUndefined=function(e){return void 0===e},t.isVoid=function(e){return void 0===e},t.isDefAndNotNull=i,t.isNullish=function(e){return null==e},t.isString=function(e){return"string"==typeof e},t.isBoolean=function(e){return"boolean"==typeof e},t.isNumber=n,t.isInt=function(e){return n(e)&&isFinite(e)&&e%1==0},t.isInfinite=function(e){return n(e)&&!isNaN(e)&&!isFinite(e)},t.isFunction=o,t.isObject=r,t.isObjectUnsafe=a,t.isObjectUnsafer=function(e){const t=typeof e;return"object"==t&&null!=e||"function"==t},t.isRecord=function(e){return function(t){return r(t)&&Object.values(t).every(e)}},t.isArray=s,t.isTypedArray=function(e){return function(t){return s(t)&&t.every(e)}},t.isExactLength=l,t.isAtLeastLength=function(e,t){return e.length>=t},t.isPair=function(e,t){return i=>s(i)&&l(i,2)&&e(i[0])&&t(i[1])},t.isEmptyOrNullishObject=function(e){return!(e&&"object"==typeof e&&Object.keys(e).find((t=>i(e[t]))))},t.isAny=function(e){return!0},t.isUnknown=function(e){return!0},t.isPromise=function(e){return a(e)&&o(e.then)&&o(e.catch)},t.isLiteral=function(e){return t=>t===e},t.isInstanceOf=function(e){return t=>t instanceof e}},2256:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.alphabet=void 0,t.alphabet=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]},8814:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.DataSourceType=void 0,function(e){e[e.DeprecatedGoogleSheets=0]="DeprecatedGoogleSheets",e[e.DeprecatedCSV=1]="DeprecatedCSV",e[e.DeprecatedExcel=2]="DeprecatedExcel",e[e.Salesforce=3]="Salesforce",e[e.Generator=4]="Generator",e[e.DataService=5]="DataService",e[e.ForeignKeyOverride=7]="ForeignKeyOverride",e[e.Extension=8]="Extension",e[e.Unknown=9]="Unknown"}(i||(t.DataSourceType=i={}))},9945:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeSerializedPreviewData=t.makeSerializedImportedDataSource=t.makeSerializedImportedCollection=t.MetadataPK=t.makeNameReadablyUnique=t.normalizeName=t.alphabetize=void 0;const n=i(7424),o=i(8887),r=i(703),a=i(2256),s=i(8814),l=i(7121),c=i(9467),d=new Map;function u(e){const t=d.get(e);if(null!=t)return t;const i=function(e){return null==e||e<0?"":e<a.alphabet.length?a.alphabet[e]:u(Math.floor(e/a.alphabet.length)-1)+u(e%a.alphabet.length)}(e);return d.set(e,i),i}function p(e){return e.trim().toLowerCase()}t.alphabetize=u,t.normalizeName=p;const h=/(.*) \(([0-9]+)\)$/;function g(e,t,i=p){if(!t.has(i(e)))return e;const n=h.exec(e);let r=1;n&&(0,o.isString)(n[1])&&(0,o.isString)(n[2])&&(e=n[1],r=Number(n[2])+1);let a=e;do{a=e+` (${r})`,r++}while(t.has(i(a)));return a}function m(e,t,i,n){return{Name:t+"|"+e,Schema:n,Items:i}}function y(e,i,n,o,r=!1){const a={};return i.forEach(((i,s)=>{if(r||s!==o){const o={};for(const[e,t]of Object.entries(i)){const i=n.get(e);i&&(o[i]=t)}const l=e[s];if(r&&Object.keys(o).length>0){const e=`${l}`;o[t.MetadataPK]=e,a[`${JSON.stringify(e)}`]=o}else r||(a[l]=o)}})),a}t.makeNameReadablyUnique=g,t.MetadataPK="__PK__",t.makeSerializedImportedCollection=function(e,i,n,a,s,c,d){var h;const{sheetSchema:f,oldToNewFields:S}=function(e,i,n){var r,a;const s=null!==(r=null==n?void 0:n.headerRow)&&void 0!==r?r:-1,c=s>=0?i[s]:void 0,d=c&&e.map(((e,t)=>{var i;const n=`${null!==(i=c[e])&&void 0!==i?i:""}`;return""===n.trim()?u(t):n})),h=null!=d?d:e,m=[],y=new Map,f=new Set([p(t.MetadataPK)]);h.forEach(((t,i)=>{const n=g(t,f);f.add(p(n)),m.push({Name:n,Type:l.SpreadSheetPossibleDataTypes}),y.set(e[i],n)}));const S=(null!==(a=null==n?void 0:n.primaryKey)&&void 0!==a?a:[]).map((e=>y.get(e))).filter(o.isDefAndNotNull);return{sheetSchema:{Fields:m,PrimaryKey:S},oldToNewFields:y}}(i,n,d),E=function(e,t,i){if(!i||0===i.primaryKey.length)return t.map(((e,t)=>`${t+1}`));const n=i.primaryKey,o=n.map((t=>{var i;return null!==(i=e.get(t))&&void 0!==i?i:t})),r=o.slice().sort().map((e=>n[o.indexOf(e)])),a=new Set;return t.map((e=>{const t=r.map((t=>e[t])),i=JSON.stringify(t),n=i.slice(1,i.length-1);let o=n,s=-1;for(;a.has(o);)o=`${n},${++s}`;return a.add(o),o}))}(S,n,d),v=null!==(h=null==d?void 0:d.headerRow)&&void 0!==h?h:-1,T={};if(T.ItemOrder=function(e,t,i){const n={};let o=0;for(let t=0;t<e.length;t++){const r=e[t];t!==i&&(o++,n[`${o}`]={Key:`${r}`,Order:o})}return m("ItemOrder",t,n,{Fields:[{Name:"Key",Type:r.ScalarFieldTypeEnum.STRING},{Name:"Order",Type:r.ScalarFieldTypeEnum.NUMBER}],PrimaryKey:["Order"]})}(E,e,v),v>-1&&v<n.length){const t=n[v],i=E[v];T.HeaderRowMetadata=function(e,t,i,n,o){const r={};for(const[e,n]of Object.entries(t)){const t=i.get(e);t&&(r[t]=n)}return m("HeaderRowMetadata",n,{[e]:r},o)}(i,t,S,e,f)}if(c){const i=[{Name:t.MetadataPK,Type:r.ScalarFieldTypeEnum.STRING}];f.Fields.forEach((e=>i.push({Name:e.Name,Type:[r.ScalarFieldTypeEnum.STRING,r.ScalarFieldTypeEnum.NULL]})));const n={Fields:i,PrimaryKey:[t.MetadataPK]};for(const[t,i]of Object.entries(c))T[t]=m(t,e,y(E,i,S,v,!0),n)}return{Name:e,Schema:f,Items:y(E,n,S,v),UpstreamConfig:a,Metadata:T,DataIsPartial:s}},t.makeSerializedImportedDataSource=function(e,t,i){return{Properties:{Name:t,UpstreamConfig:{SourceType:s.DataSourceType.DataService,UpdateType:c.UpstreamUpdateType.EVENTPULL,SourceConfig:{spreadsheetId:e,UpdateFilterType:n.DataUpdateFilterType.CurrentCollectionUpdates}}},Collections:i}},t.makeSerializedPreviewData=function(e,t,i){return{Properties:{Name:t,UpstreamConfig:{SourceType:s.DataSourceType.DataService,UpdateType:c.UpstreamUpdateType.EVENTPULL,SourceConfig:{spreadsheetId:e,UpdateFilterType:n.DataUpdateFilterType.CurrentCollectionUpdates}}},Collections:i}}},5901:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataTypes=void 0,function(e){e.Format="Format",e.FillColor="FillColor",e.TextColor="TextColor",e.Comment="Comment",e.Formula="Formula",e.HeaderRowMetadata="HeaderRowMetadata",e.ExternalLink="ExternalLink"}(i||(t.MetadataTypes=i={}))},9629:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSerializedDataSourceProperties=t.isSerializedSourceForeignKey=t.Direction=void 0;const n=i(8887),o=i(2607),r=i(7066);var a;!function(e){e.Inward="inward",e.Outward="outward"}(a||(t.Direction=a={})),t.isSerializedSourceForeignKey=(0,o.objectValidator)({Id:n.isString,SourceFields:(0,o.arrayValidator)(n.isString),RelationshipType:n.isString}),t.isSerializedDataSourceProperties=(0,o.strictObjectValidator)({Name:n.isString,UpstreamConfig:(0,o.nullableOption)(r.isSerializedUpstreamConfig),SourceForeignKeys:(0,o.nullableOption)((0,o.arrayValidator)(t.isSerializedSourceForeignKey))})},9204:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSerializedPreviewData=t.isSerializedImportedDataSource=t.isSerializedImportedCollection=t.isSerializedImportedMetadataCollection=void 0;const n=i(8887),o=i(2607),r=i(5082),a=i(647),s=i(9629);t.isSerializedImportedMetadataCollection=(0,o.strictObjectValidator)({Name:n.isString,Schema:a.isSerializedSchema,Items:r.isSerializedDataItems}),t.isSerializedImportedCollection=(0,o.strictObjectValidator)({Name:n.isString,Schema:a.isSerializedSchema,Items:r.isSerializedDataItems,UpstreamConfig:n.isObject,Metadata:(0,n.isRecord)(t.isSerializedImportedMetadataCollection),DataIsPartial:(0,o.option)(o.isTrue)}),t.isSerializedImportedDataSource=(0,o.strictObjectValidator)({Properties:s.isSerializedDataSourceProperties,Collections:(0,n.isTypedArray)(t.isSerializedImportedCollection)}),t.isSerializedPreviewData=(0,o.strictObjectValidator)({Properties:s.isSerializedDataSourceProperties,Collections:(0,n.isTypedArray)((0,o.strictObjectValidator)({Data:t.isSerializedImportedCollection,HeaderRow:(0,o.option)(n.isNumber),PrimaryKey:(0,o.option)((0,n.isTypedArray)(n.isNumber))}))})},7066:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSerializedUpstreamConfig=void 0;const n=i(8887),o=i(2607),r=i(8814),a=i(6338),s=i(9467);t.isSerializedUpstreamConfig=(0,o.strictObjectValidator)({SourceType:(0,o.enumValidator)(r.DataSourceType),UpdateType:(0,o.enumValidator)(s.UpstreamUpdateType),PatchType:(0,o.nullableOption)((0,o.enumValidator)(a.UpstreamPatchType)),SourceConfig:n.isObject})},7121:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SpreadSheetPossibleDataTypes=void 0;const n=i(703);t.SpreadSheetPossibleDataTypes=[n.ScalarFieldTypeEnum.BOOLEAN,n.ScalarFieldTypeEnum.NUMBER,n.ScalarFieldTypeEnum.STRING,n.ScalarFieldTypeEnum.NULL,n.ScalarFieldTypeEnum.CURRENCY,n.ScalarFieldTypeEnum.DATE,n.ScalarFieldTypeEnum.DATEONLY,n.ScalarFieldTypeEnum.TIMEONLY,n.ScalarFieldTypeEnum.COLOR]},1484:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSerializedSourceConfig=t.deserializeUpstreamConfig=t.serializeUpstreamConfig=void 0;const n=i(8887);t.serializeUpstreamConfig=function(e){return{SourceType:e.dataSourceType,UpdateType:e.updateType,PatchType:e.patchType,SourceConfig:e.sourceConfig}},t.deserializeUpstreamConfig=function(e){return{dataSourceType:e.SourceType,updateType:e.UpdateType,patchType:null===e.PatchType?void 0:e.PatchType,sourceConfig:e.SourceConfig}},t.isSerializedSourceConfig=function(e){return(0,n.isObject)(e)}},6338:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.UpstreamPatchType=void 0,function(e){e[e.NONE=0]="NONE",e[e.MANUAL=2]="MANUAL",e[e.AUTO=3]="AUTO"}(i||(t.UpstreamPatchType=i={}))},9467:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.UpstreamUpdateType=void 0,function(e){e[e.NONE=0]="NONE",e[e.PULL=1]="PULL",e[e.USER=2]="USER",e[e.EVENTPULL=3]="EVENTPULL"}(i||(t.UpstreamUpdateType=i={}))},3836:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FormattedPrimaryKey=t.declareSchema=void 0,t.declareSchema=function({primaryKey:e,fields:t}){const n=new i(...e);return{example:t,array:Object.entries(t).map((([e,{type:t,constraints:i,mapping:n}])=>{return{name:e,type:(o=t,Array.isArray(o)?t.slice():t),constraints:i,mapping:n};var o})),primaryKey:n,fromItemsSparse:e=>new Map(e.map((e=>[n.forItem(e),e]))),fromItems:e=>new Map(e.map((e=>[n.forItem(e),e])))}};class i{constructor(...e){this.elements=[...e].sort()}forItem(e){return i.serializeList(this.elements.map((t=>e[t])))}static serializeList(e){let t=JSON.stringify(e);return t=t.substring(1,t.length-1),t}}t.FormattedPrimaryKey=i},3429:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSerializedBaseFieldTypeDefinition=t.deserializeBaseFieldTypeDefinition=t.serializeBaseFieldTypeDefinition=t.isBaseFieldTypeDefinition=void 0;const n=i(8887),o=i(5736),r=i(890),a=i(7402),s=i(8381),l=i(703);function c(e){return(0,n.isDefAndNotNull)(l.ScalarFieldTypeEnum[e])||(0,a.isSerializedLiteralFieldType)(e)||(0,o.isSerializedCollectionEnumFieldType)(e)||(0,r.isSerializedFieldTypeArray)(e,c)||(0,s.isSerializedNDimensionalFieldTypeArray)(e)}t.isBaseFieldTypeDefinition=function(e){return(0,l.isScalarFieldTypeEnum)(e)||(0,a.isLiteralFieldType)(e)||e instanceof r.FieldTypeArray||e instanceof s.NDimensionalFieldTypeArray||(0,o.isCollectionEnumFieldType)(e)},t.serializeBaseFieldTypeDefinition=function(e){return e instanceof a.LiteralFieldType||e instanceof r.FieldTypeArray||e instanceof s.NDimensionalFieldTypeArray||e instanceof o.CollectionEnumFieldType?e.toJSON():e},t.deserializeBaseFieldTypeDefinition=function(e){return(0,a.isSerializedLiteralFieldType)(e)?(0,a.deserializeLiteralFieldType)(e):(0,o.isSerializedCollectionEnumFieldType)(e)?(0,o.deserializeCollectionEnumFieldType)(e):(0,r.isSerializedFieldTypeArray)(e,c)?(0,r.deserializeFieldTypeArray)(e):(0,s.isSerializedNDimensionalFieldTypeArray)(e)?(0,s.deserializeNDimensionalFieldTypeArray)(e):e},t.isSerializedBaseFieldTypeDefinition=c},5736:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSerializedCollectionEnumFieldType=t.deserializeCollectionEnumFieldType=t.isCollectionEnumFieldType=t.CollectionEnumFieldType=t.isCollectionEnumFieldNames=t.CollectionEnumFieldNames=t.CollectionEnumFieldTypeKey=void 0;const n=i(8887),o=i(2607);var r;t.CollectionEnumFieldTypeKey="COLLECTION_ENUM",function(e){e.Name="name",e.Id="id",e.Description="description",e.Color="color",e.IconUrl="iconUrl"}(r||(t.CollectionEnumFieldNames=r={})),t.isCollectionEnumFieldNames=(0,o.enumValidator)(r);class a{constructor(e){this.collectionId=e}toJSON(){return{[t.CollectionEnumFieldTypeKey]:this.collectionId}}}t.CollectionEnumFieldType=a,a.PRIMARY_KEY=r.Id,t.isCollectionEnumFieldType=e=>e instanceof a,t.deserializeCollectionEnumFieldType=function(e){return new a(e[t.CollectionEnumFieldTypeKey])},t.isSerializedCollectionEnumFieldType=function(e){return(0,n.isObjectUnsafe)(e)&&(0,n.isString)(e[t.CollectionEnumFieldTypeKey])}},890:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeFieldTypeArray=t.isSerializedFieldTypeArray=t.FieldTypeArray=t.BaseFieldTypeArray=void 0;const n=i(8887),o=i(5736),r=i(7402),a=i(703);class s{constructor(e){this.validTypesArray=e}getInnerTypes(){return this.validTypesArray}getInnerNonArrayTypes(){return this.validTypesArray.filter((e=>!(e instanceof s)))}toJSON(){return{ND:!1,validTypes:this.validTypesArray.map((e=>this.serializeType(e)))}}}t.BaseFieldTypeArray=s;class l extends s{serializeType(e){return(0,a.isScalarFieldTypeEnum)(e)?e:e.toJSON()}}t.FieldTypeArray=l,t.isSerializedFieldTypeArray=function(e,t){return(0,n.isObjectUnsafe)(e)&&(0,n.isBoolean)(e.ND)&&!1===e.ND&&(0,n.isArray)(e.validTypes)&&e.validTypes.every((e=>t(e)))},t.deserializeFieldTypeArray=function e(t){return new l(t.validTypes.map((t=>(0,r.isSerializedLiteralFieldType)(t)?(0,r.deserializeLiteralFieldType)(t):(0,o.isSerializedCollectionEnumFieldType)(t)?(0,o.deserializeCollectionEnumFieldType)(t):(0,n.isObject)(t)?e(t):t)))}},3270:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSerializedFieldTypeDefinition=t.deserializeFieldTypeDefinition=t.serializeFieldTypeDefinition=t.fieldTypesEqual=void 0;const n=i(8887),o=i(3429),r=i(5736),a=i(890),s=i(7402),l=i(8381);t.fieldTypesEqual=function e(t,i,o=!0){if(t===i)return!0;if((0,s.isLiteralFieldType)(t)&&(0,s.isLiteralFieldType)(i))return t.getLiteral()===i.getLiteral();if((0,r.isCollectionEnumFieldType)(t)&&(0,r.isCollectionEnumFieldType)(i))return!o||t.collectionId===i.collectionId;t=(0,n.isArray)(t)?t:[t],i=(0,n.isArray)(i)?i:[i];const c=new Set(t),d=new Set(i);if(c.size!==d.size)return!1;for(const i of d)if(!c.has(i))if((0,s.isLiteralFieldType)(i)){if(!t.some((t=>(0,s.isLiteralFieldType)(t)&&e(t,i))))return!1}else if(i instanceof a.FieldTypeArray){if(!t.some((t=>t instanceof a.FieldTypeArray&&e(t.validTypesArray,i.validTypesArray))))return!1}else{if(!(0,l.isNDimensionalFieldTypeArray)(i))return!1;{const n=t.find(l.isNDimensionalFieldTypeArray);if(!n||!e(n.validTypesArray,i.validTypesArray))return!1}}return!0},t.serializeFieldTypeDefinition=function(e){return(0,n.isArray)(e)?e.map(o.serializeBaseFieldTypeDefinition):(0,o.serializeBaseFieldTypeDefinition)(e)},t.deserializeFieldTypeDefinition=function(e){return(0,n.isArray)(e)?e.map(o.deserializeBaseFieldTypeDefinition):(0,o.deserializeBaseFieldTypeDefinition)(e)},t.isSerializedFieldTypeDefinition=function(e){return(0,n.isArray)(e)?e.every(o.isSerializedBaseFieldTypeDefinition):(0,o.isSerializedBaseFieldTypeDefinition)(e)}},7402:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeLiteralFieldType=t.isSerializedLiteralFieldType=t.isLiteralFieldType=t.LiteralFieldType=void 0;const n=i(8887),o=i(703);class r{constructor(e){this.scalarFieldType=o.ScalarFieldTypeEnum.ANY,(0,n.isString)(e)?(this.literal=e.substring(r.literalStringPrefix.length),this.scalarFieldType=o.ScalarFieldTypeEnum.STRING):(0,n.isBoolean)(e)?(this.literal=e,this.scalarFieldType=o.ScalarFieldTypeEnum.BOOLEAN):(this.literal=e,this.scalarFieldType=o.ScalarFieldTypeEnum.NUMBER)}getLiteral(){return this.literal}getScalarFieldType(){return this.scalarFieldType}toJSON(){return this.scalarFieldType===o.ScalarFieldTypeEnum.STRING?r.literalStringPrefix+this.literal:this.literal.toString()}}t.LiteralFieldType=r,r.literalStringPrefix="%",t.isLiteralFieldType=function(e){return e instanceof r},t.isSerializedLiteralFieldType=function(e){return(0,n.isString)(e)},t.deserializeLiteralFieldType=function(e){if(e.startsWith(r.literalStringPrefix))return new r(e);const t=Number(e);return isNaN(t)||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY?new r("true"===e):new r(t)}},8381:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeNDimensionalFieldTypeArray=t.isSerializedNDimensionalFieldTypeArray=t.isNDimensionalFieldTypeArray=t.isValidTypeForNDimensionalFieldTypeArray=t.NDimensionalFieldTypeArray=void 0;const n=i(8887),o=i(7402),r=i(703);class a{constructor(e){this.validTypesArray=e}getInnerTypes(){return[...this.validTypesArray,this]}getInnerNonArrayTypes(){return this.validTypesArray.filter((e=>(0,r.isScalarFieldTypeEnum)(e)||(0,o.isLiteralFieldType)(e)))}toJSON(){return{ND:!0,validTypes:this.validTypesArray.map((e=>(0,r.isScalarFieldTypeEnum)(e)?e:e.toJSON()))}}}t.NDimensionalFieldTypeArray=a,t.isValidTypeForNDimensionalFieldTypeArray=function(e){return(0,r.isScalarFieldTypeEnum)(e)||(0,o.isLiteralFieldType)(e)},t.isNDimensionalFieldTypeArray=function(e){return e instanceof a},t.isSerializedNDimensionalFieldTypeArray=function(e){return(0,n.isObjectUnsafe)(e)&&(0,n.isBoolean)(e.ND)&&!0===e.ND&&(0,n.isTypedArray)(n.isAny)(e.validTypes)&&e.validTypes.every((e=>(0,n.isDefAndNotNull)(r.ScalarFieldTypeEnum[e])||(0,o.isSerializedLiteralFieldType)(e)))},t.deserializeNDimensionalFieldTypeArray=function(e){return new a(e.validTypes.map((e=>(0,o.isSerializedLiteralFieldType)(e)?(0,o.deserializeLiteralFieldType)(e):e)))}},703:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.isScalarFieldTypeEnum=t.AnyScalarFieldType=t.ScalarFieldTypeEnum=void 0,function(e){e[e.ANY=0]="ANY",e[e.NUMBER=1]="NUMBER",e[e.BOOLEAN=2]="BOOLEAN",e[e.STRING=3]="STRING",e[e.COLOR=4]="COLOR",e[e.DATE=5]="DATE",e[e.NULL=6]="NULL",e[e.DICTIONARY=7]="DICTIONARY",e[e.CURRENCY=8]="CURRENCY",e[e.DATEONLY=9]="DATEONLY",e[e.TIMEONLY=10]="TIMEONLY"}(i||(t.ScalarFieldTypeEnum=i={})),t.AnyScalarFieldType=[i.ANY,i.NUMBER,i.STRING,i.BOOLEAN,i.COLOR,i.DATE,i.DATEONLY,i.NULL,i.DICTIONARY,i.CURRENCY,i.TIMEONLY];const n=new Set(t.AnyScalarFieldType);t.isScalarFieldTypeEnum=e=>n.has(e)},1698:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSemanticFields=t.SemanticFields=void 0;const n=i(2607);var o;!function(e){e.Title="title",e.Description="description",e.User="user",e.Reporter="user.reporter",e.Time="time",e.EndTime="time.endtime",e.Estimate="estimate",e.Status="status",e.IssueType="issuetype",e.Priority="priority",e.Project="project",e.SourceItemUrl="url",e.ImageUrl="url.image"}(o||(t.SemanticFields=o={})),t.isSemanticFields=(0,n.stringEnumValidator)(o)},5449:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.semanticKindToSemanticFields=t.isSemanticKind=t.SemanticKind=void 0;const n=i(2607),o=i(1698);var r;!function(e){e.Id="id",e.Title="title",e.Name="name",e.Image="image",e.Description="description",e.Assignee="assignee",e.Estimate="estimate",e.Status="status",e.IssueType="issuetype",e.Priority="priority",e.Project="project",e.Reporter="reporter",e.StartTime="starttime",e.EndTime="endtime",e.GroupByHint="groupbyhint",e.PrimaryKeyReference="primarykeyreference",e.URL="url"}(r||(t.SemanticKind=r={})),t.isSemanticKind=(0,n.enumValidator)(r),t.semanticKindToSemanticFields=function(e){if((0,o.isSemanticFields)(e))return e;switch(e){case r.Id:return;case r.Title:case r.Name:return o.SemanticFields.Title;case r.Image:return o.SemanticFields.ImageUrl;case r.Description:return o.SemanticFields.Description;case r.Assignee:return o.SemanticFields.User;case r.Estimate:return o.SemanticFields.Estimate;case r.Status:return o.SemanticFields.Status;case r.IssueType:return o.SemanticFields.IssueType;case r.Priority:return o.SemanticFields.Priority;case r.Project:return o.SemanticFields.Project;case r.Reporter:return o.SemanticFields.Reporter;case r.StartTime:return o.SemanticFields.Time;case r.EndTime:return o.SemanticFields.EndTime;case r.GroupByHint:case r.PrimaryKeyReference:return;case r.URL:return o.SemanticFields.SourceItemUrl;default:return}}},2597:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSerializedFlattenedReference=t.isUnTypedSerializedFlattenedReference=t.isTypedSerializedFlattenedReference=t.FlattenedReferenceKeyName=t.FlattenedReferenceKeyId=void 0;const n=i(8887);function o(e){return(0,n.isObjectUnsafe)(e)&&(0,n.isObject)(e.sc)&&(0,n.isObject)(e.d)}function r(e){return(0,n.isObjectUnsafe)(e)&&!0===e[t.FlattenedReferenceKeyId]}t.FlattenedReferenceKeyId="192d0e9f-2f5a-4032-9f03-59bbf1ea5891",t.FlattenedReferenceKeyName="192d0e9f-2f5a-4032-9f03-59bbf1ea5891_n",t.isTypedSerializedFlattenedReference=o,t.isUnTypedSerializedFlattenedReference=r,t.isSerializedFlattenedReference=function(e){return r(e)||o(e)}},5082:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSerializedDataItems=void 0;const n=i(2607),o=i(1113);t.isSerializedDataItems=(0,n.objectOfValidator)(o.isSerializedFields)},5043:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSerializedFieldDefinition=t.isSerializedFieldConstraint=t.isFieldConstraintType=t.FieldConstraintType=void 0;const n=i(8887),o=i(2607),r=i(3270),a=i(1698),s=i(5449);var l;!function(e){e.REQUIRED="required",e.LOCKED="locked",e.MIN_VALUE="minValue",e.MAX_VALUE="maxValue",e.SINGLE_LINE_ONLY="singleLineOnly",e.NO_WHITESPACE="noWhitespace",e.UNIQUE_EDIT="uniqueEditType",e.MAX_LENGTH="maxLength"}(l||(t.FieldConstraintType=l={})),t.isFieldConstraintType=(0,o.enumValidator)(l),t.isSerializedFieldConstraint=(0,o.objectValidator)({Type:(0,o.enumValidator)(l),Details:(0,o.option)(n.isAny)}),t.isSerializedFieldDefinition=(0,o.strictObjectValidator)({Name:n.isString,Type:r.isSerializedFieldTypeDefinition,Constraints:(0,o.option)((0,o.arrayValidator)(t.isSerializedFieldConstraint)),SyncSchema:(0,o.option)(n.isString),Mapping:(0,o.option)((0,o.either)((0,o.arrayValidator)(a.isSemanticFields),(0,o.arrayValidator)(s.isSemanticKind)))})},1113:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSerializedFields=t.isSerializedJsonFieldType=t.isSerializedFieldType=t.isSerializedTimeObject=t.isSerializedLucidDateObject=t.isSerializedIsoDateObject=t.isSerializedMillisecondsDateObject=t.isSerializedLucidCurrency=t.isSerializedLucidDictionary=t.isJsonSerializedLucidDictionary=t.isNestedSerializedLucidDictionary=t.isSerializedColorObjectFieldType=void 0;const n=i(8887),o=i(2607);function r(e){return(0,n.isObjectUnsafe)(e)&&(0,n.isObject)(e.color)}function a(e){return null==e||(0,n.isNumber)(e)||(0,n.isString)(e)||(0,n.isBoolean)(e)||(0,t.isSerializedLucidDictionary)(e)||(0,t.isSerializedLucidCurrency)(e)||(0,n.isArray)(e)&&e.every(a)||(0,t.isSerializedLucidDateObject)(e)||(0,t.isSerializedTimeObject)(e)||r(e)}function s(e){return null==e||(0,n.isNumber)(e)||(0,n.isString)(e)||(0,n.isBoolean)(e)||(0,n.isArray)(e)&&e.every(s)||(0,n.isObject)(e)&&Object.values(e).every(s)}t.isSerializedColorObjectFieldType=r,t.isNestedSerializedLucidDictionary=(0,o.strictObjectValidator)({dict:(0,o.mapValidator)(a)}),t.isJsonSerializedLucidDictionary=(0,o.strictObjectValidator)({js:(0,o.mapValidator)(s)}),t.isSerializedLucidDictionary=(0,o.either)(t.isNestedSerializedLucidDictionary,t.isJsonSerializedLucidDictionary),t.isSerializedLucidCurrency=(0,o.objectValidator)({a:n.isNumber,t:n.isString}),t.isSerializedMillisecondsDateObject=(0,o.objectValidator)({ms:n.isNumber,isDateOnly:(0,o.option)(n.isBoolean)}),t.isSerializedIsoDateObject=(0,o.objectValidator)({isoDate:n.isString,displayTimezone:(0,o.nullableOption)(n.isString)}),t.isSerializedLucidDateObject=(0,o.either)(t.isSerializedMillisecondsDateObject,t.isSerializedIsoDateObject),t.isSerializedTimeObject=(0,o.objectValidator)({hours:n.isNumber,minutes:(0,o.option)(n.isNumber),seconds:(0,o.option)(n.isNumber)}),t.isSerializedFieldType=a,t.isSerializedJsonFieldType=s,t.isSerializedFields=(0,o.objectOfValidator)(a)},647:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSerializedSchema=void 0;const n=i(8887),o=i(2607),r=i(5043);t.isSerializedSchema=function(e){if(null==e)return!1;const t=e.Fields,i=e.PrimaryKey,a=e.FieldLabelOverrides,s=!(0,n.isDefAndNotNull)(a)||(0,n.isRecord)(n.isString)(a)&&!(0,n.isArray)(a);return(0,n.isTypedArray)(r.isSerializedFieldDefinition)(t)&&(0,o.arrayValidator)(r.isSerializedFieldDefinition)(t)&&(0,n.isArray)(i)&&i.every(n.isString)&&s}},1366:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},3492:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defer=void 0,t.defer=function(){let e,t;!function(){if("function"!=typeof Promise)throw new Error("No promise library available")}();const i=new Promise(((i,n)=>{e=i,t=n}));if(!e||!t)throw new Error("Promise constructor does not provide proper arguments to callback");return{resolve:e,reject:t,promise:i,then:i.then.bind(i),catch:i.catch.bind(i),finally:i.finally.bind(i),[Symbol.toStringTag]:i[Symbol.toStringTag]}}},952:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},2963:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HumanReadableError=void 0;class i extends Error{constructor(){super(...arguments),this.name="HumanReadableError"}}t.HumanReadableError=i},440:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseIFrameAttributesFromHTML=t.generateIFrameHTML=t.DEFAULT_IFRAME_HEIGHT=t.DEFAULT_IFRAME_WIDTH=void 0;const n=i(8887);t.DEFAULT_IFRAME_WIDTH=16,t.DEFAULT_IFRAME_HEIGHT=9;const o=/src="((https:\/\/|\/\/).*?)"/i,r=/height="(\d*?)"/i,a=/width="(\d*?)"/i,s=/title="(.*?)"/i;t.generateIFrameHTML=function(e){let t=`<iframe src="${e.src}"`;return e.width&&(t+=` width="${e.width.toString()}"`),e.height&&(t+=` height="${e.height.toString()}"`),e.title&&(t+=` title="${e.title.replace(/"/g,"&quot;")}"`),t+="></iframe>",t},t.parseIFrameAttributesFromHTML=function(e){var i,l,c,d,u,p;if(!e.startsWith("<iframe"))return{srcdoc:e,height:t.DEFAULT_IFRAME_HEIGHT,width:t.DEFAULT_IFRAME_WIDTH};const h=null!==(l=null===(i=e.match(o))||void 0===i?void 0:i[1])&&void 0!==l?l:"",g=null===(c=e.match(r))||void 0===c?void 0:c[1],m=null===(d=e.match(a))||void 0===d?void 0:d[1],y=null!==(p=null===(u=e.match(s))||void 0===u?void 0:u[1])&&void 0!==p?p:"";return{src:h,height:(0,n.isUndefined)(g)?t.DEFAULT_IFRAME_HEIGHT:Number.parseInt(g),width:(0,n.isUndefined)(m)?t.DEFAULT_IFRAME_WIDTH:Number.parseInt(m),title:y}}},27:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isJsonObject=t.isJsonSerializable=void 0;const n=i(8887);function o(e){return null==e||(0,n.isString)(e)||(0,n.isNumber)(e)||(0,n.isBoolean)(e)||(0,n.isArray)(e)&&e.every(o)||r(e)}function r(e){if(!(0,n.isObjectUnsafe)(e))return!1;for(const t in e)if(!o(e[t]))return!1;return!0}t.isJsonSerializable=o,t.isJsonObject=r},9378:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.LucidProduct=void 0,function(e){e.Chart="chart",e.Spark="spark",e.TeamSpaces="teamspaces"}(i||(t.LucidProduct=i={}))},6657:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fromEntries=t.flatten=t.objectEvery=void 0,t.objectEvery=function(e,t,i){for(const n in e)if(!t.call(i,e[n],n,e))return!1;return!0},t.flatten=function(e){const t=[];for(const i of e)t.push(...i);return t},t.fromEntries=function(e){const t={};for(const[i,n]of e)t[i]=n;return t}},6673:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.isLinearOffsetType=t.OffsetType=void 0,function(e){e[e.NW=0]="NW",e[e.NE=1]="NE",e[e.SE=2]="SE",e[e.SW=3]="SW",e[e.MOVE=4]="MOVE",e[e.ROTATE=5]="ROTATE",e[e.SCALE=6]="SCALE",e[e.CUSTOM=7]="CUSTOM",e[e.N=8]="N",e[e.E=9]="E",e[e.S=10]="S",e[e.W=11]="W"}(i||(t.OffsetType=i={})),t.isLinearOffsetType=function(e){return e===i.NW||e===i.NE||e===i.SE||e===i.SW||e===i.MOVE||e===i.N||e===i.E||e===i.S||e===i.W}},7939:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},2683:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isLayerPos=t.isVerticalPos=t.isHorizontalPos=t.isValidSerializedBadgeEnumPosition=t.serializeBadgeEnumPositionAsKey=t.serializeBadgeEnumPosition=t.deserializeBadgeEnumPosition=t.badgePositionsEqual=t.defaultBadgePositionSerialized=t.defaultBadgePosition=t.BadgePositionsClockwise=t.BadgeResponsiveness=t.BadgeLayerPos=t.VerticalBadgePos=t.HorizontalBadgePos=void 0;const n=i(8887);var o,r,a,s;!function(e){e[e.LEFT=0]="LEFT",e[e.CENTER=1]="CENTER",e[e.RIGHT=2]="RIGHT"}(o||(t.HorizontalBadgePos=o={})),function(e){e[e.TOP=0]="TOP",e[e.CENTER=1]="CENTER",e[e.BOTTOM=2]="BOTTOM"}(r||(t.VerticalBadgePos=r={})),function(e){e[e.INSIDE=0]="INSIDE",e[e.EDGE=1]="EDGE",e[e.OUTSIDE=2]="OUTSIDE"}(a||(t.BadgeLayerPos=a={})),function(e){e[e.STATIC=0]="STATIC",e[e.STACK=1]="STACK"}(s||(t.BadgeResponsiveness=s={})),t.BadgePositionsClockwise=[{horizontalPos:0,verticalPos:0},{horizontalPos:1,verticalPos:0},{horizontalPos:2,verticalPos:0},{horizontalPos:2,verticalPos:1},{horizontalPos:2,verticalPos:2},{horizontalPos:1,verticalPos:2},{horizontalPos:0,verticalPos:2},{horizontalPos:0,verticalPos:1}],t.defaultBadgePosition={horizontalPos:o.RIGHT,verticalPos:r.TOP,layer:a.EDGE,responsive:s.STACK},t.defaultBadgePositionSerialized={horiz:o.RIGHT,vert:r.TOP,layer:a.EDGE,responsive:s.STACK},t.badgePositionsEqual=function(e,t){return e.horizontalPos===t.horizontalPos&&e.verticalPos===t.verticalPos&&e.layer===t.layer&&e.responsive===t.responsive},t.deserializeBadgeEnumPosition=function(e){if(null!=e)return{horizontalPos:null!=e.horiz?e.horiz:t.defaultBadgePosition.horizontalPos,verticalPos:null!=e.vert?e.vert:t.defaultBadgePosition.verticalPos,layer:null!=e.layer?e.layer:t.defaultBadgePosition.layer,responsive:null!=e.responsive?e.responsive:t.defaultBadgePosition.responsive}},t.serializeBadgeEnumPosition=function(e){return null==e?{horiz:t.defaultBadgePosition.horizontalPos,vert:t.defaultBadgePosition.verticalPos,layer:t.defaultBadgePosition.layer,responsive:t.defaultBadgePosition.responsive}:{horiz:e.horizontalPos,vert:e.verticalPos,layer:e.layer,responsive:e.responsive}},t.serializeBadgeEnumPositionAsKey=function(e){return JSON.stringify(e)},t.isValidSerializedBadgeEnumPosition=function(e){const t=null==e.horiz||Object.values(o).includes(e.horiz),i=null==e.vert||Object.values(r).includes(e.vert),n=null==e.layer||Object.values(a).includes(e.layer),l=null==e.responsive||Object.values(s).includes(e.responsive);return t&&i&&n&&l},t.isHorizontalPos=function(e){return!!(0,n.isNumber)(e)&&!!o[e]},t.isVerticalPos=function(e){return!!(0,n.isNumber)(e)&&!!r[e]},t.isLayerPos=function(e){return!!(0,n.isNumber)(e)&&!!a[e]}},3663:(e,t)=>{var i;function n(e,t){return null==e||null==t?e==t:e.w==t.w&&e.h==t.h&&e.url==t.url}Object.defineProperty(t,"__esModule",{value:!0}),t.areDataGraphicImagesEqual=t.areDataGraphicIconIndexesEqual=t.DataGraphicIconSets=void 0,function(e){e[e.CUSTOM_ICONS=-1]="CUSTOM_ICONS",e[e.STATUS_ICONS=0]="STATUS_ICONS",e[e.STATUS_CIRCLES=1]="STATUS_CIRCLES",e[e.STOPLIGHTS=2]="STOPLIGHTS",e[e.TOGGLES=3]="TOGGLES",e[e.COMPLETION_PIES=4]="COMPLETION_PIES",e[e.TRENDING_ARROWS=5]="TRENDING_ARROWS",e[e.STATUS_CHECK_BOXES=6]="STATUS_CHECK_BOXES",e[e.TRENDING_ARROWS_FLIPPED=7]="TRENDING_ARROWS_FLIPPED"}(i||(t.DataGraphicIconSets=i={})),t.areDataGraphicIconIndexesEqual=function(e,t){return e.set==t.set&&e.index==t.index&&n(e.iconImage,t.iconImage)},t.areDataGraphicImagesEqual=n},6232:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSerializedSimpleStaticDataGraphicSettings=t.deserializeSimpleStaticDataGraphicSettings=t.serializeSimpleStaticDataGraphicSettings=void 0;const n=i(8887),o=i(2683);t.serializeSimpleStaticDataGraphicSettings=function(e){return{icon:e.icon,pos:(0,o.serializeBadgeEnumPosition)(e.position),color:e.color}},t.deserializeSimpleStaticDataGraphicSettings=function(e){return{icon:e.icon,position:(0,o.deserializeBadgeEnumPosition)(e.pos),color:e.color}},t.isSerializedSimpleStaticDataGraphicSettings=function(e){return(0,n.isObjectUnsafe)(e)&&(0,n.isString)(e.color)&&(0,n.isObject)(e.icon)&&(0,o.isValidSerializedBadgeEnumPosition)(e.pos)}},6532:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.serializeSimpleFill=t.SimpleImageFillPosition=void 0;const n=i(8887);var o;!function(e){e.Fit="fit",e.Fill="fill",e.Stretch="stretch",e.Original="original",e.Tile="tile"}(o||(t.SimpleImageFillPosition=o={})),t.serializeSimpleFill=function(e){return(0,n.isString)(e)?e:{pos:e.position,url:e.url,polys:null}}},8994:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeShadow=t.serializeShadow=void 0,t.serializeShadow=function(e){return{x:e.distance*Math.cos(e.angle),y:e.distance*Math.sin(e.angle),b:e.blur,c:e.color,ang:e.angle}},t.deserializeShadow=function(e){var t;return{distance:Math.sqrt(e.x*e.x+e.y*e.y),angle:null!==(t=e.ang)&&void 0!==t?t:Math.atan2(e.y,e.x),blur:e.b,color:e.c}}},4553:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.convertStrokeStyleToBorder=t.isStrokeStyle=t.StrokeStyle=void 0,function(e){e.Solid="solid",e.Dashed="dashed",e.LongDash="longdash",e.DashDot="dashdot",e.DashDotDot="dashdotdot",e.DashLongDash="dashlongdash",e.Dashed32="dashed32",e.Dashed44="dashed44",e.Dashed24="dashed24",e.Dotted="dotted",e.DotDotDot="dotdotdot",e.StripeThinThin="stripethinthin",e.StripeThickThick="stripethickthick",e.StripeThickThin="stripethickthin",e.StripeThinThick="stripethinthick",e.StripeThickThinThick="stripethickthinthick",e.StripeThinThickThin="stripethinthickthin",e.StripeTriple="stripetriple"}(i||(t.StrokeStyle=i={}));const n=new Set(Object.values(i));t.isStrokeStyle=function(e){return n.has(e)},t.convertStrokeStyleToBorder=function(e){return e.startsWith("dash")||e==i.LongDash?"dashed":e.startsWith("dot")?"dotted":"solid"}},2207:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isEqual=t.groupByResultType=t.isFailure=t.isSuccess=void 0;const n=i(8887);function o(e){return(0,n.isDef)(e.value)}function r(e){return(0,n.isDef)(e.error)}t.isSuccess=o,t.isFailure=r,t.groupByResultType=function(e){const t=[],i=[];return e.forEach((e=>{o(e)?t.push(e):i.push(e)})),[t,i]},t.isEqual=function(e,t,i,n){return!!e&&!!t&&(o(e)&&o(t)&&i(e.value,t.value)||r(e)&&r(t)&&n(e.error,t.error))||e==t}},80:(e,t)=>{var i,n,o,r,a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.ContainmentConditions=t.ConnectedShapesCondition=t.ShapeTypeConditions=t.ShapeDataConditions=t.TextConditions=t.ConditionCombination=void 0,function(e){e.AND="AND",e.OR="OR"}(i||(t.ConditionCombination=i={})),function(e){e[e.TextEmpty=0]="TextEmpty",e[e.TextNotEmpty=1]="TextNotEmpty",e[e.TextContains=2]="TextContains",e[e.TextDoesNotContain=3]="TextDoesNotContain",e[e.GreaterThan=8]="GreaterThan",e[e.GreaterThanOrEqual=9]="GreaterThanOrEqual",e[e.LessThan=10]="LessThan",e[e.LessThanOrEqual=11]="LessThanOrEqual",e[e.Equal=12]="Equal",e[e.NotEqual=13]="NotEqual",e[e.Between=14]="Between",e[e.NotBetween=15]="NotBetween"}(n||(t.TextConditions=n={})),function(e){e[e.TextEmpty=0]="TextEmpty",e[e.TextNotEmpty=1]="TextNotEmpty",e[e.TextContains=2]="TextContains",e[e.TextDoesNotContain=3]="TextDoesNotContain",e[e.TextEquals=4]="TextEquals",e[e.TextNotEqual=5]="TextNotEqual",e[e.TextStartsWith=6]="TextStartsWith",e[e.TextEndsWith=7]="TextEndsWith",e[e.GreaterThan=8]="GreaterThan",e[e.GreaterThanOrEqual=9]="GreaterThanOrEqual",e[e.LessThan=10]="LessThan",e[e.LessThanOrEqual=11]="LessThanOrEqual",e[e.Equal=12]="Equal",e[e.NotEqual=13]="NotEqual",e[e.Between=14]="Between",e[e.NotBetween=15]="NotBetween"}(o||(t.ShapeDataConditions=o={})),function(e){e[e.TextContains=2]="TextContains",e[e.TextDoesNotContain=3]="TextDoesNotContain"}(r||(t.ShapeTypeConditions=r={})),function(e){e[e.GreaterThan=8]="GreaterThan",e[e.GreaterThanOrEqual=9]="GreaterThanOrEqual",e[e.LessThan=10]="LessThan",e[e.LessThanOrEqual=11]="LessThanOrEqual",e[e.Equal=12]="Equal",e[e.NotEqual=13]="NotEqual",e[e.Between=14]="Between",e[e.NotBetween=15]="NotBetween"}(a||(t.ConnectedShapesCondition=a={})),function(e){e[e.TextContains=2]="TextContains",e[e.TextDoesNotContain=3]="TextDoesNotContain"}(s||(t.ContainmentConditions=s={}))},5141:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ConditionType=void 0,function(e){e[e.Text=0]="Text",e[e.ShapeData=1]="ShapeData",e[e.Formula=2]="Formula",e[e.ShapeType=3]="ShapeType",e[e.ConnectedShapes=4]="ConnectedShapes",e[e.Containment=5]="Containment"}(i||(t.ConditionType=i={}))},1257:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.RuleFormattingType=void 0,function(e){e[e.FORMATTING=0]="FORMATTING",e[e.DATA_GRAPHICS=1]="DATA_GRAPHICS",e[e.STENCIL=2]="STENCIL"}(i||(t.RuleFormattingType=i={}))},2536:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSerializedDataError=void 0;const n=i(8887);t.isSerializedDataError=function(e){return(0,n.isObjectUnsafe)(e)&&(0,n.isString)(e.error)&&(0,n.isNumber)(e.type)}},3237:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeDataInheritance=void 0,function(e){e[e.NONE=0]="NONE",e[e.NAME=1]="NAME",e[e.VALUE=2]="VALUE"}(i||(t.ShapeDataInheritance=i={}))},5372:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LucidSpreadsheetIntegration=t.CustomDetailsChooser=t.ListChooser=t.isImportedResults=t.lucidSpreadsheetIntegrationFailureTypeValidator=t.LucidSpreadsheetIntegrationFailureType=void 0;const n=i(8887),o=i(7066),r=i(647),a=i(27),s=i(2607);var l;!function(e){e.AuthorizationFailure="AuthorizationFailure",e.GenericFailure="GenericFailure",e.UserCancelled="UserCanceled"}(l||(t.LucidSpreadsheetIntegrationFailureType=l={})),t.lucidSpreadsheetIntegrationFailureTypeValidator=(0,s.stringEnumValidator)(l),t.isImportedResults=(0,s.strictObjectValidator)({upstreamConfig:o.isSerializedUpstreamConfig,collections:(0,s.arrayValidator)((0,s.strictObjectValidator)({collectionId:n.isString,headerRow:n.isNumber,schema:r.isSerializedSchema,upstreamConfig:a.isJsonSerializable}))}),t.ListChooser=class{constructor(e){this.getList=e}},t.CustomDetailsChooser=class{constructor(e){this.getConfig=e}},t.LucidSpreadsheetIntegration=class{constructor(){this.addCardsIntegration=!0}}},943:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LucidSpreadsheetIntegrationRegistry=void 0;const n=i(8887),o=i(5372);class r{static nextHookName(){return"__lucidspreadsheet__hook"+this.nextHookId++}static addSpreadsheetIntegration(e,t){let i;const a=t.configChooser;if(a instanceof o.CustomDetailsChooser){const t=r.nextHookName();i=t,e.registerAction(t,(async()=>{try{return await a.getConfig()}catch(e){}return o.LucidSpreadsheetIntegrationFailureType.GenericFailure}))}else{const t=r.nextHookName();i={l:t},e.registerAction(t,(async()=>{try{const e=await a.getList();return(0,n.isString)(e)?e:{h:e.header,r:e.rows.map((({icon:e,id:t,values:i})=>({i:e,d:t,l:i})))}}catch(e){}return o.LucidSpreadsheetIntegrationFailureType.GenericFailure}))}const s=r.nextHookName();e.registerAction(s,(async e=>{try{const i=await t.getMultipleSheetsForSpreadsheetDetails(e.spreadsheetDetails);return(0,o.lucidSpreadsheetIntegrationFailureTypeValidator)(i)?i:Array.from(i)}catch(e){}return o.LucidSpreadsheetIntegrationFailureType.GenericFailure}));const l={ld:t.labelDescription,li:t.labelIconUrl,dc:t.dataConnectorName,c:t.addCardsIntegration,gs:i,gm:s};e.sendCommand("asi",l)}}t.LucidSpreadsheetIntegrationRegistry=r,r.nextHookId=0},4785:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.UnfurlCallbackType=void 0,function(e){e.Unfurl="u",e.AfterUnfurl="a",e.ExpandCallback="e"}(i||(t.UnfurlCallbackType=i={}))},4139:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.serializeUnfurlDetails=t.deserializeUnfurlDetails=t.isValidUnfurlDetails=void 0;const n=i(8887),o=i(2607),r=i(5265),a=i(5593);t.isValidUnfurlDetails=(0,o.objectValidator)({ProviderName:n.isString,ProviderFaviconUrl:n.isString,UnfurlTitle:(0,o.option)(n.isString),Iframe:(0,o.option)(r.isValidUnfurlIframe),Thumbnails:(0,o.option)((0,o.arrayValidator)(a.isValidUnfurlThumbnail)),PreviewImageUrl:(0,o.option)(n.isString)}),t.deserializeUnfurlDetails=function(e){var t;return{providerName:e.ProviderName,providerFaviconUrl:e.ProviderFaviconUrl,unfurlTitle:e.UnfurlTitle,iframe:e.Iframe&&(0,r.deserializeUnfurlIframe)(e.Iframe),thumbnails:null===(t=e.Thumbnails)||void 0===t?void 0:t.map((e=>(0,a.deserializeUnfurlThumbnail)(e))),previewImageUrl:e.PreviewImageUrl}},t.serializeUnfurlDetails=function(e){var t;return{ProviderName:e.providerName,ProviderFaviconUrl:e.providerFaviconUrl,UnfurlTitle:e.unfurlTitle,Iframe:e.iframe&&(0,r.serializeUnfurlIframe)(e.iframe),Thumbnails:null===(t=e.thumbnails)||void 0===t?void 0:t.map((e=>(0,a.serializeUnfurlThumbnail)(e))),PreviewImageUrl:e.previewImageUrl}}},5265:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateIframeAttributes=t.getIFrameWidth=t.getIFrameHeight=t.serializeUnfurlIframe=t.deserializeUnfurlIframe=t.isValidUnfurlIframe=t.UnfurlIframeAspectRatio=void 0;const n=i(8887),o=i(440),r=i(2607);var a;function s(e){switch(e){case a.Square:return 1;case a.SixteenToNine:return 9;case a.NineToSixteen:return 16;case a.FourToThree:return 3;case a.ThreeToFour:return 4;default:return 9}}function l(e){switch(e){case a.Square:return 1;case a.SixteenToNine:return 16;case a.NineToSixteen:return 9;case a.FourToThree:return 4;case a.ThreeToFour:return 3;default:return 16}}!function(e){e.Square="1:1",e.SixteenToNine="16:9",e.NineToSixteen="9:16",e.FourToThree="4:3",e.ThreeToFour="3:4"}(a||(t.UnfurlIframeAspectRatio=a={})),t.isValidUnfurlIframe=(0,r.objectValidator)({IframeUrl:n.isString,AspectRatio:(0,r.option)((0,r.stringEnumValidator)(a)),IframeTitle:(0,r.option)(n.isString)}),t.deserializeUnfurlIframe=function(e){return{iframeUrl:e.IframeUrl,aspectRatio:e.AspectRatio,iframeTitle:e.IframeTitle}},t.serializeUnfurlIframe=function(e){return{IframeUrl:e.iframeUrl,AspectRatio:e.aspectRatio,IframeTitle:e.iframeTitle}},t.getIFrameHeight=s,t.getIFrameWidth=l,t.generateIframeAttributes=function(e){return{src:e.iframeUrl,height:e.aspectRatio?s(e.aspectRatio):o.DEFAULT_IFRAME_HEIGHT,width:e.aspectRatio?l(e.aspectRatio):o.DEFAULT_IFRAME_WIDTH,title:e.iframeTitle}}},7890:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unfurlRefreshErrorTypeValidator=t.UnfurlRefreshErrorType=void 0;const n=i(2607);var o;!function(e){e.AuthorizationFailure="Authorization failure",e.GenericFailure="Generic failure"}(o||(t.UnfurlRefreshErrorType=o={})),t.unfurlRefreshErrorTypeValidator=(0,n.stringEnumValidator)(o)},5593:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.serializeUnfurlThumbnail=t.deserializeUnfurlThumbnail=t.isValidUnfurlThumbnail=void 0;const n=i(8887),o=i(2607);t.isValidUnfurlThumbnail=(0,o.objectValidator)({url:n.isString,width:(0,o.nullableOption)(n.isNumber),height:(0,o.nullableOption)(n.isNumber)}),t.deserializeUnfurlThumbnail=function(e){var t,i;return{url:e.url,width:null!==(t=e.width)&&void 0!==t?t:void 0,height:null!==(i=e.height)&&void 0!==i?i:void 0}},t.serializeUnfurlThumbnail=function(e){return{url:e.url,width:e.width,height:e.height}}},2607:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.asAssertion=t.validatorWithMessage=t.minLengthValidator=t.maxLengthValidator=t.isDate=t.isPositiveNumber=t.isSize=t.isPanelSize=t.isBoundingBox=t.isPointLike=t.isOpacity=t.isFalse=t.isTrue=t.isFlag=t.isRestrictions=t.isStringOrNegativeOne=t.isBooleanOrEmptyString=t.isNumberOrEmptyString=t.isSet=t.propertyValidator=t.exclude=t.both=t.either=t.isNullOption=t.nullableOption=t.option=t.nullable=t.objectOfValidator=t.typedRecordValidator=t.recordValidator=t.strictObjectValidator=t.partialObjectValidator=t.objectValidator=t.mapValidator=t.someValidator=t.someValue=t.tupleValidator=t.arrayValidator=t.rangeValidator=t.enumValidator=t.stringEnumValidator=void 0;const n=i(8887),o=i(6657);function r(e,t){return i=>(0,n.isNumber)(i)&&i>=e&&i<=t}function a(e){return t=>!((0,n.isArray)(t)||!(0,n.isObjectUnsafe)(t))&&(0,o.objectEvery)(e,((e,i)=>e(t[i])))}function s(e){const t=a(e);return i=>t(i)&&(0,o.objectEvery)(i,((t,i)=>void 0===t||e.hasOwnProperty(i)))}function l(e){return t=>null==t||e(t)}function c(e,t){return i=>e(i)||t(i)}t.stringEnumValidator=function(e){const t=new Set;for(const i in e){const o=e[i];(0,n.isString)(o)&&t.add(o)}const i=t;return e=>i.has(e)},t.enumValidator=function(e){return t=>{for(const i in e)if(e[i]===t)return!0;return!1}},t.rangeValidator=r,t.arrayValidator=function(e){return t=>(0,n.isArray)(t)&&t.every(e)},t.tupleValidator=function(...e){return t=>"object"==typeof t&&e.length===t.length&&e.every(((e,i)=>e(t[i])))},t.someValue=function(...e){return t=>{for(const i of e)if(t===i)return!0;return!1}},t.someValidator=function(...e){return t=>{for(const i of e)if(i(t))return!0;return!1}},t.mapValidator=function(e){return t=>(0,n.isObject)(t)&&!(0,n.isArray)(t)&&(0,o.objectEvery)(t,e)},t.objectValidator=a,t.partialObjectValidator=function(e){return t=>!((0,n.isArray)(t)||!(0,n.isObjectUnsafe)(t))&&(0,o.objectEvery)(e,((e,i)=>void 0===t[i]||e(t[i])))},t.strictObjectValidator=s,t.recordValidator=function(e,t){return i=>(0,n.isObject)(i)&&!(0,n.isArray)(i)&&e.every((e=>e in i))&&(0,o.objectEvery)(i,((e,i)=>t(e)))},t.typedRecordValidator=function(e,t){return i=>!((0,n.isArray)(i)||!(0,n.isObject)(i))&&Object.keys(i).every((t=>e(t)))&&Object.values(i).every((e=>t(e)))},t.objectOfValidator=function(e){return t=>!((0,n.isArray)(t)||!(0,n.isObject)(t))&&Object.values(t).every((t=>e(t)))},t.nullable=function(e){return t=>null===t||e(t)},t.option=function(e){return t=>void 0===t||e(t)},t.nullableOption=l,t.isNullOption=e=>null==e,t.either=c,t.both=function(e,t){return i=>e(i)&&t(i)},t.exclude=function(e,t){return i=>e(i)&&!t(i)},t.propertyValidator=function(e,t){return s({Equation:n.isString,StaticValue:i=>{const n=t.reduce(((e,t)=>t(e)),i);return e(n)}})},t.isSet=function(e){return(0,n.isObject)(e)&&!(0,n.isArray)(e)&&(0,o.objectEvery)(e,(e=>(0,n.isBoolean)(e)&&!!e))},t.isNumberOrEmptyString=c(n.isNumber,(e=>""===e)),t.isBooleanOrEmptyString=c(n.isBoolean,(e=>""===e)),t.isStringOrNegativeOne=c(n.isString,(e=>-1===e)),t.isRestrictions=s({b:l(n.isBoolean),p:l(n.isBoolean),c:l(n.isBoolean),f:l(n.isBoolean),o:l(n.isBoolean),e:l(n.isBoolean),fc:l(n.isBoolean),fs:l(n.isBoolean),l:l(n.isBoolean),i:l(n.isBoolean),u:l(n.isBoolean),acap:l(n.isBoolean),scap:l(n.isBoolean),imageCategory:l(n.isBoolean),pcad:l(n.isBoolean)}),t.isFlag=function(e){return 0===e||1===e||(0,n.isBoolean)(e)},t.isTrue=function(e){return!0===e},t.isFalse=function(e){return!1===e},t.isOpacity=r(0,100),t.isPointLike=a({x:n.isNumber,y:n.isNumber}),t.isBoundingBox=a({x:n.isNumber,y:n.isNumber,w:n.isNumber,h:n.isNumber}),t.isPanelSize=a({x:n.isNumber,y:n.isNumber,w:n.isNumber,h:n.isNumber,identifier:l(n.isString)}),t.isSize=a({w:n.isNumber,h:n.isNumber}),t.isPositiveNumber=function(e){return(0,n.isNumber)(e)&&e>=0},t.isDate=function(e){return e instanceof Date},t.maxLengthValidator=function(e){return t=>(0,n.isString)(t)&&t.length<=e},t.minLengthValidator=function(e){return t=>(0,n.isString)(t)&&t.length>=e},t.validatorWithMessage=function(e,t,i){return n=>e(n)?!i||i(n):t},t.asAssertion=function(e){return t=>{if(!e(t))throw new Error}}},5746:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isXHRResponse=t.isBinaryXHRResponse=t.isTextXHRResponse=void 0;const n=i(8887),o=i(2607),r=(0,o.objectValidator)({url:n.isString,status:n.isNumber,headers:(0,o.objectOfValidator)(n.isString),timeout:(0,o.option)(n.isBoolean)});t.isTextXHRResponse=(0,o.both)(r,(0,o.objectValidator)({responseFormat:(0,n.isLiteral)("utf8"),responseText:n.isString})),t.isBinaryXHRResponse=(0,o.both)(r,(0,o.objectValidator)({responseFormat:(0,n.isLiteral)("binary"),responseData:(0,n.isInstanceOf)(Uint8Array)})),t.isXHRResponse=(0,o.either)(t.isTextXHRResponse,t.isBinaryXHRResponse)},3471:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.patchCollectionIdFromPossibleBranchedCollectionId=t.branchedCollectionId=void 0,t.branchedCollectionId=function(e){return e+"_b"},t.patchCollectionIdFromPossibleBranchedCollectionId=function(e){if(e&&e.endsWith("_b"))return e.substring(0,e.length-2)}},2942:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeCollectionDefinition=t.serializeCollectionDefinition=void 0;const n=i(3697);t.serializeCollectionDefinition=function(e){return{Schema:(0,n.serializeSchemaDefinition)(e.schema),Items:[...e.items.entries()]}},t.deserializeCollectionDefinition=function(e){return{schema:(0,n.parseSchemaDefinition)(e.Schema),items:new Map(e.Items)}}},7904:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CollectionUpstreamSchemaStatus=void 0,t.CollectionUpstreamSchemaStatus="__CollectionUpstreamSchemaStatus__"},1859:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CollectionProxy=void 0;const n=i(8887),o=i(6394),r=i(8754),a=i(3471),s=i(1354),l=i(9253),c=i(3697);class d extends r.PropertyStoreProxy{constructor(e,t){super(e,t),this.id=e,this.items=new o.MapProxy((()=>this.client.sendCommand("ldi",{id:this.id})),(e=>new s.DataItemProxy(e,this,this.client)))}getName(){return this.properties.get("Name")}getSyncCollectionId(){const e=this.properties.get("UpstreamConfig");if((0,n.isObjectUnsafe)(e)&&(0,n.isString)(e.SyncId))return e.SyncId}getBranchedFrom(){const e=this.properties.get("BranchedFrom");return e?new d(e,this.client):void 0}getLocalChanges(){const e=(0,a.patchCollectionIdFromPossibleBranchedCollectionId)(this.id),t=this.getBranchedFrom();if(e&&t)return new l.PatchCollectionProxy(this.client,this,new d(e,this.client),t)}patchItems(e){var t,i;const n={};if(e.changed)for(const[t,i]of e.changed)n[t]=i;return this.client.sendCommand("pdi",{id:this.id,a:null!==(t=e.added)&&void 0!==t?t:[],c:n,d:null!==(i=e.deleted)&&void 0!==i?i:[]})}getFields(){return this.client.sendCommand("lcf",{id:this.id})}getSchema(){return(0,c.parseSchemaDefinition)(this.properties.get("Schema"))}}t.CollectionProxy=d},6633:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DataError=void 0,t.DataError=class{constructor(e,t){this.error=e,this.type=t}}},1354:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DataItemProxy=void 0;const n=i(6394);t.DataItemProxy=class{constructor(e,t,i){this.primaryKey=e,this.collection=t,this.client=i,this.fields=new n.MapProxy((()=>this.client.sendCommand("lcf",{id:this.collection.id})),(e=>this.client.sendCommand("gdif",{c:this.collection.id,pk:this.primaryKey,f:e})))}exists(){return this.client.sendCommand("die",{c:this.collection.id,pk:this.primaryKey})}}},495:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DataProxy=void 0;const n=i(6394),o=i(5560);t.DataProxy=class{constructor(e){this.client=e,this.dataSources=new n.MapProxy((()=>this.client.sendCommand("lds",void 0)),(e=>new o.DataSourceProxy(e,this.client)))}addDataSource(e,t){return new o.DataSourceProxy(this.client.sendCommand("cds",{n:e,s:t}),this.client)}}},5560:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DataSourceProxy=void 0;const n=i(8887),o=i(3270),r=i(6394),a=i(8754),s=i(1859);class l extends a.PropertyStoreProxy{constructor(e,t){super(e,t),this.id=e,this.collections=new r.MapProxy((()=>this.client.sendCommand("lc",{id:this.id})),(e=>new s.CollectionProxy(e,this.client)))}addCollection(e,t){return new s.CollectionProxy(this.client.sendCommand("cc",{s:this.id,n:e,f:t.fields.map((e=>({n:e.name,t:(0,o.serializeFieldTypeDefinition)(e.type)}))),p:t.primaryKey,fl:t.fieldLabels}),this.client)}getName(){return this.properties.get("Name")}getSourceConfig(){const e=this.properties.get("Upstream");return(0,n.isObjectUnsafe)(e)?e.SourceConfig:{}}}t.DataSourceProxy=l},7424:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.DataUpdateFilterType=void 0,function(e){e.AllUpdates="AllUpdates",e.CurrentCollectionUpdates="CurrentCollectionUpdates",e.CurrentItemUpdates="CurrentItemUpdates"}(i||(t.DataUpdateFilterType=i={}))},9253:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PatchCollectionProxy=t.PatchedDataItemProxy=void 0;const n=i(1354);class o extends n.DataItemProxy{constructor(e,t,i,n,o){super(e,t,o),this.changedFields=i,this.original=n}}t.PatchedDataItemProxy=o,t.PatchCollectionProxy=class{constructor(e,t,i,n){this.client=e,this.branchedCollection=t,this.patchCollection=i,this.originalCollection=n}getAddedItems(){return this.patchCollection.items.filter(((e,t)=>!this.originalCollection.items.get(t).exists()))}getDeletedItems(){return this.originalCollection.items.filter(((e,t)=>!this.branchedCollection.items.get(t).exists()))}getChangedItems(){const e=[];for(const[t,i]of this.patchCollection.items){const n=this.originalCollection.items.get(t);if(n.exists()){const r=[];for(const[e]of i.fields)r.push(e);e.push(new o(t,this.branchedCollection,r,n,this.client))}}return e}}},6150:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseReferenceKeyDefinition=t.serializeReferenceKeyDefinition=t.isCollectionReferenceKeyDefinition=void 0;const n=i(8887),o=i(2597),r=i(3697);function a(e){return(0,n.isString)(e.collectionId)}t.isCollectionReferenceKeyDefinition=a,t.serializeReferenceKeyDefinition=function(e){return a(e)?{cid:e.collectionId,pk:e.primaryKey,wl:e.fieldWhitelist,ro:e.readonly}:{sc:(0,r.serializeSchemaDefinition)(e.schema),n:e.name,d:e.data}},t.parseReferenceKeyDefinition=function(e){if((0,o.isTypedSerializedFlattenedReference)(e))return{schema:(0,r.parseSchemaDefinition)(e.sc),name:e.n,data:e.d};if((0,o.isUnTypedSerializedFlattenedReference)(e))throw new Error("Untyped serialized flattened references not implemented");return{collectionId:e.cid,primaryKey:e.pk,fieldWhitelist:e.wl,readonly:e.ro}}},4939:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReferenceKeyProxy=void 0;const n=i(2597),o=i(1859),r=i(6150);t.ReferenceKeyProxy=class{constructor(e,t,i,n){this.elementId=e,this.key=t,this.client=i,this.settings=n}get collectionId(){if(!(0,n.isSerializedFlattenedReference)(this.settings))return this.settings.cid}get primaryKey(){if(!(0,n.isSerializedFlattenedReference)(this.settings))return this.settings.pk}get definition(){return(0,r.parseReferenceKeyDefinition)(this.settings)}getItem(){const e=this.collectionId;if((0,n.isSerializedFlattenedReference)(this.settings)||!e)throw new Error("Not implemented for flattened references");return new o.CollectionProxy(e,this.client).items.get(this.settings.pk)}}},3697:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseSchemaDefinition=t.parseFieldDefinition=t.serializeSchemaDefinition=t.serializeFieldDefinition=t.serializeFieldConstraintDefinition=t.isFieldConstraintDefinition=t.minMaxFieldConstraintValidator=void 0;const n=i(8887),o=i(3270),r=i(5043),a=i(2607);function s(e){return e===r.FieldConstraintType.MIN_VALUE||e===r.FieldConstraintType.MAX_VALUE||e===r.FieldConstraintType.MAX_LENGTH}function l(e){return{Type:e.type,Details:e.value}}function c(e){const t={Name:e.name,Type:(0,o.serializeFieldTypeDefinition)(e.type)};return e.constraints&&(t.Constraints=e.constraints.map(l)),e.mapping&&(t.Mapping=e.mapping),t}function d(e){var t;return{name:e.Name,type:(0,o.deserializeFieldTypeDefinition)(e.Type),constraints:null===(t=e.Constraints)||void 0===t?void 0:t.map((e=>{switch(e.Type){case r.FieldConstraintType.MIN_VALUE:case r.FieldConstraintType.MAX_VALUE:case r.FieldConstraintType.MAX_LENGTH:if(!(0,n.isNumber)(e.Details))throw new Error("Invalid constraint format");return{type:e.Type,value:e.Details};case r.FieldConstraintType.REQUIRED:case r.FieldConstraintType.LOCKED:case r.FieldConstraintType.SINGLE_LINE_ONLY:case r.FieldConstraintType.NO_WHITESPACE:case r.FieldConstraintType.UNIQUE_EDIT:return{type:e.Type};default:throw new Error("Invalid constraint format")}})),mapping:e.Mapping}}t.minMaxFieldConstraintValidator=s,t.isFieldConstraintDefinition=(0,a.both)((0,a.objectValidator)({type:r.isFieldConstraintType}),(0,a.either)((0,a.objectValidator)({type:s,value:n.isNumber}),(0,a.objectValidator)({type:(0,a.exclude)(r.isFieldConstraintType,s),value:n.isUndefined}))),t.serializeFieldConstraintDefinition=l,t.serializeFieldDefinition=c,t.serializeSchemaDefinition=function(e){return{Fields:e.fields.map(c),PrimaryKey:e.primaryKey,FieldLabelOverrides:e.fieldLabels}},t.parseFieldDefinition=d,t.parseSchemaDefinition=function(e){return{fields:e.Fields.map(d),primaryKey:e.PrimaryKey,fieldLabels:e.FieldLabelOverrides}}},9022:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DataConnectorManageWebhookAction=t.Webhook=t.DataConnectorPatchAction=t.DataConnectorSynchronousAction=t.DataConnectorAsynchronousAction=t.DataConnectorAction=t.DataConnectorActionContext=void 0;const n=i(2779);t.DataConnectorActionContext=class{constructor(e,t,i,n,o,r,a){this.packageId=e,this.packageVersion=t,this.userCredential=i,this.dataConnectorName=n,this.installationId=o,this.documentCollections=r,this.updateFilterType=a}};class o{constructor(e,t){this.name=e,this.context=t}}t.DataConnectorAction=o,t.DataConnectorAsynchronousAction=class extends o{constructor(e,t,i,n){super(e,t),this.client=i,this.data=n}},t.DataConnectorSynchronousAction=class extends o{constructor(e,t,i){super(e,t),this.data=i}},t.DataConnectorPatchAction=class extends o{constructor(e,t,i,o=n.DataConnectorActionKeys.Patch){super(o,e),this.patches=t,this.client=i}},t.Webhook=class{constructor(e,t){this.documentCollections=e,this.webhookData=t}},t.DataConnectorManageWebhookAction=class extends o{constructor(e,t,i){super(n.DataConnectorActionKeys.ManageWebhook,e),this.webhookToken=t,this.webhooks=i}}},2779:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.DataConnectorActionKeys=void 0,function(e){e.ManageWebhook="ManageWebhook",e.Patch="Patch",e.UnbatchedPatch="UnbatchedPatch"}(i||(t.DataConnectorActionKeys=i={}))},5697:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.serializeManageWebhookResponse=void 0,t.serializeManageWebhookResponse=function(e){return{documentCollections:e.documentCollections,webhookData:e.webhookData}}},5128:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.schemaPatchParser=t.SchemaPatch=t.ThirdPartyColumnPatch=t.ThirdPartyColumn=t.itemPatchParser=t.ItemPatch=t.genericPatchParser=t.Patch=void 0;const n=i(3270),o=i(995),r=i(9665);function a(e,t){const i={};for(const n in e)i[n]=t(e[n]);return i}class s{constructor(e,t,i){this.id=e,this.syncSourceId=t,this.syncCollectionId=i}getChange(e=[]){return new o.PatchChange(this.id,this.syncSourceId,e)}}t.Patch=s,t.genericPatchParser=(e,i)=>{var n;return null!==(n=(0,t.itemPatchParser)(e,i))&&void 0!==n?n:(0,t.schemaPatchParser)(e,i)};class l extends s{constructor(e,t,i,n,o,r,a){super(e,r,a),this.itemsAdded=t,this.itemsChanged=i,this.itemsDeleted=n,this.itemOrderChanged=o}toJSON(){return{Id:this.id,ItemsAdded:this.itemsAdded,ItemsChanged:this.itemsChanged,ItemsDeleted:this.itemsDeleted,ItemOrderChanged:this.itemOrderChanged,SyncSourceId:this.syncSourceId,SyncCollectionId:this.syncCollectionId}}clone(){return new l(this.id,a(this.itemsAdded,(e=>a(e,(e=>e)))),a(this.itemsChanged,(e=>a(e,(e=>e)))),[...this.itemsDeleted],this.itemOrderChanged&&[...this.itemOrderChanged],this.syncSourceId,this.syncCollectionId)}}t.ItemPatch=l,t.itemPatchParser=(e,t)=>{if((0,r.patchItemValidator)(t))return function(e,t){var i;return new l(e,t.itemsAdded,t.itemsChanged,t.itemsDeleted,null!==(i=t.itemOrderChanged)&&void 0!==i?i:void 0,t.syncSourceId,t.syncCollectionId)}(e,t)};class c{constructor(e,t){this.name=e,this.fieldType=t}clone(){return new c(this.name,this.fieldType)}toJSON(){return{Name:this.name,FieldType:(0,n.serializeFieldTypeDefinition)(this.fieldType)}}static deserialize(e){return new c(e.name,(0,n.deserializeFieldTypeDefinition)(e.fieldType))}}t.ThirdPartyColumn=c;class d{constructor(e,t){this.name=e,this.fieldType=t}clone(){return new d(this.name,this.fieldType)}toJSON(){return{Name:this.name,FieldType:null!=this.fieldType?(0,n.serializeFieldTypeDefinition)(this.fieldType):void 0}}static deserialize(e){var t;return new d(null!==(t=e.name)&&void 0!==t?t:void 0,null!=e.fieldType?(0,n.deserializeFieldTypeDefinition)(e.fieldType):void 0)}}t.ThirdPartyColumnPatch=d;class u extends s{constructor(e,t,i,n,o,r,a){super(e,r,a),this.columnsAdded=t,this.columnsChanged=i,this.columnsDeleted=n,this.columnOrdering=o}toJSON(){return{Id:this.id,ColumnsAdded:this.columnsAdded.map((e=>e.toJSON())),ColumnsChanged:a(this.columnsChanged,(e=>e.toJSON())),ColumnsDeleted:this.columnsDeleted,ColumnOrdering:this.columnOrdering,SyncSourceId:this.syncSourceId,SyncCollectionId:this.syncCollectionId}}clone(){return new u(this.id,this.columnsAdded.map((e=>e.clone())),a(this.columnsChanged,(e=>e.clone())),[...this.columnsDeleted],this.columnOrdering&&[...this.columnOrdering.map((([e,t])=>[e,t]))],this.syncSourceId,this.syncCollectionId)}}t.SchemaPatch=u,t.schemaPatchParser=(e,t)=>{if((0,r.patchSchemaValidator)(t))return function(e,t){var i;return new u(e,t.columnsAdded.map(c.deserialize),a(t.columnsChanged,d.deserialize),t.columnsDeleted,null!==(i=t.columnOrdering)&&void 0!==i?i:void 0,t.syncSourceId,t.syncCollectionId)}(e,t)}},995:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.serializePatchChanges=t.serializePatchResponse=t.PatchErrorTooltipField=t.PatchChange=void 0;const n=i(6657),o=i(5191);function r(e){return{syncId:e.syncId,collections:e.collections.map((e=>({collectionId:e.collectionId,itemsPatch:(0,o.serializeItemsPatch)(e.itemsPatch)})))}}t.PatchChange=class{constructor(e,t,i){this.patchId=e,this.syncId=t,this.collections=i,this.errors={}}setError(e,t,i){e in this.errors||(this.errors[e]={}),this.errors[e][t]=i}setTooltipError(e,i){this.setError(e,t.PatchErrorTooltipField,i)}getErrors(){return this.errors}},t.PatchErrorTooltipField="__canvasTooltipDataSyncError__",t.serializePatchResponse=r,t.serializePatchChanges=function(e){const t={};for(const i of e)for(const e of i)for(const[i,n]of Object.entries(e.getErrors()))for(const[o,r]of Object.entries(n)){e.patchId in t||(t[e.patchId]={});const n=t[e.patchId];i in n||(n[i]={}),n[i][o]=r}return{changes:(0,n.flatten)(e.map((e=>e.map((e=>r(e)))))),errors:t}}},595:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeActions=t.actionsHeaderValidator=void 0;const n=i(8887),o=i(2607),r=i(7424),a=i(9022),s=i(2779);t.actionsHeaderValidator=(0,o.objectValidator)({"x-lucid-rsa-nonce":n.isString,"x-lucid-signature":n.isString});const l=(0,o.objectValidator)({action:(0,o.objectValidator)({name:n.isString,data:n.isUnknown}),packageId:n.isString,packageVersion:(0,o.nullableOption)(n.isString),dataConnectorName:n.isString,installationId:(0,o.nullableOption)(n.isString),userCredential:(0,o.nullableOption)(n.isString),documentUpdateToken:(0,o.nullableOption)(n.isString),documentCollections:(0,o.objectOfValidator)((0,o.arrayValidator)(n.isString)),updateFilterType:(0,o.enumValidator)(r.DataUpdateFilterType)}),c=(0,o.objectValidator)({packageVersion:n.isString,patches:(0,o.arrayValidator)((0,o.objectValidator)({patch:n.isUnknown,id:n.isString})),userCredential:n.isString,documentUpdateToken:n.isString}),d=(e,t)=>e.map((e=>{const i=e.patch;return t(e.id,i)})).filter(n.isDefAndNotNull),u=(0,o.objectValidator)({webhooks:(0,o.arrayValidator)((0,o.objectValidator)({documentCollections:(0,o.objectOfValidator)((0,o.arrayValidator)(n.isString)),webhookData:(0,o.option)(n.isUnknown)})),webhookToken:n.isString});t.deserializeActions=function(e,t,i){const r="string"==typeof t?JSON.parse(t):t;if(!l(r))return;const p=r.action.name,h=r.action.data;if(p===s.DataConnectorActionKeys.Patch){if(!(0,o.arrayValidator)(c)(h))return void console.log("Failing validation step");const t=h.map((t=>{const n=new a.DataConnectorActionContext(r.packageId,t.packageVersion,t.userCredential,r.dataConnectorName,r.dataConnectorName,r.documentCollections,r.updateFilterType),o=d(t.patches,i);if(!(o.length<t.patches.length))return new a.DataConnectorPatchAction(n,o,e.getDataSourceClient(t.documentUpdateToken))})).filter(n.isDefAndNotNull);return t.length<h.length?void console.log("Failing validation step"):t}if(!r.packageVersion||!r.userCredential)return;if(p===s.DataConnectorActionKeys.UnbatchedPatch){if(!c(h))return;const t=new a.DataConnectorActionContext(r.packageId,r.packageVersion,r.userCredential,r.dataConnectorName,r.dataConnectorName,r.documentCollections,r.updateFilterType),n=d(h.patches,i);return n.length<h.patches.length?void console.log("Failing validation step"):[new a.DataConnectorPatchAction(t,n,e.getDataSourceClient(h.documentUpdateToken),s.DataConnectorActionKeys.UnbatchedPatch)]}const g=new a.DataConnectorActionContext(r.packageId,r.packageVersion,r.userCredential,r.dataConnectorName,r.dataConnectorName,r.documentCollections,r.updateFilterType);if("ManageWebhook"==p){if(!u(h))return;const e=h.webhooks.map((e=>new a.Webhook(e.documentCollections,e.webhookData)));return[new a.DataConnectorManageWebhookAction(g,h.webhookToken,e)]}return r.documentUpdateToken?[new a.DataConnectorAsynchronousAction(p,g,e.getDataSourceClient(r.documentUpdateToken),h)]:[new a.DataConnectorSynchronousAction(p,g,h)]}},9665:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.patchValidator=t.patchSchemaValidator=t.thirdPartyColumnPatchValidator=t.thirdPartyColumnValidator=t.patchItemValidator=void 0;const n=i(8887),o=i(3270),r=i(2607);t.patchItemValidator=(0,r.objectValidator)({itemsAdded:(0,r.objectOfValidator)(n.isObjectUnsafe),itemsChanged:(0,r.objectOfValidator)(n.isObjectUnsafe),itemsDeleted:(0,r.arrayValidator)(n.isString),itemOrderChanged:(0,r.nullableOption)((0,r.arrayValidator)((0,r.tupleValidator)(n.isString,(0,r.nullable)(n.isString)))),syncSourceId:n.isString,syncCollectionId:n.isString,adapterType:(0,n.isLiteral)("EXTENSION_API"),syncSchema:n.isUnknown}),t.thirdPartyColumnValidator=(0,r.objectValidator)({name:n.isString,fieldType:o.isSerializedFieldTypeDefinition}),t.thirdPartyColumnPatchValidator=(0,r.objectValidator)({name:(0,r.nullableOption)(n.isString),fieldType:(0,r.nullableOption)(o.isSerializedFieldTypeDefinition)}),t.patchSchemaValidator=(0,r.objectValidator)({columnsAdded:(0,r.arrayValidator)(t.thirdPartyColumnValidator),columnsChanged:(0,r.mapValidator)(t.thirdPartyColumnPatchValidator),columnsDeleted:(0,r.arrayValidator)(n.isString),columnOrdering:(0,r.nullableOption)((0,r.arrayValidator)((0,r.tupleValidator)(n.isString,(0,r.nullable)(n.isString)))),syncSourceId:n.isString,syncCollectionId:n.isString,adapterType:(0,n.isLiteral)("EXTENSION_API")}),t.patchValidator=(0,r.either)(t.patchItemValidator,t.patchSchemaValidator)},813:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DataConnector=t.DataConnectorResponseError=t.DataConnectorRequestState=t.DataConnectorRequestError=t.DataConnectorRunError=void 0;const n=i(8887),o=i(2607),r=i(9022),a=i(2779),s=i(5697),l=i(5128),c=i(995),d=i(650),u=i(9388);class p extends Error{constructor(e,t,i){super(null!=i?i:JSON.stringify(t)),this.status=e,this.body=t}static withMessage(e,t){return new p(e,{error:t},t)}}t.DataConnectorRunError=p;class h extends Error{constructor(e,t,i,n){super(t),this.status=e,this.response=i,this.statusText=n}toString(){return`${this.message} ${this.statusText?this.statusText+" ":""}(${this.status}) ${this.response}`}}t.DataConnectorRequestError=h;class g{constructor(e){this.itemRekeyer=e}}t.DataConnectorRequestState=g;class m extends Error{constructor(e,t){super(e),this.response=t}}t.DataConnectorResponseError=m,t.DataConnector=class{constructor(e,t){this.client=e,this.actions={},this.routes={},this.patchParser=null!=t?t:l.itemPatchParser}defineAction(e,t,i=!1){return this.actions[e]={actionResponder:t,asynchronous:i},this}defineAsynchronousAction(e,t){return this.defineAction(e,t,!0)}defineRoute(e,t){return this.routes[e]=t,this}async runAction(e,t,i){const n=new g(new u.ItemRekeyer),o=await this.client.parseActions(e,t,i,this.patchParser);if(!o)return console.warn("Received bad request",e,t,i),{status:404,body:{error:"Bad request"}};const l=o[0].name;try{const e=[];for(const t of o){if(!(t.name in this.actions))throw p.withMessage(404,`Action ${t.name} is not implemented`);const{actionResponder:i,asynchronous:o}=this.actions[t.name],a=(()=>{if(o){if(!(t instanceof r.DataConnectorAsynchronousAction))throw p.withMessage(400,`Passing uncredentialed action to ${t.name} which is defined to be asynchronous`);return i(t,n)}return i(t,n)})();e.push(await a)}if(l===a.DataConnectorActionKeys.ManageWebhook){const t=e[0];return{status:200,body:(0,s.serializeManageWebhookResponse)(t)}}if(l===a.DataConnectorActionKeys.Patch||l===a.DataConnectorActionKeys.UnbatchedPatch){const t=e;return{status:200,body:(0,c.serializePatchChanges)(t)}}return 1===e.length?{status:200,body:e[0]}:{status:200,body:e}}catch(e){return(console.error?console.error:console.log)(`Error running ${l} action`,e),y(e)?{status:e.status,body:e.body}:{status:500,body:{error:`error running ${l} action`}}}}routeDebugServer(e){return(0,d.routeDebugServer)(this,e)}runDebugServer(e){(0,d.runDebugServer)(this,e)}};const y=(0,o.objectValidator)({status:n.isNumber,body:n.isUnknown})},5282:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MockDataConnectorClient=t.DataConnectorClient=void 0;const n=i(8887),o=i(595),r=i(9066),a=i(1751),s=i(4956),l=i(1739),c={main:"https://lucid.app/",api:"https://api.lucid.co/"};class d{constructor(e,t=c,i=a.globalFetch){this.cryptoDependencies=e,this.urls=t,this.fetchMethod=i,this.cachedPublicKey=void 0}getDataSourceClient(e){return new r.DataSourceClient(this.urls,e,this.fetchMethod)}async getSignatureValidator(){return new s.SignatureValidator(this.cryptoDependencies,await this.getPublicKey())}async getPublicKey(){if(!this.cachedPublicKey){const e=`${this.urls.main}.well-known/pem/TPCP`,t=await this.fetchMethod(e);await(0,l.throwUnsuccessful)(t,"getting public key"),this.cachedPublicKey=await t.text()}return this.cachedPublicKey}async parseActions(e,t,i,n){if((0,o.actionsHeaderValidator)(t)&&(await this.getSignatureValidator()).validate(i,t,e))return(0,o.deserializeActions)(this,i,n)}async getSecretFromWebhook(e,t){const i=await this.fetchMethod(`${this.urls.dataSync}webhookAuthorization`,{headers:{"data-update-token":e,"webhook-validation-secret":JSON.stringify(t)}});await(0,l.throwUnsuccessful)(i,"getting secret from webhook");const o=await i.json();return(0,n.isString)(o)?o:void 0}async getCustomWebhookData(e){const t=await this.fetchMethod(`${this.urls.dataSync}customWebhookData`,{headers:{"data-update-token":e}});return await(0,l.throwUnsuccessful)(t,"getting custom webhook data"),await t.json()}async patchCustomWebhookData(e,t){const i=await this.fetchMethod(`${this.urls.dataSync}customWebhookData`,{method:"PATCH",headers:{"Content-Type":"application/json","data-update-token":e,"Lucid-Api-Version":"1"},body:JSON.stringify(t)});return await(0,l.throwUnsuccessful)(i,"patching custom webhook data"),await i.json()}}t.DataConnectorClient=d,t.MockDataConnectorClient=class extends d{constructor(){super(void 0),this.dataSourceClient=new r.MockDataSourceClient}getDataSourceClient(e){return this.dataSourceClient}getSignatureValidator(){return Promise.resolve(new s.MockSignatureValidator)}getPublicKey(){return Promise.resolve("")}}},9066:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MockDataSourceClient=t.DataSourceClient=void 0;const n=i(8887),o=i(8814),r=i(1484),a=i(9467),s=i(2207),l=i(2607),c=i(813),d=i(875),u=i(5191),p=i(1751),h=i(1739);class g{constructor(e,t,i=p.globalFetch){this.urls=e,this.updateToken=t,this.fetchMethod=i;const o=e.dataSync;this.metadataUrl=(0,n.isString)(o)?`${o}dataSource/metadata`:void 0}formatBody({dataSourceName:e,collections:t,updateFilterType:i,dataSourceConfiguration:n}){const s={};for(const e in t)s[e]=(0,u.serializeCollectionPatch)(t[e]);const l=i?{UpdateFilterType:i}:{},c={dataSourceType:o.DataSourceType.DataService,updateType:a.UpstreamUpdateType.EVENTPULL,patchType:null==n?void 0:n.patchType,sourceConfig:Object.assign({},l)};return{updateData:s,name:e,upstreamConfig:(0,r.serializeUpstreamConfig)(c)}}async update(e){const t=await this.fetchMethod(`${this.urls.api}data/dataSource/update`,{method:"POST",headers:{"Content-Type":"application/json","data-update-token":this.updateToken,"Lucid-Api-Version":"1"},body:JSON.stringify(this.formatBody(e))});await(0,h.throwUnsuccessful)(t,"updating data source")}getLengthLimitedQueryParams(e,t){const i=e.map(encodeURIComponent).map((e=>`metadataKeys=${e}`)),n=t.map(encodeURIComponent).map((e=>`metadataPrefixes=${e}`)),o=[];let r="",a="?";return[...i,...n].forEach((e=>{r=r.concat(`${a}${e}`),r.length>2e3?(o.push(r),r="",a="?"):a="&"})),r.length>0&&o.push(r),o}async getResponseOrError(e){const t=await this.fetchMethod(e,{method:"GET",headers:{"Content-Type":"application/json","data-update-token":this.updateToken,"Lucid-Api-Version":"1"}});try{await(0,h.throwUnsuccessful)(t,"getting data source`s metadata")}catch(t){if(t instanceof c.DataConnectorResponseError)return{error:{url:e,body:t.response}};throw t}const i=await t.json();return(0,l.arrayValidator)(d.isSerializedMetadataRecord)(i)?{value:i.map((e=>({key:e.key,value:e.value})))}:{error:{url:e,body:i}}}async getMetadata(e,t=[]){if(null==this.metadataUrl)throw new Error("Attempted to access data sync service metadata endpoints in environment where the URL does not exist!");const i=this.getLengthLimitedQueryParams(e,t).map((e=>`${this.metadataUrl}${e}`)).map((e=>this.getResponseOrError(e))),n=await Promise.all(i),o=[],r=[];if(n.forEach((e=>{(0,s.isSuccess)(e)?o.push(...e.value):r.push(e.error)})),r.length>0){const e=`Error(s) received accessing URL(s): ${r.map((({url:e})=>e)).join(",")}`,t=r.map((({body:e})=>e));throw new c.DataConnectorResponseError(e,JSON.stringify(t))}return o}async patchMetadata(e){if(null==this.metadataUrl)throw new Error("Attempted to access data sync service metadata endpoints in environment where the URL does not exist!");const t=e.map((e=>({key:e.key,oldValue:e.oldValue,newValue:e.newValue}))),i=await this.fetchMethod(this.metadataUrl,{method:"PATCH",headers:{"Content-Type":"application/json","data-update-token":this.updateToken,"Lucid-Api-Version":"1"},body:JSON.stringify(t)});if(409===i.status){const e=await i.json();if((0,l.arrayValidator)(d.isSerializedMetadataRecord)(e))return{status:"Conflict",records:e.map((e=>({key:e.key,value:e.value})))};throw new c.DataConnectorResponseError(`Invalid conflict response to query at '${this.metadataUrl}'! Expected an array of serialized metadata records`,JSON.stringify(e))}return await(0,h.throwUnsuccessful)(i,"patching data source`s metadata"),{status:"NoContent"}}}t.DataSourceClient=g,t.MockDataSourceClient=class extends g{constructor(){super({main:"",api:""},""),this.gotUpdate=e=>{throw new Error(`Didn't mock request: ${JSON.stringify(e)}`)},this.gotMetadata=e=>{throw new Error(`Didn't mock request: ${JSON.stringify(e)}`)},this.patchedMetadata=e=>{throw new Error(`Didn't mock request: ${JSON.stringify(e)}`)}}update(e){return Promise.resolve(this.gotUpdate(e))}getMetadata(e,t=[]){return Promise.resolve(this.gotMetadata(e,t))}patchMetadata(e){return Promise.resolve(this.patchedMetadata(e))}}},875:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSerializedMetadataRecord=void 0;const n=i(8887),o=i(2607);t.isSerializedMetadataRecord=(0,o.objectValidator)({key:n.isString,value:n.isUnknown})},5191:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.schemaOKStatus=t.schemaOutOfSyncStatus=t.serializeCollectionPatch=t.serializeFieldDefinitionForApi=t.serializeItemsPatch=t.ItemsPatchExhaustive=t.ItemsPatchInexhaustive=void 0;const n=i(8887),o=i(3270),r=i(6657),a=i(7904);class s{constructor(e,t,i){this.items=e,this.itemsDeleted=t,this.errors=i,this._brand=s}}t.ItemsPatchInexhaustive=s;class l{constructor(e,t,i,n){this.items=e,this.rekeyingMap=t,this.fieldNamesChanged=i,this.errors=n,this._brand=l}}function c(e){return e&&{errors:(0,r.fromEntries)(e)}}function d(e){var t,i,n;return e instanceof l?Object.assign(Object.assign(Object.assign({exhaustiveItems:(0,r.fromEntries)(e.items.entries())},(n=e.rekeyingMap)&&{rekeyingMap:(0,r.fromEntries)(n)}),(i=e.fieldNamesChanged)&&{fieldNamesChanged:(0,r.fromEntries)(i)}),c(e.errors)):Object.assign({items:(0,r.fromEntries)(e.items.entries()),itemsDeleted:null!==(t=e.itemsDeleted)&&void 0!==t?t:[]},c(e.errors))}function u(e){var t;return{name:e.name,type:(0,o.serializeFieldTypeDefinition)(e.type),constraints:(null!==(t=e.constraints)&&void 0!==t?t:[]).map((e=>{return{type:(t=e).type,details:t.value};var t})),mapping:e.mapping}}t.ItemsPatchExhaustive=l,t.serializeItemsPatch=d,t.serializeFieldDefinitionForApi=u,t.serializeCollectionPatch=function(e){const t=e.represents&&{Represents:e.represents},i=(0,n.isString)(e.name)?{Name:e.name}:void 0,o=(t||i)&&Object.assign(Object.assign({},t),i);return{schema:e.schema&&(r=e.schema,{fields:r.fields.map((e=>u(e))),primaryKey:r.primaryKey,fieldLabelOverrides:r.fieldLabels}),itemsPatch:d(e.patch),properties:o};var r},t.schemaOutOfSyncStatus=function(e,t){return[a.CollectionUpstreamSchemaStatus,{dict:{status:"broken",onDocumentKey:JSON.stringify(e),upstreamKey:JSON.stringify(t)}}]},t.schemaOKStatus=function(){return[a.CollectionUpstreamSchemaStatus,{dict:{status:"ok",onDocumentKey:null,upstreamKey:null}}]}},650:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.runDebugServer=t.routeDebugServer=void 0;const n=i(6657);function o(e,t){var i,o;const{express:r}=t,a=null!==(i=t.app)&&void 0!==i?i:t.express();a.use(r.raw({type:()=>!0,limit:"100mb"})),a.use(((e,t,i)=>{var n,o;(null===(o=null===(n=e.headers)||void 0===n?void 0:n.origin)||void 0===o?void 0:o.match(/.lucid(dev|staging|preprod|gov|govpreprod|).app$/))&&(t.header("Access-Control-Allow-Origin",e.headers.origin),t.header("Vary","Origin"),t.header("Access-Control-Allow-Methods","GET, OPTIONS"),t.header("Access-Control-Allow-Headers","*")),i()}));const s=null!==(o=t.prefix)&&void 0!==o?o:"/";if(console.log(`Routing ${s} (${Object.keys(e.actions).join(", ")})`),e.routes)for(const t of Object.keys(e.routes))console.log(`Routing ${s}?kind=route&name=${t}`);return a.post(s,(async(t,i)=>{try{const o=t.query.kind;if("action"===o||null==o||""===o){const{body:n,status:o}=await e.runAction(t.url,t.headers,t.body.toString());i.status(o).json(n)}if("route"===o){const o=t.query.name;if("string"==typeof o){const r=e.routes[o],a=t.headers,{body:s,status:l,headers:c}=await r({body:t.body.toString(),headers:a,query:(0,n.fromEntries)(Object.entries(t.query).map((([e,t])=>[e,"string"==typeof t?t:void 0])))});for(const[e,t]of Object.entries(null!=c?c:{}))"string"==typeof t&&i.setHeader(e,t);i.status(l),i.send(s)}}}catch(e){console.log(`Error serving Connector: ${s} Flow: ${t.query.name}, Exception:`,e),i.status(500).end()}})),a}t.routeDebugServer=o,t.runDebugServer=function(e,t){var i;const n=null!==(i=t.port)&&void 0!==i?i:3001,r=o(e,t).listen(n,(()=>{const e=r.address(),t="string"==typeof e?e:null==e?void 0:e.port;console.log(`Listening on port ${t}`)}))}},1751:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.globalFetch=void 0,t.globalFetch=globalThis.fetch},9388:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ItemRekeyer=t.RekeyingMap=void 0;const n=i(3836),o=i(6657),r=i(5128),a=i(5191);class s{constructor(e){this.map=e}getNewKey(e){var t;return null!==(t=this.map.get(e))&&void 0!==t?t:e}getRecordWithNewKeys(e){return(0,o.fromEntries)(Object.entries(e).map((([e,t])=>[this.getNewKey(e),t])))}getRekeyedPatch(e){var t;return e instanceof r.ItemPatch?new r.ItemPatch(e.id,this.getRecordWithNewKeys(e.itemsAdded),this.getRecordWithNewKeys(e.itemsChanged),e.itemsDeleted.map((e=>this.getNewKey(e))),null===(t=e.itemOrderChanged)||void 0===t?void 0:t.map((([e,t])=>[this.getNewKey(e),t&&this.getNewKey(t)])),e.syncSourceId,e.syncCollectionId):e.clone()}}t.RekeyingMap=s,t.ItemRekeyer=class{constructor(){this.rekeyingMaps=new Map}addRekeyingsFor(e,t,i){var o;const r=function(e,t){var i,o;if(e instanceof a.ItemsPatchExhaustive)return e.rekeyingMap;{if(!t)return;const r=t;function s(e,t){const i=r.elements.map((e=>t[e]));if(void 0===i.find((e=>void 0!==e)))return;const o=JSON.parse(`[${e}]`),a=i.map(((e,t)=>void 0!==e?e:o[t])),s=n.FormattedPrimaryKey.serializeList(a);return s!==e?s:void 0}const l=[...e.items.entries()].map((([e,t])=>[e,s(e,t)])).filter((e=>void 0!==e[1])),c=null!==(o=null===(i=e.itemsDeleted)||void 0===i?void 0:i.map((e=>[e,null])))&&void 0!==o?o:[],d=new Map([...l,...c]);return d.size>0?d:void 0}}(t,i);if(r){const t=this.rekeyingMaps.get(e),i=[...null!==(o=null==t?void 0:t.map.entries())&&void 0!==o?o:[]].map((([e,t])=>{var i;return[e,t&&(null!==(i=r.get(t))&&void 0!==i?i:t)]}));this.rekeyingMaps.set(e,new s(new Map([...r.entries(),...i])))}}getRekeyingMap(e){return this.rekeyingMaps.get(e.syncCollectionId)}}},4956:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MockSignatureValidator=t.SignatureValidator=void 0,t.SignatureValidator=class{constructor(e,t){this.dependencies=e,this.publicKey=e.crypto.createPublicKey(t)}validate(e,t,i){const[,n=""]=i.split("?"),o=t["x-lucid-rsa-nonce"],r=this.dependencies.Buffer.from(t["x-lucid-signature"],"base64"),a="string"==typeof e?e:JSON.stringify(e),s=this.dependencies.Buffer.from(a+o+n);return this.dependencies.crypto.verify("SHA384",s,this.publicKey,r)}},t.MockSignatureValidator=class{validate(){return!0}}},1739:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.throwUnsuccessful=void 0;const n=i(813);t.throwUnsuccessful=async function(e,t){if(2!==Math.floor(e.status/100))throw new n.DataConnectorRequestError(e.status,t,await e.text(),e.statusText)}},9762:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.findProxyClass=void 0;const n=i(8131),o=i(474),r=i(9570),a=i(2412),s=i(353),l=i(2443),c=i(115),d=[n.CardBlockProxy,o.CustomBlockProxy,r.ERDBlockProxy,a.LegendBlockProxy,s.LinkUnfurlBlockProxy,l.SwimLaneBlockProxy,c.TableBlockProxy];t.findProxyClass=function(e){return d.find((t=>t.classNameRegex.test(e)))}},8131:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CardBlockProxy=void 0;const n=i(9730),o=i(4943);class r extends o.BlockProxy{getSettings(){return this.referenceKeys.get(this.referenceKeys.keys()[0]).definition}getTitle(){return this.getSettings().data[n.LucidCardFields.Title]}getDescription(){return this.getSettings().data[n.LucidCardFields.Description]}getStatus(){return this.getSettings().data[n.LucidCardFields.Status]}getAssignee(){return this.getSettings().data[n.LucidCardFields.Assignee]}getStartTime(){return this.getSettings().data[n.LucidCardFields.StartTime]}getEndTime(){return this.getSettings().data[n.LucidCardFields.EndTime]}getEstimate(){return this.getSettings().data[n.LucidCardFields.Estimate]}setTitle(e){const t=this.getSettings();t.data[n.LucidCardFields.Title]=e,this.setReferenceKey(this.referenceKeys.keys()[0],t)}setDescription(e){const t=this.getSettings();t.data[n.LucidCardFields.Description]=e,this.setReferenceKey(this.referenceKeys.keys()[0],t)}setStatus(e){const t=this.getSettings();t.data[n.LucidCardFields.Status]=e,this.setReferenceKey(this.referenceKeys.keys()[0],t)}setAssignee(e){const t=this.getSettings();t.data[n.LucidCardFields.Assignee]=e,this.setReferenceKey(this.referenceKeys.keys()[0],t)}setStartTime(e){const t=this.getSettings();t.data[n.LucidCardFields.StartTime]=e,this.setReferenceKey(this.referenceKeys.keys()[0],t)}setEndTime(e){const t=this.getSettings();t.data[n.LucidCardFields.EndTime]=e,this.setReferenceKey(this.referenceKeys.keys()[0],t)}setEstimate(e){const t=this.getSettings();t.data[n.LucidCardFields.Estimate]=e,this.setReferenceKey(this.referenceKeys.keys()[0],t)}}t.CardBlockProxy=r,r.classNameRegex=/^LucidCardBlock$/},474:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomBlockProxy=void 0;const n=i(8887),o=i(4943);class r extends o.BlockProxy{static registerCustomBlockClass(e){let t=r.subclassRegistry.get(e.library);t||(t=new Map,r.subclassRegistry.set(e.library,t)),t.set(e.shape,e)}static getCustomBlockClass(e,t){if(this.subclassRegistry.size>0){const i=e.sendCommand("gp",{id:t,p:"Stencil"});if((0,n.isObjectUnsafe)(i)){const t=e.sendCommand("gp",{p:"Stencil-"+i.id});if((0,n.isObjectUnsafe)(t)&&(0,n.isObjectUnsafe)(t.sourcePackage)&&t.sourcePackage.packageId===lucid.getPackageId()){const e=r.subclassRegistry.get(String(t.sourcePackage.library)),i=null==e?void 0:e.get(String(t.sourcePackage.shape));if(i)return i}}}return r}isFromStencil(e,t){const i=this.properties.get("Stencil");if((0,n.isObjectUnsafe)(i)){const o=this.client.sendCommand("gp",{p:"Stencil-"+i.id});if((0,n.isObjectUnsafe)(o)&&(0,n.isObjectUnsafe)(o.sourcePackage))return o.sourcePackage.packageId===lucid.getPackageId()&&o.sourcePackage.library===e&&o.sourcePackage.shape===t}return!1}getStencilTextAreaName(e){return this.textAreas.keys().find((t=>t.endsWith("_"+e)))}}t.CustomBlockProxy=r,r.classNameRegex=/^CustomBlock$/,r.subclassRegistry=new Map},9570:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ERDBlockProxy=t.ERDFieldProxy=void 0;const n=i(4943);class o{constructor(e,t){this.block=e,this.index=t}getName(){return this.block.properties.get("Field"+this.index)}getType(){var e;return null!==(e=this.block.properties.get("Type"+this.index))&&void 0!==e?e:""}getKey(){var e;return null!==(e=this.block.properties.get("Key"+this.index))&&void 0!==e?e:""}}t.ERDFieldProxy=o;class r extends n.BlockProxy{getName(){return this.properties.get("Name")}getFieldCount(){return this.properties.get("Fields")}getFields(){const e=[],t=this.getFieldCount();for(let i=1;i<=t;i++)e.push(new o(this,i));return e}}t.ERDBlockProxy=r,r.classNameRegex=/^ERDEntityBlock(2|3|4)?$/},2412:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LegendBlockProxy=t.ShapeLegendEntryProxy=t.ColorLegendEntryProxy=t.LegendEntryProxy=t.LegendItemType=void 0;const n=i(4943);var o;!function(e){e.Color="color",e.Shape="shape"}(o||(t.LegendItemType=o={}));class r{constructor(e,t,i){this.legend=e,this.index=t,this.type=i}getText(){return this.legend.textAreas.get("LegendText_"+this.index)}setText(e){this.legend.textAreas.set("LegendText_"+this.index,e)}}t.LegendEntryProxy=r;class a extends r{constructor(e,t){super(e,t,o.Color)}getColor(){return this.legend.properties.get("LegendItem_"+this.index).Value}}t.ColorLegendEntryProxy=a;class s extends r{constructor(e,t){super(e,t,o.Shape)}}t.ShapeLegendEntryProxy=s;class l extends n.BlockProxy{getHeader(){return this.textAreas.get("t_header")}getItems(){return this.properties.get("ItemOrder").map((e=>{const t=this.properties.get("LegendItem_"+e);switch(t.Type){case o.Color:return new a(this,e);case o.Shape:return new s(this,e);default:return new r(this,e,t.Type)}}))}}t.LegendBlockProxy=l,l.classNameRegex=/^LegendBlockV2$/},353:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExperimentalLinkUnfurlBlockProxy=t.LinkUnfurlBlockProxy=void 0;const n=i(440),o=i(5265),r=i(4943);class a extends r.BlockProxy{getTitle(){return this.textAreas.get("t_LinkUnfurlTitle")}setTitle(e){this.textAreas.set("t_LinkUnfurlTitle",e,{force:!0})}getDescription(){return this.textAreas.get("t_LinkUnfurlDescription")}setDescription(e){this.textAreas.set("t_LinkUnfurlDescription",e,{force:!0})}getProviderName(){return this.textAreas.get("t_LinkUnfurlProviderName")}getUrl(){return this.properties.get("LinkUnfurlUrl")}setUrl(e){this.properties.set("LinkUnfurlUrl",e)}setIframe(e){const t=(0,o.generateIframeAttributes)(e);this.properties.set("LinkUnfurlIframeHtml",(0,n.generateIFrameHTML)(t)),this.properties.set("LinkUnfurlIframeHeight",t.height),this.properties.set("LinkUnfurlIframeWidth",t.width)}hasIframe(){return!!this.properties.get("LinkUnfurlIframeHtml")}setPreviewThumbnailUrl(e){this.properties.set("LinkUnfurlThumbnailUrl",e)}getPreviewThumbnailUrl(){return this.properties.get("LinkUnfurlThumbnailUrl")}setThumbnailUrls(e){this.properties.set("LinkUnfurlThumbnailUrls",e)}getFaviconUrl(){return this.properties.get("LinkUnfurlFaviconUrl")}setFaviconUrl(e){this.properties.set("LinkUnfurlFaviconUrl",e)}async experimentalStartPDFUpload(){return await this.client.sendCommand("pdf",this.id)}}t.LinkUnfurlBlockProxy=a,a.classNameRegex=/^LinkUnfurlBlock$/,t.ExperimentalLinkUnfurlBlockProxy=a},2443:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SwimLaneBlockProxy=t.SwimLanePrimaryLaneProxy=void 0;const n=i(6532),o=i(4943);class r{constructor(e,t){this.swimlane=e,this.index=t}getSize(){return this.swimlane.getPrimaryLaneSizes()[this.index]}getBoundingBox(){const e=this.swimlane.getBoundingBox(),t=this.swimlane.getPrimaryLaneSizes();return this.swimlane.getPrimaryLanesVertical()?{x:e.x+t.slice(0,this.index).reduce(((e,t)=>e+t),0),y:e.y,w:t[this.index],h:e.h}:{x:e.x,y:e.y+t.slice(0,this.index).reduce(((e,t)=>e+t),0),w:e.w,h:t[this.index]}}getTitleTextAreaId(){return this.swimlane.properties.get("PrimaryLaneTextAreaIds")[this.index]||(this.swimlane.updateTextAreaNames(),this.swimlane.properties.get("PrimaryLaneTextAreaIds")[this.index])}getTitle(){return this.swimlane.textAreas.get(this.getTitleTextAreaId())}setTitle(e){return this.swimlane.textAreas.set(this.getTitleTextAreaId(),e)}setFill(e){this.swimlane.properties.set(`CellFill_0,${this.index}`,(0,n.serializeSimpleFill)(e))}}t.SwimLanePrimaryLaneProxy=r;class a extends o.BlockProxy{getPrimaryLaneSizes(){return this.properties.get("PrimaryLane")}setPrimaryLaneSizes(e){this.properties.set("PrimaryLane",e),this.updateTextAreaNames()}getPrimaryLanes(){return this.getPrimaryLaneSizes().map(((e,t)=>new r(this,t)))}getPrimaryLanesVertical(){return this.properties.get("IsPrimaryLaneVertical")}getMagnetized(){return this.properties.get("Magnetize")}setMagnetized(e){this.properties.set("Magnetize",e)}updateTextAreaNames(){this.properties.set("PrimaryLaneTextAreaIds",this.getPrimaryLaneSizes().map(((e,t)=>"Primary_"+t)))}setBoundingBox(e){super.setBoundingBox(e);const t=this.getBoundingBox(),i=this.getPrimaryLaneSizes(),n=this.properties.get("SecondaryLane"),o=(e,t,i=e.length-1)=>{if(i>=0&&i<e.length&&(e[i]+=t,e[i]<40)){const t=40-e[i];e[i]=40,o(e,t,i-1)}};e.w!=t.w&&(this.getPrimaryLanesVertical()?(o(i,e.w-t.w),this.setPrimaryLaneSizes(i)):(o(n,e.w-t.w),this.properties.set("SecondaryLane",n))),e.h!=t.h&&(this.getPrimaryLanesVertical()?(o(n,e.h-t.h),this.properties.set("SecondaryLane",n)):(o(i,e.h-t.h),this.setPrimaryLaneSizes(i)))}}t.SwimLaneBlockProxy=a,a.classNameRegex=/^AdvancedSwimLaneBlock$/},115:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TableBlockProxy=t.TableColumnProxy=t.TableRowProxy=t.TableCellProxy=void 0;const n=i(6532),o=i(4943);class r{constructor(e,t,i){this.table=e,this.row=t,this.column=i}getText(){return this.table.textAreas.get(`Cell_${this.row},${this.column}`)}setText(e){return this.table.textAreas.set(`Cell_${this.row},${this.column}`,e)}getTextStyle(){return this.table.textStyles.get(`Cell_${this.row},${this.column}`)}setTextStyle(e){this.table.textStyles.set(`Cell_${this.row},${this.column}`,e)}setFill(e){this.table.properties.set(`CellFill_${this.row},${this.column}`,(0,n.serializeSimpleFill)(e))}getMergedCellSize(){var e;return null!==(e=this.table.properties.get(`CellSize_${this.row},${this.column}`))&&void 0!==e?e:{w:1,h:1}}setMergedCellSize(e){this.table.properties.set(`CellSize_${this.row},${this.column}`,e)}getWidth(){return this.table.getColumnWidths().slice(this.column,this.column+this.getMergedCellSize().w).reduce(((e,t)=>e+t),0)}getHeight(){return this.table.getRowHeights().slice(this.row,this.row+this.getMergedCellSize().h).reduce(((e,t)=>e+t),0)}getBoundingBox(){const e=this.table.getBoundingBox();return{x:e.x+this.table.getColumnWidths().slice(0,this.column).reduce(((e,t)=>e+t),0),y:e.y+this.table.getRowHeights().slice(0,this.row).reduce(((e,t)=>e+t),0),w:this.getWidth(),h:this.getHeight()}}}t.TableCellProxy=r;class a{constructor(e,t){this.table=e,this.row=t}getCells(){return this.table.getColumnWidths().map(((e,t)=>new r(this.table,this.row,t)))}getHeight(){var e;return null!==(e=this.table.getRowHeights()[this.row])&&void 0!==e?e:1}}t.TableRowProxy=a;class s{constructor(e,t){this.table=e,this.col=t}getCells(){return this.table.getRowHeights().map(((e,t)=>new r(this.table,this.col,t)))}getWidth(){var e;return null!==(e=this.table.getColumnWidths()[this.col])&&void 0!==e?e:1}}t.TableColumnProxy=s;class l extends o.BlockProxy{addColumn(e,t=!1){const i=this.client.sendCommand("atc",{id:this.id,r:e.row,c:e.column,b:t});return new s(this,i)}addRow(e,t=!1){const i=this.client.sendCommand("atr",{id:this.id,r:e.row,c:e.column,b:t});return new a(this,i)}deleteColumn(e){return this.client.sendCommand("dtc",{id:this.id,i:e})}deleteRow(e){return this.client.sendCommand("dtr",{id:this.id,i:e})}getCellByTextAreaKey(e){const t=e.match(/(\d+)/g);if(t&&2===t.length){const e=+t[0],i=+t[1];return new r(this,e,i)}}getRowCount(){return this.getRowHeights().length}getColumnCount(){return this.getColumnWidths().length}getRows(){return this.getRowHeights().map(((e,t)=>new a(this,t)))}getRowHeights(){return this.properties.get("RowHeights")}getColumnWidths(){return this.properties.get("ColWidths")}setColumnWidths(e){this.properties.set("ColWidths",e)}setRowHeights(e){this.properties.set("RowHeights",e)}getAutoResizeColumns(){return this.properties.get("AutoColWidth")}getAutoResizeRows(){return this.properties.get("AutoRowHeight")}setAutoResizeColumns(e){this.properties.set("AutoColWidth",e)}setAutoResizeRows(e){this.properties.set("AutoRowHeight",e)}setInsetMargin(e){this.properties.set("InsetMargin",e)}}t.TableBlockProxy=l,l.classNameRegex=/^DefaultTableBlock$/},1442:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},4943:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BlockProxy=void 0;const n=i(2683),o=i(6232),r=i(6532),a=i(8994),s=i(8042),l=i(4407);class c extends l.ItemProxy{getClassName(){return this.properties.get("ClassName")}getRotation(){return this.properties.get("Rotation")}getRotatedBoundingBox(){return(0,s.rotatedBoundingBox)(this.getBoundingBox(),this.getRotation())}setRotation(e){this.properties.set("Rotation",e)}getShadow(){const e=this.properties.get("Shadow");if(e)return(0,a.deserializeShadow)(e)}setShadow(e){e?this.properties.set("Shadow",(0,a.serializeShadow)(e)):this.properties.set("Shadow",null)}setFillStyle(e){this.properties.set("FillColor",(0,r.serializeSimpleFill)(e))}getConnectedLines(){return this.client.sendCommand("gcl",this.id).map((e=>this.client.getLineProxy(e)))}setSimpleStaticDataGraphic(e){e?this.properties.set("StaticDataGraphic",(0,o.serializeSimpleStaticDataGraphicSettings)(e)):this.properties.set("StaticDataGraphic",void 0)}getSimpleStaticDataGraphic(){const e=this.properties.get("StaticDataGraphic");return(0,o.isSerializedSimpleStaticDataGraphicSettings)(e)?(0,o.deserializeSimpleStaticDataGraphicSettings)(e):void 0}lockAspectRatio(){const e=this.getBoundingBox();this.properties.set("AspectRatio",e.w/e.h)}unlockAspectRatio(){this.properties.set("AspectRatio",void 0)}getLineWidth(){return this.properties.get("LineWidth")}setLineWidth(e){this.properties.set("LineWidth",e)}linkText(e,t,i){if(!this.textAreas.keys().includes(e))throw new Error("Invalid text area key");if(!this.referenceKeys.keys().includes(t))throw new Error("Invalid reference key");this.properties.set(e+"_Link",{ref:t,f:i})}setDataSyncStateIconPosition(e){this.properties.set("DataSyncStateIconPosition",e?(0,n.serializeBadgeEnumPosition)(e):null)}}t.BlockProxy=c},9142:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CardConfigProxy=void 0;const n=i(1225);class o extends n.DocumentElementProxy{constructor(e,t){super(e,t),this.id=e}}t.CardConfigProxy=o},1225:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentElementProxy=void 0;const n=i(8754);class o extends n.PropertyStoreProxy{constructor(e,t){super(e,t),this.id=e}}t.DocumentElementProxy=o},8229:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentElementType=void 0,function(e){e.DataTransformation="DerivedStructure",e.Path="Path",e.Tag="Tag",e.CommentThreadMetadata="ThreadMetadata",e.FontStylePreset="FontStylePreset",e.IntraDocumentMutex="Mutex",e.Rule="Rule",e.DocumentFormula="Formula",e.TaskCardFieldsConfig="TaskCardFieldsConfig",e.GeneratorView="GeneratorView",e.ShapeStylePreset="ShapeStylePreset",e.ShapeSpecificDefaultProperties="ShapeSpecificDefaultProperties",e.TrackedFormulaLocation="TrackedFormulaLocation"}(i||(t.DocumentElementType=i={}))},5860:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RuleProxy=t.RuleEffect=t.RuleCondition=void 0;const n=i(2683),o=i(6394),r=i(7811),a=i(1225);class s{constructor(e,t,i){this.rule=e,this.client=t,this.key=i,this.definition=this.rule.properties.get(this.key),this.type=this.definition.Type,this.condition=this.definition.Condition,this.value=this.definition.Value,this.field=this.definition.Label,this.fieldLabel=this.definition.DisplayLabel}update(e){this.rule.properties.set(this.key,(0,r.serializeConditionDefinition)(e)),this.definition=this.rule.properties.get(this.key)}}t.RuleCondition=s;class l{constructor(e,t,i){this.rule=e,this.client=t,this.key=i,this.definition=this.rule.properties.get(this.key),this.conditions=new o.MapProxy((()=>this.definition.ConditionOrder.map((e=>"Condition_"+e))),(e=>new s(this.rule,this.client,e))),this.combination=this.definition.Combination,this.formatType=this.definition.FormatType,this.formatting=this.definition.Formatting,this.dataGraphic=this.definition.DataGraphic&&{set:this.definition.DataGraphic.Set,index:this.definition.DataGraphic.Index,position:(0,n.deserializeBadgeEnumPosition)(this.definition.DataGraphic.Position),color:this.definition.DataGraphic.Color,image:this.definition.DataGraphic.Image&&{url:this.definition.DataGraphic.Image.url,w:this.definition.DataGraphic.Image.w,h:this.definition.DataGraphic.Image.h}}}update(e){let t=1;for(const e of this.rule.effects.values())t=Math.max(t,...e.definition.ConditionOrder.map((e=>e+1)));const i=this.definition.ConditionOrder;e.conditions.forEach(((e,n)=>{let o=i[n];void 0===o&&(o=t,i.push(t++));const a="Condition_"+o;this.rule.properties.set(a,(0,r.serializeConditionDefinition)(e))})),this.rule.properties.set(this.key,(0,r.serializeEffectDefinition)(e,i.slice(0,e.conditions.length)))}}t.RuleEffect=l;class c extends a.DocumentElementProxy{constructor(e,t){super(e,t),this.id=e,this.effects=new o.MapProxy((()=>this.properties.get("EffectOrder").map((e=>"Effect_"+e))),(e=>new l(this,this.client,e)))}getName(){return this.properties.get("Name")}setName(e){this.properties.set("Name",e)}getOrder(){return this.properties.get("Order")}delete(){this.client.sendCommand("dde",this.id)}static getRuleProperties(e){const t={EffectOrder:e.effects.map(((e,t)=>t+1)),SourceType:0,Name:e.name};let i=1,n=1;for(const o of e.effects){const e="Effect_"+n++,a=[];for(const e of o.conditions)a.push(i),t["Condition_"+i++]=(0,r.serializeConditionDefinition)(e);t[e]=(0,r.serializeEffectDefinition)(o,a)}return t}update(e){const t=c.getRuleProperties(e);for(const e in t)this.properties.set(e,t[e])}}t.RuleProxy=c},3281:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentProxy=void 0;const n=i(9142),o=i(8229),r=i(5860),a=i(5980),s=i(4407),l=i(6394),c=i(1971);class d extends a.ElementProxy{static getNextHookName(){return"__documentproxy__hook"+d.nextHookId++}constructor(e){super(e.sendCommand("gdid",void 0),e),this.pages=new l.MapProxy((()=>this.client.sendCommand("lp",void 0)),(e=>new c.PageProxy(e,this.client))),this.cardIntegrationConfigs=new l.MapProxy((()=>this.client.sendCommand("lde",{t:o.DocumentElementType.TaskCardFieldsConfig})),(e=>new n.CardConfigProxy(e,this.client))),this.rules=new l.MapProxy((()=>this.client.sendCommand("lde",{t:o.DocumentElementType.Rule}).filter((e=>0===this.client.sendCommand("gp",{id:e,p:"SourceType"})))),(e=>new r.RuleProxy(e,this.client)))}*allBlocks(){for(const e of this.pages.values())for(const t of e.blocks.values())yield t}*allLines(){for(const e of this.pages.values())for(const t of e.lines.values())yield t}addPage(e){const t=this.client.sendCommand("cp",void 0),i=new c.PageProxy(t,this.client);return i.setTitle(e.title),i}setTitle(e){this.properties.set("Title",e)}getTitle(){return this.properties.get("Title")}getDocumentChunks(e){return this.client.sendCommand("gdc",{t:e}).map((e=>({boundingBox:e.bb,items:e.i.map((e=>this.client.getElementProxy(e))).filter((e=>e instanceof s.ItemProxy)),text:e.t,description:e.d})))}hookAllChanges(e){const t=d.getNextHookName();return this.client.registerAction(t,(()=>{e()})),this.client.sendCommand("hac",{n:t}),t}unhookAllChanges(e){this.client.deleteAction(e),this.client.sendCommand("uac",{n:e})}hookCreateItems(e){const t=d.getNextHookName();return this.client.registerAction(t,(t=>{e(t.ids.map((e=>this.client.getItemProxy(e))))})),this.client.sendCommand("hci",{n:t}),t}unhookCreateItems(e){this.client.deleteAction(e),this.client.sendCommand("uci",{n:e})}addRule(e){let t=0;for(const e of this.rules.values())t=Math.max(t,e.getOrder());const i=this.client.sendCommand("cde",{t:o.DocumentElementType.Rule,p:Object.assign(Object.assign({},r.RuleProxy.getRuleProperties(e)),{Order:t+1})});if(void 0!==i)return new r.RuleProxy(i,this.client)}hookDeleteItems(e){const t=d.getNextHookName();return this.client.registerAction(t,(t=>{e(t.ids)})),this.client.sendCommand("hdi",{n:t}),t}unhookDeleteItems(e){this.client.deleteAction(e),this.client.sendCommand("udi",{n:e})}async duplicateItems(e){return await this.client.sendCommand("dis",{ids:e})}}t.DocumentProxy=d,d.nextHookId=0},5980:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ElementProxy=void 0;const n=i(6150),o=i(4939),r=i(6394),a=i(8754),s=i(3031);class l extends a.PropertyStoreProxy{setReferenceKey(e,t){this.client.sendCommand("srk",{id:this.id,k:e,v:(0,n.serializeReferenceKeyDefinition)(t)})}removeReferenceKey(e){this.client.sendCommand("srk",{id:this.id,k:e})}constructor(e,t){super(e,t),this.shapeData=new s.ShapeDataProxy(this.id,this.client),this.allShapeData=new r.MapProxy((()=>this.client.sendCommand("lsd",{id:this.id,i:!0})),(e=>s.ShapeDataProxy.parseData(this.client.sendCommand("gsd",{id:this.id,n:e})))),this.referenceKeys=new r.MapProxy((()=>this.client.sendCommand("lrk",{id:this.id})),(e=>new o.ReferenceKeyProxy(this.id,e,this.client,this.client.sendCommand("grk",{id:this.id,k:e}))))}exists(){return this.client.sendCommand("ee",{id:this.id})}executeFormula(e){return s.ShapeDataProxy.parseData(this.client.sendCommand("ef",{id:this.id||"",f:e}))}}t.ElementProxy=l},4525:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GroupProxy=void 0;const n=i(4407),o=i(3912),r=i(6394);class a extends n.ItemProxy{constructor(){super(...arguments),this.blocks=new r.MapProxy((()=>this.client.sendCommand("lb",{id:this.id})),(e=>this.client.getBlockProxy(e))),this.lines=new r.MapProxy((()=>this.client.sendCommand("ll",{id:this.id})),(e=>new o.LineProxy(e,this.client))),this.groups=new r.MapProxy((()=>this.client.sendCommand("lg",{id:this.id})),(e=>new a(e,this.client))),this.allBlocks=new r.MapProxy((()=>this.client.sendCommand("lb",{id:this.id,d:!0})),(e=>this.client.getBlockProxy(e))),this.allLines=new r.MapProxy((()=>this.client.sendCommand("ll",{id:this.id,d:!0})),(e=>new o.LineProxy(e,this.client))),this.allGroups=new r.MapProxy((()=>this.client.sendCommand("lg",{id:this.id,d:!0})),(e=>new a(e,this.client)))}}t.GroupProxy=a},7518:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.imageToBlockDefinition=void 0,t.imageToBlockDefinition=function(e){return{className:"UserImage2Block",boundingBox:e.boundingBox,fillStyle:e.fillStyle,properties:{opactiy:e.opacity,lineColor:e.lineColor,lineWidth:e.lineWidth,strokeStyle:e.strokeStyle,rounding:e.rounding,rotation:e.rotation}}}},4407:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ItemProxy=void 0;const n=i(6673),o=i(5980),r=i(6394);class a extends o.ElementProxy{constructor(e,t){super(e,t),this.id=e,this.textAreas=new r.WriteableMapProxy((()=>this.client.sendCommand("lta",this.id)),(e=>this.client.sendCommand("gp",{id:this.id,p:e})),((e,t,i)=>this.client.sendCommand("st",{id:this.id,n:e,t,f:null==i?void 0:i.force}))),this.textStyles=new r.WriteableMapProxy((()=>this.textAreas.keys()),(e=>this.client.sendCommand("gts",{id:this.id,n:e})),((e,t)=>this.client.sendCommand("sts",{id:this.id,n:e,s:t})))}getBoundingBox(){return this.properties.get("BoundingBox")}setBoundingBox(e){const t=this.getBoundingBox();t.x===e.x&&t.y===e.y||this.offset(n.OffsetType.MOVE,{x:e.x-t.x,y:e.y-t.y}),t.w===e.w&&t.h===e.h||this.offset(n.OffsetType.SE,{x:e.w-t.w,y:e.h-t.h})}getPageId(){return this.client.sendCommand("gip",this.id)}getPage(){return this.client.getPageProxy(this.getPageId())}getLocation(){const e=this.getBoundingBox();return{x:e.x,y:e.y}}setLocation(e){const t=this.getBoundingBox();t.x===e.x&&t.y===e.y||this.offset(n.OffsetType.MOVE,{x:e.x-t.x,y:e.y-t.y})}offset(e,t){this.client.sendCommand("oi",{ids:[this.id],t:e,o:t})}measureText(e,t){return this.client.sendCommand("mt",{id:this.id,n:e,w:t})}delete(){this.client.sendCommand("di",this.id)}getContainers(){return this.executeFormula("LABEL(CONTAINEDBY)").map((e=>this.client.getBlockProxy(e)))}changeZOrder(e){this.client.sendCommand("z",{i:[this.id],o:e})}applyRule(e){const t=this.properties.get("RuleList");t.includes(e.id)||(t.push(e.id),this.properties.set("RuleList",t))}unapplyRule(e){const t=this.properties.get("RuleList");t.includes(e.id)&&this.properties.set("RuleList",t.filter((t=>t!==e.id)))}}t.ItemProxy=a},6639:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPositionEndpointDefinition=t.isLineEndpointDefinition=t.isBlockEndpointDefinition=void 0;const n=i(8887),o=i(2607),r=i(4943),a=i(3912);t.isBlockEndpointDefinition=function(e){return(0,o.objectValidator)({connection:(0,n.isInstanceOf)(r.BlockProxy),linkX:n.isNumber,linkY:n.isNumber,inside:(0,o.option)(n.isBoolean),autoLink:(0,o.option)(n.isBoolean),padding:(0,o.option)(n.isNumber)})(e)},t.isLineEndpointDefinition=function(e){return(0,o.objectValidator)({connection:(0,n.isInstanceOf)(a.LineProxy),position:n.isNumber})(e)},t.isPositionEndpointDefinition=function(e){return(0,o.objectValidator)({x:n.isNumber,y:n.isNumber})(e)}},3912:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LineProxy=t.LineShape=void 0;const n=i(8887),o=i(4943),r=i(4407),a=i(4271);var s;!function(e){e.Curve="curve",e.Elbow="elbow",e.Diagonal="diagonal"}(s||(t.LineShape=s={}));class l extends r.ItemProxy{getConnection(e){let t;if(e.Block&&(t=this.client.getBlockProxy(e.Block)),e.Line&&(t=this.client.getLineProxy(e.Line)),!t||t.exists())return t}isBlockEndpointDefinition(e){return e.connection instanceof o.BlockProxy}isLineEndpointDefinition(e){return e.connection instanceof l}parseLineEndpointDefinition(e){const t=this.getConnection(e);return t instanceof l?{connection:t,style:e.Style,position:e.Position,x:e.x,y:e.y}:t?{connection:t,style:e.Style,linkX:e.LinkX,linkY:e.LinkY,inside:e.Inside,autoLink:e.AutoLink,padding:e.Padding,x:e.x,y:e.y}:{style:e.Style,x:e.x,y:e.y}}serializeLineEndpointDefinition(e){if(this.isBlockEndpointDefinition(e)){const t=e.connection.getBoundingBox();return{Style:e.style,x:t.x+t.w*e.linkX,y:t.y+t.h*e.linkY,Block:e.connection.id,LinkX:e.linkX,LinkY:e.linkY,Inside:e.inside,AutoLink:e.autoLink,Padding:e.padding}}return this.isLineEndpointDefinition(e)?Object.assign({Style:e.style,Line:e.connection.id,LineP:e.position},e.connection.getRelativePosition(e.position)):{Style:e.style,x:e.x,y:e.y}}getEndpoint1(){return this.parseLineEndpointDefinition(this.properties.get("Endpoint1"))}getEndpoint2(){return this.parseLineEndpointDefinition(this.properties.get("Endpoint2"))}setEndpoint1(e){this.properties.set("Endpoint1",this.serializeLineEndpointDefinition(e))}setEndpoint2(e){this.properties.set("Endpoint2",this.serializeLineEndpointDefinition(e))}getUpstreamConnection(){return this.getEndpoint1().connection}getDownstreamConnection(){return this.getEndpoint2().connection}getConnectedLines(){return this.client.sendCommand("gcl",this.id).map((e=>this.client.getLineProxy(e)))}getRelativePosition(e){return this.client.sendCommand("grlp",{id:this.id,p:e})}getTextAreaPosition(e){const t=this.properties.get("TextAreas");if((0,n.isObjectUnsafe)(t)){const i=t[e];if((0,a.isSerializedLineTextAreaPositioning)(i))return(0,a.deserializeLineTextAreaPositioning)(i)}}setTextAreaPosition(e,t){this.properties.set("TextAreas",{[e]:(0,a.serializeLineTextAreaPositioning)(t)})}addTextArea(e,t){return this.client.sendCommand("alta",{id:this.id,p:(0,a.serializeLineTextAreaPositioning)(t),t:e})}deleteTextArea(e){this.properties.set("TextAreas",{[e]:null})}getShape(){return this.properties.get("Shape")}setShape(e){this.properties.set("Shape",e)}}t.LineProxy=l},4271:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.serializeLineTextAreaPositioning=t.deserializeLineTextAreaPositioning=t.isSerializedLineTextAreaPositioning=void 0;const n=i(8887);t.isSerializedLineTextAreaPositioning=function(e){return(0,n.isObjectUnsafe)(e)&&(0,n.isNumber)(e.Location)&&(0,n.isNumber)(e.Side)&&((0,n.isBoolean)(e.AllowOverBlock)||(0,n.isUndefined)(e.AllowOverBlock))},t.deserializeLineTextAreaPositioning=function(e){return{location:e.Location,side:e.Side,allowOverBlock:e.AllowOverBlock}},t.serializeLineTextAreaPositioning=function(e){return{Location:e.location,Side:e.side,AllowOverBlock:e.allowOverBlock}}},6394:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WriteableMapProxy=t.MapProxy=void 0;class i{constructor(e,t){this.getKeys=e,this.getItem=t}*[Symbol.iterator](){for(const e of this.keys()){const t=this.get(e);void 0!==t&&(yield[e,t])}}*values(){for(const e of this.keys()){const t=this.get(e);void 0!==t&&(yield t)}}find(e){for(const[t,i]of this)if(e(i,t))return i}filter(e){const t=[];for(const[i,n]of this)e(n,i)&&t.push(n);return t}map(e){const t=[];for(const[i,n]of this)t.push(e(n,i));return t}keys(){return this.getKeys()}get size(){return this.keys().length}get(e){return this.getItem(e)}first(){const e=this.keys();if(0!=e.length)return this.get(e[0])}}t.MapProxy=i,t.WriteableMapProxy=class extends i{constructor(e,t,i){super(e,t),this.setter=i}set(e,t,i={}){return this.setter(e,t,i)}}},4334:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},1971:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PageProxy=void 0;const n=i(4094),o=i(5860),r=i(5980),a=i(4525),s=i(7518),l=i(3912),c=i(6394);class d extends r.ElementProxy{constructor(e,t){super(e,t),this.id=e,this.blocks=new c.MapProxy((()=>this.client.sendCommand("lb",{id:this.id})),(e=>this.client.getBlockProxy(e))),this.lines=new c.MapProxy((()=>this.client.sendCommand("ll",{id:this.id})),(e=>new l.LineProxy(e,this.client))),this.groups=new c.MapProxy((()=>this.client.sendCommand("lg",{id:this.id})),(e=>new a.GroupProxy(e,this.client))),this.allBlocks=new c.MapProxy((()=>this.client.sendCommand("lb",{id:this.id,d:!0})),(e=>this.client.getBlockProxy(e))),this.allLines=new c.MapProxy((()=>this.client.sendCommand("ll",{id:this.id,d:!0})),(e=>new l.LineProxy(e,this.client))),this.allGroups=new c.MapProxy((()=>this.client.sendCommand("lg",{id:this.id,d:!0})),(e=>new a.GroupProxy(e,this.client))),this.allItems=new c.MapProxy((()=>[...this.allBlocks.keys(),...this.allLines.keys(),...this.allGroups.keys()]),(e=>this.client.getItemProxy(e)))}getRulesAppliedToAllItems(){return this.properties.get("ChildRuleList").map((e=>new o.RuleProxy(e,this.client)))}applyRuleToAllItems(e){const t=this.properties.get("ChildRuleList");t.includes(e.id)||(t.push(e.id),this.properties.set("ChildRuleList",t))}unapplyRuleToAllItems(e){const t=this.properties.get("ChildRuleList");t.includes(e.id)&&this.properties.set("ChildRuleList",t.filter((t=>t!==e.id)))}findAvailableSpace(e,t,i,n){const o=this.client.sendCommand("fas",{p:this.id,x:e,y:t,w:i,h:n});return{page:this,x:o.x,y:o.y}}addBlock(e){const t=this.client.sendCommand("cb",{p:this.id,c:e.className,s:e.stencil}),i=this.client.getBlockProxy(t);if(i.setBoundingBox(e.boundingBox),e.properties)for(const t in e.properties)i.properties.set(t,e.properties[t]);return void 0!==e.fillStyle&&i.setFillStyle(e.fillStyle),void 0!==e.lineWidth&&i.setLineWidth(e.lineWidth),i}groupBlocks(e){const t=this.client.sendCommand("cg",{p:this.id,i:e.map((e=>e.id))});return new a.GroupProxy(t,this.client)}addLine(e){const t=this.client.sendCommand("cl",{p:this.id}),i=new l.LineProxy(t,this.client);return i.setEndpoint1(e.endpoint1),i.setEndpoint2(e.endpoint2),i}async addImage(e){return await this.client.loadBlockClasses(["UserImage2Block"]),this.addBlock((0,s.imageToBlockDefinition)(e))}async addDiagramFromMermaid(e,t,i,n){return(await this.client.sendCommand("adfm",{t:e,m:t,o:i,e:n})).map((e=>this.client.getItemProxy(e)))}setTitle(e){this.properties.set("Title",e)}getTitle(){return this.properties.get("Title")}delete(){this.client.sendCommand("dp",this.id)}findItems(e,t){return this.client.sendCommand("gia",{p:this.id,bb:e,s:t}).map((e=>this.client.getItemProxy(e)))}async importLinks(e){return await this.client.sendCommand("il",{p:this.id,l:e})}getLLMContextForItems(e,t=n.GetLLMContextType.Relational){const i=this.client.sendCommand("llm",{p:this.id,i:e.map((e=>e.id)),t});return{prompt:i.p,idToLucidId:new Map(Object.entries(i.id))}}getSvg(e,t=!1,i){return this.client.sendCommand("gsvg",{p:this.id,bb:i,bg:t,i:null==e?void 0:e.map((e=>e.id))})}getPageNumber(){return this.properties.get("Order")}async duplicate(){await this.client.duplicatePages([this.getPageNumber()])}}t.PageProxy=d},8754:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PropertyStoreProxy=void 0;const n=i(6394);t.PropertyStoreProxy=class{constructor(e,t){this.id=e,this.client=t,this.properties=new n.WriteableMapProxy((()=>this.client.sendCommand("lpr",{id:this.id})),(e=>this.client.sendCommand("gp",{id:this.id,p:e})),((e,t)=>{if("BoundingBox"===e)throw new Error("Do not use properties.set() to move or resize items; use setLocation() or setBoundingBox() or offset()");this.client.sendCommand("sp",{id:this.id,p:e,v:t})}))}}},7811:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.serializeEffectDefinition=t.serializeConditionDefinition=void 0;const n=i(2683),o=i(3663),r=i(5141),a=i(1257);t.serializeConditionDefinition=function(e){switch(e.type){case r.ConditionType.Formula:return{Type:e.type,Source:"this",Condition:0,Value:e.formula};case r.ConditionType.Text:return{Type:e.type,Source:"this",Condition:e.condition,Value:e.value};case r.ConditionType.ShapeData:return{Type:e.type,Source:"this",Condition:e.condition,Value:e.value,Label:e.field,DisplayLabel:e.fieldLabel};case r.ConditionType.ShapeType:return{Type:e.type,Source:"this",Condition:e.condition,Value:e.classNames};default:throw new Error("Unsupported ConditionType")}},t.serializeEffectDefinition=function(e,t){var i;return{ConditionOrder:t,Combination:e.combination,FormatType:e.formatType,Formatting:e.formatType===a.RuleFormattingType.FORMATTING?{Block:{FillColor:JSON.stringify(e.formatting.fillColor),LineColor:JSON.stringify(e.formatting.borderColor),LineWidth:JSON.stringify(e.formatting.borderWidth),StrokeStyle:JSON.stringify(e.formatting.borderStyle)},Line:{LineColor:JSON.stringify(e.formatting.lineColor),LineWidth:JSON.stringify(e.formatting.lineWidth),StrokeStyle:JSON.stringify(e.formatting.lineStyle)}}:{},DataGraphic:e.formatType===a.RuleFormattingType.DATA_GRAPHICS?e.dataGraphic.set===o.DataGraphicIconSets.CUSTOM_ICONS?{Set:e.dataGraphic.set,Index:0,Position:(0,n.serializeBadgeEnumPosition)(e.dataGraphic.position),Image:{url:e.dataGraphic.image.url,w:e.dataGraphic.image.width,h:e.dataGraphic.image.height}}:{Set:e.dataGraphic.set,Index:null!==(i=e.dataGraphic.index)&&void 0!==i?i:0,Position:(0,n.serializeBadgeEnumPosition)(e.dataGraphic.position),Color:e.dataGraphic.color}:void 0,Tooltip:e.tooltip}}},3031:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeDataProxy=void 0;const n=i(8887),o=i(2536),r=i(3237),a=i(6633),s=i(6394);class l extends s.WriteableMapProxy{constructor(e,t){super((()=>this.client.sendCommand("lsd",{id:this.id})),(e=>l.parseData(this.client.sendCommand("gsd",{id:this.id,n:e}))),((e,t)=>{if((0,o.isSerializedDataError)(t))throw new Error("Cannot store an error value");this.keys().includes(e)?this.client.sendCommand("ssd",{id:this.id,n:e,v:t}):this.client.sendCommand("asd",{id:this.id,i:r.ShapeDataInheritance.NONE,n:e,v:t})})),this.id=e,this.client=t}addInheritable(e,t){this.client.sendCommand("asd",{id:this.id,i:r.ShapeDataInheritance.VALUE,n:e,v:t})}delete(e){this.keys().includes(e)&&this.client.sendCommand("dsd",{id:this.id,n:e})}static parseData(e){return(0,o.isSerializedDataError)(e)?new a.DataError(e.error,e.type):e}getString(e){const t=this.get(e);return(0,n.isString)(t)?t:""}}t.ShapeDataProxy=l},8752:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPartialTextStyle=t.TextMarkupNames=void 0;const n=i(8887),o=i(2607);var r;!function(e){e.Family="font",e.Bold="bold",e.Italic="italic",e.Underline="underline",e.Size="size",e.Color="color",e.HAlign="align"}(r||(t.TextMarkupNames=r={})),t.isPartialTextStyle=(0,o.partialObjectValidator)({[r.Family]:n.isString,[r.Bold]:n.isBoolean,[r.Italic]:n.isBoolean,[r.Underline]:n.isBoolean,[r.Size]:n.isNumber,[r.Color]:n.isString,[r.HAlign]:n.isString})},490:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EditorClient=void 0;const n=i(4094),o=i(8065),r=i(8887),a=i(4139),s=i(7890),l=i(1859),c=i(9762),d=i(474),u=i(353),p=i(4943),h=i(3281),g=i(5980),m=i(4525),y=i(3912),f=i(1971),S=i(1267);function E(e,t){var i,n,r,a;return Object.assign({url:null!==(i=null==t?void 0:t.url)&&void 0!==i?i:"",status:null!==(n=null==t?void 0:t.s)&&void 0!==n?n:0,headers:null!==(r=null==t?void 0:t.h)&&void 0!==r?r:{},timeout:null==t?void 0:t.to},"utf8"===e?{responseFormat:e,responseText:null!==(a=null==t?void 0:t.t)&&void 0!==a?a:"An unknown error occurred"}:{responseFormat:e,responseData:(null==t?void 0:t.t)?(0,o.decodeBase64)(t.t):new Uint8Array(0)})}t.EditorClient=class{getUniqueActionName(){for(;this.actionExists("a"+this.nextId);)this.nextId++;return"a"+this.nextId}getProduct(){return this.sendCommand("gpr",void 0)}killExtension(){this.sendCommand("k",void 0)}reloadExtension(){this.sendCommand("r",void 0)}download(e,t,i,n){this.sendCommand("d",{f:e,d:t,m:i,b64:n})}async createUserImage(e,t){return(await this.sendCommand("cui",{t:e,d:(0,r.isString)(t)?t:(0,o.encodeBase64)(t)})).u}experimentalCreateUserImage(e,t){return this.createUserImage(e,t)}async performDataAction(e){void 0===e.asynchronous&&(e.asynchronous=!0);const t=await this.sendCommand("da",{fn:e.actionName,a:e.asynchronous,s:e.syncDataSourceIdNonce,fd:e.actionData,n:e.dataConnectorName});return"t"in t?{status:t.c,text:t.t}:{status:t.c,json:t.j}}async showPackageSettingsModal(){return this.sendCommand("spsm",void 0)}async setPackageSettings(e){let t={};if(e instanceof Map)for(const[i,n]of e.entries())t[i]=n;else t=e;return this.sendCommand("sps",t)}async getPackageSettings(){return new Map(Object.entries(await this.sendCommand("gps",void 0)))}async canEditPackageSettings(){return this.sendCommand("ceps",void 0)}async awaitDataImport(e,t,i,n,o=3e4){return new l.CollectionProxy(await this.sendCommand("ai",{n:e,s:t,c:i,pk:n,t:o}),this)}async awaitDataSourceImport(e,t){return await this.sendCommand("adi",{n:e,s:t})}xhr(e){let t;e.streamCallback&&(t=this.getUniqueActionName(),this.registerAction(t,(t=>{var i;return null===(i=e.streamCallback)||void 0===i?void 0:i.call(e,t.d)})));const i=e.responseFormat||"utf8";return this.sendCommand("xhr",{url:e.url,m:e.method,d:e.data,h:e.headers,ms:e.timeoutMs,f:i,s:t}).then((e=>E(i,e))).catch((e=>{const t=(0,n.isRawSendXHRResponse)(e)?e:void 0;throw E(i,t)})).finally((()=>{t&&this.deleteAction(t)}))}asyncOAuthXhr(e,t){const i=t.responseFormat||"utf8";return this.sendCommand("aoauth",Object.assign({url:t.url,m:t.method,d:t.data,h:t.headers,ms:t.timeoutMs,p:e,f:i},t.postResultTo?{prt:t.postResultTo}:{})).then((e=>E(i,e))).catch((e=>{const t=(0,n.isRawSendXHRResponse)(e)?e:void 0;throw E(i,t)}))}oauthXhr(e,t){const i=t.responseFormat||"utf8";return this.sendCommand("oauth",Object.assign({url:t.url,m:t.method,d:t.data,h:t.headers,ms:t.timeoutMs,p:e,f:i},t.postResultTo?{prt:t.postResultTo}:{})).then((e=>E(i,e))).catch((e=>{const t=(0,n.isRawSendXHRResponse)(e)?e:void 0;throw E(i,t)}))}triggerAuthFlow(e){return this.sendCommand("tauth",{p:e})}async getOAuthToken(e){return await this.sendCommand("got",{p:e})}async getOAuthClientId(e){return await this.sendCommand("goci",{p:e})}permanentTokenXhr(e,t){const i=t.responseFormat||"utf8";return this.sendCommand("perm",{url:t.url,m:t.method,d:t.data,h:t.headers,ms:t.timeoutMs,p:e,f:i}).then((e=>E(i,e))).catch((e=>{const t=(0,n.isRawSendXHRResponse)(e)?e:void 0;throw E(i,t)}))}registerAction(e,t){if(this.actionExists(e))throw new Error("Action already exists: "+e);this.callbacks.set(e,t)}registerFileUploadAction(e,t){this.registerAction(e,(e=>{t(e.f.map((e=>e.b?{fileName:e.n,text:e.t,binary:(0,o.decodeBase64)(e.b)}:{fileName:e.n,text:e.t})))}))}registerUnfurlHandler(e,t){const i=this.getUniqueActionName();let n,o;this.registerAction(i,(async e=>{const i=(0,S.deserializeUnfurlEventMessage)(e);try{const e=await t.unfurlCallback(i.url);if(e&&!(0,s.unfurlRefreshErrorTypeValidator)(e))return(0,a.serializeUnfurlDetails)(e)}catch(e){return s.UnfurlRefreshErrorType.GenericFailure}})),t.afterUnfurlCallback&&(n=this.getUniqueActionName(),this.registerAction(n,(async e=>{var i;const n=(0,S.deserializeUnfurlEventMessage)(e);if(n.blockId){const e=this.getBlockProxy(n.blockId);e instanceof u.LinkUnfurlBlockProxy&&await(null===(i=t.afterUnfurlCallback)||void 0===i?void 0:i.call(t,e,n.url))}}))),t.expandCallback&&(o=this.getUniqueActionName(),this.registerAction(o,(async e=>{var i;const n=(0,S.deserializeUnfurlEventMessage)(e);if(n.blockId){const e=this.getBlockProxy(n.blockId);e instanceof u.LinkUnfurlBlockProxy&&await(null===(i=t.expandCallback)||void 0===i?void 0:i.call(t,e,n.url))}}))),this.sendCommand("ru",{d:e,ua:i,aua:n,e:o})}experimentalRegisterUnfurlHandler(e,t){return this.registerUnfurlHandler(e,t)}deleteAction(e){this.callbacks.delete(e)}actionExists(e){return this.callbacks.has(e)}sendCommand(e,t){return lucid.executeCommand(e,t)}getBlockProxy(e){const t=this.sendCommand("gp",{id:e,p:"ClassName"});let i=(0,c.findProxyClass)(t);return i===d.CustomBlockProxy&&(i=d.CustomBlockProxy.getCustomBlockClass(this,e)),i?new i(e,this):new p.BlockProxy(e,this)}loadBlockClasses(e){return this.sendCommand("lbc",e)}async importPage(e,t){return await this.sendCommand("imp",{id:e,n:t})}async duplicatePages(e){return await this.sendCommand("imp",{id:this.sendCommand("gdid",void 0),n:e})}async getCustomShapeDefinition(e,t){await this.loadBlockClasses(["CustomBlock"]);const i=await this.sendCommand("gcs",{l:e,s:t});if(i)return{className:"CustomBlock",boundingBox:i.bb,stencil:i.s,properties:i.p}}async processAndClearBootstrapData(e,t){const i=this.getUniqueActionName();this.registerAction(i,(t=>e(t.d))),await this.sendCommand("b",{c:i,m:t}),this.deleteAction(i)}getLineProxy(e){return new y.LineProxy(e,this)}getPageProxy(e){return new f.PageProxy(e,this)}getItemProxy(e){const t=this.sendCommand("get",{id:e});switch(t){case"block":return this.getBlockProxy(e);case"line":return this.getLineProxy(e);case"group":return new m.GroupProxy(e,this);default:throw new Error("Element "+e+" is not an Item; type found is "+t)}}tryGetItemProxy(e){try{const t=this.getItemProxy(e);if(t.exists())return t}catch(e){}}getElementProxy(e){switch(this.sendCommand("get",{id:e})){case"block":return this.getBlockProxy(e);case"line":return this.getLineProxy(e);case"page":return this.getPageProxy(e);case"document":return new h.DocumentProxy(this);case"group":return new m.GroupProxy(e,this);default:return new g.ElementProxy(e,this)}}listenToEditor(){lucid.listen((e=>{var t;return null===(t=this.callbacks.get(e.id))||void 0===t?void 0:t(e)}))}alert(e,t,i){return this.sendCommand("a",{t,b:e,bt:i})}confirm(e,t,i,n){return this.sendCommand("c",{t,b:e,o:i,c:n})}prompt(e,t){return this.sendCommand("p",{t,b:e})}async withIntraDocumentMutex(e,t){const i=this.getUniqueActionName();this.registerAction(i,t);try{return await this.sendCommand("wm",{n:e,a:i})}finally{this.deleteAction(i)}}withSilentActions(e){const t=this.getUniqueActionName();this.registerAction(t,(()=>{const t=e();if((0,r.isPromise)(t))throw new Error("withSilentActions cannot be used with an async callback")}));try{this.sendCommand("wsa",{a:t})}finally{this.deleteAction(t)}}hash(e,t){return this.sendCommand("hsh",{a:e,s:t})}constructor(){this.nextId=0,this.callbacks=new Map,this.listenToEditor()}}},8966:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),o(i(4094),t),o(i(8065),t),o(i(9730),t),o(i(2797),t),o(i(6805),t),o(i(264),t),o(i(2147),t),o(i(8887),t),o(i(8814),t),o(i(9945),t),o(i(5901),t),o(i(9629),t),o(i(9204),t),o(i(7066),t),o(i(1484),t),o(i(6338),t),o(i(9467),t),o(i(3836),t),o(i(3429),t),o(i(5736),t),o(i(890),t),o(i(3270),t),o(i(7402),t),o(i(8381),t),o(i(703),t),o(i(5449),t),o(i(2597),t),o(i(5082),t),o(i(5043),t),o(i(1113),t),o(i(647),t),o(i(1366),t),o(i(952),t),o(i(2963),t),o(i(440),t),o(i(27),t),o(i(9378),t),o(i(6657),t),o(i(6673),t),o(i(7939),t),o(i(2683),t),o(i(3663),t),o(i(6232),t),o(i(6532),t),o(i(8994),t),o(i(4553),t),o(i(80),t),o(i(5141),t),o(i(1257),t),o(i(2536),t),o(i(3237),t),o(i(5372),t),o(i(943),t),o(i(4785),t),o(i(4139),t),o(i(5265),t),o(i(7890),t),o(i(5593),t),o(i(2607),t),o(i(5746),t),o(i(2942),t),o(i(1859),t),o(i(6633),t),o(i(1354),t),o(i(495),t),o(i(5560),t),o(i(7424),t),o(i(6150),t),o(i(4939),t),o(i(3697),t),o(i(9022),t),o(i(5697),t),o(i(995),t),o(i(595),t),o(i(813),t),o(i(5282),t),o(i(9066),t),o(i(875),t),o(i(5191),t),o(i(4956),t),o(i(9762),t),o(i(8131),t),o(i(474),t),o(i(9570),t),o(i(2412),t),o(i(353),t),o(i(2443),t),o(i(115),t),o(i(1442),t),o(i(4943),t),o(i(3281),t),o(i(5980),t),o(i(4525),t),o(i(4407),t),o(i(6639),t),o(i(3912),t),o(i(4271),t),o(i(6394),t),o(i(4334),t),o(i(1971),t),o(i(8754),t),o(i(3031),t),o(i(8752),t),o(i(490),t),o(i(8966),t),o(i(8042),t),o(i(1267),t),o(i(4782),t),o(i(4487),t),o(i(5874),t),o(i(3724),t),o(i(1707),t),o(i(791),t),o(i(5589),t)},8042:(e,t)=>{function i(e,t){const i=Math.max(e.x,t.x),n=Math.max(e.y,t.y);return{x:i,y:n,w:Math.min(e.x+e.w,t.x+t.w)-i,h:Math.min(e.y+e.h,t.y+t.h)-n}}function n(e){return{x:e.x+e.w/2,y:e.y+e.h/2}}function o(e,t,i){const o=a(e);return i=i||n(e),0!=t?o.map(s(i,t)):o}function r(e,t,i,n){const o=Math.min(e.x,t.x,i.x,n.x),r=Math.max(e.x,t.x,i.x,n.x),a=Math.min(e.y,t.y,i.y,n.y);return{x:o,y:a,w:r-o,h:Math.max(e.y,t.y,i.y,n.y)-a}}function a(e){return[{x:e.x,y:e.y},{x:e.x+e.w,y:e.y},{x:e.x+e.w,y:e.y+e.h},{x:e.x,y:e.y+e.h}]}function s(e,t){const i=Math.cos(t),n=Math.sin(t);return t=>{const o=e.x,r=e.y,a=t.x-o,s=t.y-r;return{x:a*i-s*n+o,y:s*i+a*n+r}}}Object.defineProperty(t,"__esModule",{value:!0}),t.rotateAroundFn=t.toCornersAsArray=t.boxFrom4Points=t.rotateBox=t.rotatedBoundingBox=t.boxCenter=t.clip=t.percentBoxesOverlap=t.boxesOverlap=t.isBoxWithin=t.padBox=t.combinedBoundingBox=void 0,t.combinedBoundingBox=function(e){if(0==e.length)return;let t=Number.MAX_VALUE,i=Number.MAX_VALUE,n=-Number.MAX_VALUE,o=-Number.MAX_VALUE;for(const r of e)t=Math.min(t,r.x),n=Math.max(n,r.x+r.w),i=Math.min(i,r.y),o=Math.max(o,r.y+r.h);return{x:t,y:i,w:n-t,h:o-i}},t.padBox=function(e,t){return{x:e.x-t,y:e.y-t,w:e.w+2*t,h:e.h+2*t}},t.isBoxWithin=function(e,t){return e.x>=t.x&&e.y>=t.y&&e.x+e.w<=t.x+t.w&&e.y+e.h<=t.y+t.h},t.boxesOverlap=function(e,t){return e.x+e.w>=t.x&&e.y+e.h>=t.y&&t.x+t.w>=e.x&&t.y+t.h>=e.y},t.percentBoxesOverlap=function(e,t){const n=i(e,t);return n.w<=0||n.h<=0?0:n.w*n.h/(e.w*e.h)},t.clip=i,t.boxCenter=n,t.rotatedBoundingBox=function(e,t,i){return t?(i=i||n(e),r.apply(null,o(e,t,i))):e},t.rotateBox=o,t.boxFrom4Points=r,t.toCornersAsArray=a,t.rotateAroundFn=s},1267:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.serializeUnfurlEventMessage=t.deserializeUnfurlEventMessage=void 0,t.deserializeUnfurlEventMessage=function(e){return{id:e.id,url:e.u,unfurlCallbackType:e.t,blockId:e.b}},t.serializeUnfurlEventMessage=function(e){return{id:e.id,u:e.url,t:e.unfurlCallbackType,b:e.blockId}}},4782:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AlertModal=void 0;const n=i(3724);class o extends n.Modal{constructor(e,t,i){super(e,{width:300,height:200,title:t,content:`\n<html>\n<head>\n<style type="text/css">\np {\n    font-family: 'Graphik LC Web', sans-serif;\n    font-size:14px;\n    text-align:center;\n}\n</style>\n</head>\n<body>\n<p id="message"></p>\n<script type="text/javascript">\n    var p = document.getElementById('message');\n    p.innerText = ${JSON.stringify(i)};\n<\/script>\n</body>\n</html>\n            `})}}t.AlertModal=o},4487:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IframeUI=t.IncomingUIMessageType=void 0;const n=i(3492);var o;!function(e){e[e.Closed=1]="Closed",e[e.PostMessageFromFrame=2]="PostMessageFromFrame",e[e.FrameLoaded=3]="FrameLoaded",e[e.FramePosition=4]="FramePosition"}(o||(t.IncomingUIMessageType=o={}));class r{constructor(e){this.client=e,this.id=++r.nextId,this.messageActionName=r.uiMessageActionNamePrefix+this.id,this.loaded=!1,this.frameLoadedPromise=(0,n.defer)(),this.framePosition={x:0,y:0,w:1,h:1}}static isUIMessageActionName(e){return e.startsWith(r.uiMessageActionNamePrefix)}hookMessages(){this.client.registerAction(this.messageActionName,(e=>{switch(e.t){case o.Closed:this.loaded=!1,this.frameClosed();break;case o.PostMessageFromFrame:this.messageFromFrame(e.data);break;case o.FramePosition:this.framePosition=e.data;break;case o.FrameLoaded:this.loaded=!0,this.frameLoadedPromise.resolve(),this.frameLoaded()}}))}unhookMessages(){this.client.deleteAction(this.messageActionName)}async sendMessage(e){await this.frameLoadedPromise,this.client.sendCommand("suim",{n:this.messageActionName,d:e})}messageFromFrame(e){}frameLoaded(){}frameClosed(){}}t.IframeUI=r,r.nextId=0,r.uiMessageActionNamePrefix="__ui_message__"},5874:(e,t)=>{var i,n;Object.defineProperty(t,"__esModule",{value:!0}),t.Menu=t.MenuLocation=t.MenuType=void 0,function(e){e[e.Main=1]="Main",e[e.Context=2]="Context",e[e.ContentDock=3]="ContentDock"}(i||(t.MenuType=i={})),function(e){e[e.Extension=1]="Extension",e[e.Edit=2]="Edit",e[e.View=3]="View",e[e.Share=4]="Share",e[e.Export=5]="Export",e[e.Import=6]="Import"}(n||(t.MenuLocation=n={})),t.Menu=class{constructor(e){this.client=e}addMenuItem(e){if(e.action&&!this.client.actionExists(e.action))throw new Error("Unregistered action: "+e.action);if(e.visibleAction&&!this.client.actionExists(e.visibleAction))throw new Error("Unregistered action: "+e.visibleAction);if(e.disabledAction&&!this.client.actionExists(e.disabledAction))throw new Error("Unregistered action: "+e.disabledAction);if(e.menuType==i.ContentDock&&!e.iconUrl)throw new Error("MenuType.ContentDock requires icon url");if(e.menuType==i.ContentDock&&!e.action)throw new Error("MenuType.ContentDock requires action");this.client.sendCommand("ami",{l:e.label,i:e.iconUrl,a:e.action,v:e.visibleAction,d:e.disabledAction,t:e.menuType,loc:e.location,f:e.file?{a:e.file.action,ac:e.file.accept,s:e.file.singleFileOnly,b:e.file.binary}:void 0})}addDropdownMenuItem(e){var t;this.addMenuItem({label:e.label,action:e.action,visibleAction:e.visibleAction,disabledAction:e.disabledAction,menuType:i.Main,location:null!==(t=e.location)&&void 0!==t?t:n.Extension,file:e.file})}addContextMenuItem(e){this.addMenuItem({label:e.label,action:e.action,visibleAction:e.visibleAction,disabledAction:e.disabledAction,menuType:i.Context,location:n.Extension,file:e.file})}addContentDockMenuItem(e){this.addMenuItem({label:e.label,iconUrl:e.iconUrl,action:e.action,visibleAction:e.visibleAction,disabledAction:e.disabledAction,menuType:i.ContentDock,location:n.Extension,file:e.file})}}},3724:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Modal=void 0;const n=i(4487);class o extends n.IframeUI{constructor(e,t){super(e),this.config=t,this.visible=!1}frameClosed(){this.visible=!1,this.unhookMessages()}async show(){this.visible||(this.hookMessages(),await this.client.sendCommand("sm",{n:this.messageActionName,t:this.config.title,w:this.config.width,h:this.config.height,cl:this.config.chromeless,fs:this.config.fullScreen,tb:this.config.transparentBackground,c:this.config.content,u:this.config.url}),this.visible=!0)}hide(){this.visible&&(this.client.sendCommand("hm",{n:this.messageActionName}),this.visible=!1)}}t.Modal=o},1707:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Panel=t.PanelLocation=void 0;const n=i(4487);var o;!function(e){e[e.RightDock=1]="RightDock",e[e.ContentDock=2]="ContentDock",e[e.ImageSearchTab=3]="ImageSearchTab"}(o||(t.PanelLocation=o={}));class r extends n.IframeUI{constructor(e,t){super(e),this.config=t,this.hookMessages(),this.client.sendCommand("rp",{n:this.messageActionName,t:this.config.title,l:this.config.location,c:this.config.content,u:this.config.url,v:this.config.visibleAction,i:this.config.iconUrl,to:this.config.toolTip,p:this.config.persist,w:this.config.width,h:this.config.height})}show(){this.config.location==o.RightDock&&this.client.sendCommand("spn",{n:this.messageActionName})}hide(){this.config.location==o.RightDock&&this.client.sendCommand("hp",{n:this.messageActionName})}}t.Panel=r},791:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Viewport=void 0;const n=i(8887),o=i(6532),r=i(7518),a=i(4407),s=i(1971),l=i(8042);class c{constructor(e){this.client=e}static nextHookName(){return"__viewport__hook"+c.nextHookId++}getSelectedItems(e){return this.client.sendCommand("gs",{d:e}).map((e=>this.client.getElementProxy(e))).filter((e=>e instanceof a.ItemProxy))}setSelectedItems(e){this.client.sendCommand("ss",{i:e.map((e=>e.id))})}findAvailableSpace(e,t){const i=this.client.sendCommand("fas",{w:e,h:t});return{page:new s.PageProxy(i.p,this.client),x:i.x,y:i.y}}getCurrentPage(){const e=this.client.sendCommand("gcp",void 0);return null==e?e:new s.PageProxy(e,this.client)}setCurrentPage(e){this.client.sendCommand("scp",e.id)}getVisibleRect(){return this.client.sendCommand("gvr",void 0)}focusCameraOnItems(e){const t=(0,l.combinedBoundingBox)(e.map((e=>e.getBoundingBox())));t&&e[0]&&this.client.sendCommand("av",{bb:(0,l.padBox)(t,80),p:e[0].getPage().id})}hookTextEdit(e,t){const i=c.nextHookName();return this.client.registerAction(i,(async t=>{const i=this.client.getElementProxy(t.i);if(i instanceof a.ItemProxy){const o=await e(i,t.t,t.v);if((0,n.isBoolean)(o))return o;{const e=c.nextHookName();return this.client.registerAction(e,(t=>(this.client.deleteAction(e),o(t.v)))),e}}return!0})),this.client.sendCommand("hte",{n:i,e:!!t}),i}unhookTextEdit(e){this.client.deleteAction(e),this.client.sendCommand("ute",{n:e})}hookSelection(e){const t=c.nextHookName();return this.client.registerAction(t,(async t=>{const i=t.ids.map((e=>this.client.getElementProxy(e))).filter((e=>e instanceof a.ItemProxy));e(i)})),this.client.sendCommand("hs",{n:t}),t}unhookSelection(e){this.client.deleteAction(e),this.client.sendCommand("us",{n:e})}async startDraggingNewBlock(e){var t;const i=null!==(t=e.properties)&&void 0!==t?t:{};void 0!==e.fillStyle&&(i.FillColor=(0,o.serializeSimpleFill)(e.fillStyle)),void 0!==e.lineWidth&&(i.LineWidth=e.lineWidth);const n=await this.client.sendCommand("sdc",{c:e.className,sz:{w:e.boundingBox.w,h:e.boundingBox.h},p:i,s:e.stencil});return n?this.client.getBlockProxy(n):void 0}async startDraggingNewImage(e){return await this.client.loadBlockClasses(["UserImage2Block"]),await this.startDraggingNewBlock((0,r.imageToBlockDefinition)(e))}cancelDraggingNewBlock(){this.client.sendCommand("cdc",void 0)}cancelDraggingNewImage(){this.cancelDraggingNewBlock()}dragPointerMove(e,t){this.client.sendCommand("dpm",{x:e,y:t})}dragPointerUp(e,t){this.client.sendCommand("dpu",{x:e,y:t})}}t.Viewport=c,c.nextHookId=0},5589:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserProxy=void 0,t.UserProxy=class{constructor(e){this.client=e,this.id=this.client.sendCommand("guid",void 0)}getAccessPermssionOnDocument(){return this.client.sendCommand("gdap",void 0)}}},2827:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ActivitySchema=void 0;const n=i(8966);t.ActivitySchema={fields:[{name:"id",type:n.ScalarFieldTypeEnum.STRING},{name:"name",type:n.ScalarFieldTypeEnum.STRING},{name:"capacity",type:n.ScalarFieldTypeEnum.NUMBER},{name:"inputBufferCapacity",type:n.ScalarFieldTypeEnum.NUMBER},{name:"outputBufferCapacity",type:n.ScalarFieldTypeEnum.NUMBER},{name:"type",type:n.ScalarFieldTypeEnum.STRING}],primaryKey:["id"],fieldLabels:{id:"ID",name:"Name",capacity:"Capacity",inputBufferCapacity:"Input Buffer Capacity",outputBufferCapacity:"Output Buffer Capacity",type:"Type"}}},113:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectorSchema=void 0;const n=i(8966);t.ConnectorSchema={fields:[{name:"id",type:n.ScalarFieldTypeEnum.STRING},{name:"name",type:n.ScalarFieldTypeEnum.STRING},{name:"sourceId",type:n.ScalarFieldTypeEnum.STRING},{name:"targetId",type:n.ScalarFieldTypeEnum.STRING},{name:"probability",type:n.ScalarFieldTypeEnum.NUMBER},{name:"connectType",type:n.ScalarFieldTypeEnum.STRING},{name:"type",type:n.ScalarFieldTypeEnum.STRING}],primaryKey:["id"],fieldLabels:{id:"ID",name:"Name",sourceId:"Source",targetId:"Target",probability:"Probability",connectType:"Connection Type",type:"Type"}}},617:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EntitySchema=void 0;const n=i(8966);t.EntitySchema={fields:[{name:"id",type:n.ScalarFieldTypeEnum.STRING},{name:"name",type:n.ScalarFieldTypeEnum.STRING},{name:"type",type:n.ScalarFieldTypeEnum.STRING}],primaryKey:["id"],fieldLabels:{id:"ID",name:"Name",type:"Type"}}},6507:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GeneratorSchema=void 0;const n=i(8966);t.GeneratorSchema={fields:[{name:"id",type:n.ScalarFieldTypeEnum.STRING},{name:"name",type:n.ScalarFieldTypeEnum.STRING},{name:"activityKeyId",type:n.ScalarFieldTypeEnum.STRING},{name:"entityId",type:n.ScalarFieldTypeEnum.STRING},{name:"periodicOccurrences",type:n.ScalarFieldTypeEnum.NUMBER},{name:"periodIntervalDuration",type:n.ScalarFieldTypeEnum.STRING},{name:"entitiesPerCreation",type:n.ScalarFieldTypeEnum.NUMBER},{name:"periodicStartDuration",type:n.ScalarFieldTypeEnum.STRING},{name:"maxEntities",type:n.ScalarFieldTypeEnum.NUMBER},{name:"type",type:n.ScalarFieldTypeEnum.STRING}],primaryKey:["id"],fieldLabels:{id:"ID",name:"Name",activityKeyId:"Activity Key",entityId:"Entity",periodicOccurrences:"Periodic Occurrences",periodIntervalDuration:"Period Interval",entitiesPerCreation:"Entities Per Creation",periodicStartDuration:"Periodic Start Duration",maxEntities:"Max Entities",type:"Type"}}},1669:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ModelDataSource=t.MODEL_COLLECTIONS=void 0;const n=i(6643),o=i(2827),r=i(9682),a=i(617),s=i(6507),l=i(113),c=i(9025),d=i(8269),u=i(3428),p=i(7083),h=i(6491);t.MODEL_COLLECTIONS={MODEL:"model",ACTIVITIES:"activities",RESOURCES:"resources",ENTITIES:"entities",GENERATORS:"generators",CONNECTORS:"connectors",OPERATION_STEPS:"operationSteps",RESOURCE_REQUIREMENTS:"resourceRequirements",REQUIREMENT_CLAUSES:"requirementClauses",RESOURCE_REQUESTS:"resourceRequests"};class g extends h.QuodsiLogger{constructor(e){super(),this.data=e,this.LOG_PREFIX="[ModelDataSource]",this.collectionIds={},this.setLogging(!0)}createModelDataSource(e,i={}){this.log(`Creating data source for model ${e}`);const h=this.data.addDataSource(`model_${e}`,i);if(!h)return this.logError("Failed to create data source"),null;try{this.log(`Adding ${t.MODEL_COLLECTIONS.MODEL} collection`);const e=h.addCollection(t.MODEL_COLLECTIONS.MODEL,n.ModelSchema);this.collectionIds[t.MODEL_COLLECTIONS.MODEL]=(null==e?void 0:e.id)||"",this.log(`Model collection created with ID: ${this.collectionIds[t.MODEL_COLLECTIONS.MODEL]}`),this.log(`Adding ${t.MODEL_COLLECTIONS.ACTIVITIES} collection`);const i=h.addCollection(t.MODEL_COLLECTIONS.ACTIVITIES,o.ActivitySchema);this.collectionIds[t.MODEL_COLLECTIONS.ACTIVITIES]=(null==i?void 0:i.id)||"",this.log(`Activities collection created with ID: ${this.collectionIds[t.MODEL_COLLECTIONS.ACTIVITIES]}`),this.log(`Adding ${t.MODEL_COLLECTIONS.RESOURCES} collection`);const g=h.addCollection(t.MODEL_COLLECTIONS.RESOURCES,r.ResourceSchema);this.collectionIds[t.MODEL_COLLECTIONS.RESOURCES]=(null==g?void 0:g.id)||"",this.log(`Resources collection created with ID: ${this.collectionIds[t.MODEL_COLLECTIONS.RESOURCES]}`),this.log(`Adding ${t.MODEL_COLLECTIONS.ENTITIES} collection`);const m=h.addCollection(t.MODEL_COLLECTIONS.ENTITIES,a.EntitySchema);this.collectionIds[t.MODEL_COLLECTIONS.ENTITIES]=(null==m?void 0:m.id)||"",this.log(`Entities collection created with ID: ${this.collectionIds[t.MODEL_COLLECTIONS.ENTITIES]}`),this.log(`Adding ${t.MODEL_COLLECTIONS.GENERATORS} collection`);const y=h.addCollection(t.MODEL_COLLECTIONS.GENERATORS,s.GeneratorSchema);this.collectionIds[t.MODEL_COLLECTIONS.GENERATORS]=(null==y?void 0:y.id)||"",this.log(`Generators collection created with ID: ${this.collectionIds[t.MODEL_COLLECTIONS.GENERATORS]}`),this.log(`Adding ${t.MODEL_COLLECTIONS.CONNECTORS} collection`);const f=h.addCollection(t.MODEL_COLLECTIONS.CONNECTORS,l.ConnectorSchema);this.collectionIds[t.MODEL_COLLECTIONS.CONNECTORS]=(null==f?void 0:f.id)||"",this.log(`Connectors collection created with ID: ${this.collectionIds[t.MODEL_COLLECTIONS.CONNECTORS]}`),this.log(`Adding ${t.MODEL_COLLECTIONS.OPERATION_STEPS} collection`);const S=h.addCollection(t.MODEL_COLLECTIONS.OPERATION_STEPS,c.OperationStepSchema);this.collectionIds[t.MODEL_COLLECTIONS.OPERATION_STEPS]=(null==S?void 0:S.id)||"",this.log(`Operation steps collection created with ID: ${this.collectionIds[t.MODEL_COLLECTIONS.OPERATION_STEPS]}`),this.log(`Adding ${t.MODEL_COLLECTIONS.RESOURCE_REQUIREMENTS} collection`);const E=h.addCollection(t.MODEL_COLLECTIONS.RESOURCE_REQUIREMENTS,d.ResourceRequirementSchema);this.collectionIds[t.MODEL_COLLECTIONS.RESOURCE_REQUIREMENTS]=(null==E?void 0:E.id)||"",this.log(`Resource requirements collection created with ID: ${this.collectionIds[t.MODEL_COLLECTIONS.RESOURCE_REQUIREMENTS]}`),this.log(`Adding ${t.MODEL_COLLECTIONS.REQUIREMENT_CLAUSES} collection`);const v=h.addCollection(t.MODEL_COLLECTIONS.REQUIREMENT_CLAUSES,u.RequirementClauseSchema);this.collectionIds[t.MODEL_COLLECTIONS.REQUIREMENT_CLAUSES]=(null==v?void 0:v.id)||"",this.log(`Requirement clauses collection created with ID: ${this.collectionIds[t.MODEL_COLLECTIONS.REQUIREMENT_CLAUSES]}`),this.log(`Adding ${t.MODEL_COLLECTIONS.RESOURCE_REQUESTS} collection`);const T=h.addCollection(t.MODEL_COLLECTIONS.RESOURCE_REQUESTS,p.ResourceRequestSchema);this.collectionIds[t.MODEL_COLLECTIONS.RESOURCE_REQUESTS]=(null==T?void 0:T.id)||"",this.log(`Resource requests collection created with ID: ${this.collectionIds[t.MODEL_COLLECTIONS.RESOURCE_REQUESTS]}`),this.log("Collection IDs:",this.collectionIds)}catch(e){return this.logError("Error creating collections:",e),null}return{source:h,collectionIds:this.collectionIds}}getModelDataSource(e){this.log(`Getting data source for model ${e}`);const t=this.data.dataSources.get(`model_${e}`);return this.log("Data source found:",!!t),t}getCollectionId(e){return this.collectionIds[e]||""}}t.ModelDataSource=g},6643:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ModelSchema=void 0;const n=i(8966);t.ModelSchema={fields:[{name:"id",type:n.ScalarFieldTypeEnum.STRING},{name:"name",type:n.ScalarFieldTypeEnum.STRING},{name:"reps",type:n.ScalarFieldTypeEnum.NUMBER},{name:"forecastDays",type:n.ScalarFieldTypeEnum.NUMBER},{name:"seed",type:n.ScalarFieldTypeEnum.NUMBER},{name:"oneClockUnit",type:n.ScalarFieldTypeEnum.STRING},{name:"simulationTimeType",type:n.ScalarFieldTypeEnum.STRING},{name:"warmupClockPeriod",type:n.ScalarFieldTypeEnum.NUMBER},{name:"warmupClockPeriodUnit",type:n.ScalarFieldTypeEnum.STRING},{name:"runClockPeriod",type:n.ScalarFieldTypeEnum.NUMBER},{name:"runClockPeriodUnit",type:n.ScalarFieldTypeEnum.STRING},{name:"warmupDateTime",type:n.ScalarFieldTypeEnum.STRING},{name:"startDateTime",type:n.ScalarFieldTypeEnum.STRING},{name:"finishDateTime",type:n.ScalarFieldTypeEnum.STRING},{name:"type",type:n.ScalarFieldTypeEnum.STRING}],primaryKey:["id"],fieldLabels:{id:"ID",name:"Name",reps:"Repetitions",forecastDays:"Forecast Days",seed:"Random Seed",oneClockUnit:"Clock Unit",simulationTimeType:"Time Type",warmupClockPeriod:"Warmup Period",warmupClockPeriodUnit:"Warmup Period Unit",runClockPeriod:"Run Period",runClockPeriodUnit:"Run Period Unit",warmupDateTime:"Warmup Date/Time",startDateTime:"Start Date/Time",finishDateTime:"Finish Date/Time",type:"Type"}}},9025:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OperationStepSchema=void 0;const n=i(8966);t.OperationStepSchema={fields:[{name:"id",type:n.ScalarFieldTypeEnum.STRING},{name:"requirementId",type:n.ScalarFieldTypeEnum.STRING},{name:"quantity",type:n.ScalarFieldTypeEnum.NUMBER},{name:"duration",type:n.ScalarFieldTypeEnum.STRING},{name:"activityId",type:n.ScalarFieldTypeEnum.STRING}],primaryKey:["id"],fieldLabels:{id:"ID",requirementId:"Requirement",quantity:"Quantity",duration:"Duration",activityId:"Activity"}}},3428:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RequirementClauseSchema=void 0;const n=i(8966);t.RequirementClauseSchema={fields:[{name:"id",type:n.ScalarFieldTypeEnum.STRING},{name:"mode",type:n.ScalarFieldTypeEnum.STRING},{name:"parentClauseId",type:n.ScalarFieldTypeEnum.STRING},{name:"requirementId",type:n.ScalarFieldTypeEnum.STRING}],primaryKey:["id"],fieldLabels:{id:"ID",mode:"Mode",parentClauseId:"Parent Clause",requirementId:"Resource Requirement"}}},7083:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceRequestSchema=void 0;const n=i(8966);t.ResourceRequestSchema={fields:[{name:"id",type:n.ScalarFieldTypeEnum.STRING},{name:"resourceId",type:n.ScalarFieldTypeEnum.STRING},{name:"quantity",type:n.ScalarFieldTypeEnum.NUMBER},{name:"priority",type:n.ScalarFieldTypeEnum.NUMBER},{name:"keepResource",type:n.ScalarFieldTypeEnum.BOOLEAN},{name:"clauseId",type:n.ScalarFieldTypeEnum.STRING}],primaryKey:["id"],fieldLabels:{id:"ID",resourceId:"Resource",quantity:"Quantity",priority:"Priority",keepResource:"Keep Resource",clauseId:"Requirement Clause"}}},8269:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceRequirementSchema=void 0;const n=i(8966);t.ResourceRequirementSchema={fields:[{name:"id",type:n.ScalarFieldTypeEnum.STRING},{name:"name",type:n.ScalarFieldTypeEnum.STRING},{name:"type",type:n.ScalarFieldTypeEnum.STRING}],primaryKey:["id"],fieldLabels:{id:"ID",name:"Name",type:"Type"}}},9682:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceSchema=void 0;const n=i(8966);t.ResourceSchema={fields:[{name:"id",type:n.ScalarFieldTypeEnum.STRING},{name:"name",type:n.ScalarFieldTypeEnum.STRING},{name:"capacity",type:n.ScalarFieldTypeEnum.NUMBER},{name:"type",type:n.ScalarFieldTypeEnum.STRING}],primaryKey:["id"],fieldLabels:{id:"ID",name:"Name",capacity:"Capacity",type:"Type"}}},4481:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ModelDefinitionPageBuilder=void 0;const n=i(6491);t.ModelDefinitionPageBuilder=class{constructor(e){this.storageAdapter=e,this.loggingEnabled=!0}setLogging(e){this.loggingEnabled=e,this.log("Logging "+(e?"enabled":"disabled"))}isLoggingEnabled(){return this.loggingEnabled}log(e,t="log"){this.isLoggingEnabled()&&console[t](`[${this.constructor.name}] ${e}`)}buildFromConvertedPage(e){try{this.log(`Starting model definition build for page ${e.id}`),this.log(`Page title: ${e.getTitle()}`);const t=this.storageAdapter.getElementData(e);if(!t)return this.log("No model data found on page","error"),null;this.log(`Found model data with ID: ${t.id}`);const i=new n.ModelDefinition(t);if(!i.activities||"function"!=typeof i.activities.add)return this.log("ModelDefinition activities not properly initialized","error"),null;if(!i.connectors||"function"!=typeof i.connectors.add)return this.log("ModelDefinition connectors not properly initialized","error"),null;if(!i.resources||"function"!=typeof i.resources.add)return this.log("ModelDefinition resources not properly initialized","error"),null;if(!i.resourceRequirements||"function"!=typeof i.resourceRequirements.add)return this.log("ModelDefinition resourceRequirements not properly initialized","error"),null;if(!i.generators||"function"!=typeof i.generators.add)return this.log("ModelDefinition generators not properly initialized","error"),null;if(!i.entities||"function"!=typeof i.entities.add)return this.log("ModelDefinition entities not properly initialized","error"),null;this.log(`Processing ${e.allBlocks.size} blocks`);for(const[t,o]of e.allBlocks){this.log(`Processing block ${t}`);const e=this.storageAdapter.getElementData(o),r=this.storageAdapter.getMetadata(o);if(e&&r)try{switch(this.log(`Block ${t} type: ${r.type}`),r.type){case n.SimulationObjectType.Activity:i.activities.add(e),this.log(`Added activity ${t}`);break;case n.SimulationObjectType.Generator:i.generators.add(e),this.log(`Added generator ${t}`);break;case n.SimulationObjectType.Resource:const o=e;i.resources.add(o);const a=n.ResourceRequirement.createForSingleResource(o);this.log(`requirement name ${a.name}`),i.resourceRequirements.add(a),this.log(`Added resource ${t} for resource ${o.name}`);break;case n.SimulationObjectType.Entity:i.entities.add(e),this.log(`Added entity ${t}`);break;default:this.log(`Unknown type ${r.type} for block ${t}`,"warn")}}catch(e){this.log(`Error adding ${r.type} ${t}: ${e instanceof Error?e.message:"Unknown error"}`,"error")}else this.log(`Missing data or metadata for block ${t}`,"warn")}this.log(`Processing ${e.allLines.size} lines`);for(const[t,o]of e.allLines){this.log(`Processing line ${t}`);const e=this.storageAdapter.getElementData(o),r=this.storageAdapter.getMetadata(o);if(e&&r)if(r.type===n.SimulationObjectType.Connector)try{i.connectors.add(e),this.log(`Added connector ${t} from ${e.sourceId} to ${e.targetId}`)}catch(e){this.log(`Error adding connector ${t}: ${e instanceof Error?e.message:"Unknown error"}`,"error")}else this.log(`Unexpected type ${r.type} for line ${t}`,"warn");else this.log(`Missing data or metadata for line ${t}`,"warn")}return this.logModelDefinitionSummary(i),i}catch(e){return this.log(`Error building ModelDefinition: ${e instanceof Error?e.message:"Unknown error"}`,"error"),null}}logModelDefinitionSummary(e){this.isLoggingEnabled()&&(this.log("Model Definition Summary:"),this.log(`- Model ID: ${e.id}`),this.log(`- Model Name: ${e.name}`),this.log(`- Activities: ${e.activities.size()}`),this.log(`- Generators: ${e.generators.size()}`),this.log(`- Resources: ${e.resources.size()}`),this.log(`- Requirements: ${e.resourceRequirements.size()}`),this.log(`- Entities: ${e.entities.size()}`),this.log(`- Connectors: ${e.connectors.size()}`))}}},3019:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ModelManager=void 0;const n=i(7597),o=i(6491),r=i(8966),a=i(4481),s=i(8348);class l{constructor(e){this.loggingEnabled=!1,this.modelDefinition=null,this.currentPage=null,this.currentValidationResult=null,this.changeTracker={modelDefinitionDirty:!1,validationDirty:!1,lastModelDefinitionUpdate:0,lastValidationUpdate:0,pendingChanges:new Set},this.storageAdapter=e,this.validationService=new n.ModelValidationService,this.log("ModelManager initialized")}setLogging(e){this.loggingEnabled=e,this.log("Logging "+(e?"enabled":"disabled"))}isLoggingEnabled(){return this.loggingEnabled}log(e,...t){this.isLoggingEnabled()&&console.log(`${l.LOG_PREFIX} ${e}`,...t)}logError(e,...t){this.isLoggingEnabled()&&console.error(`${l.LOG_PREFIX} ${e}`,...t)}markModelDirty(e){this.changeTracker.modelDefinitionDirty=!0,this.changeTracker.validationDirty=!0,e&&this.changeTracker.pendingChanges.add(e)}checkCacheTimeouts(){const e=Date.now();e-this.changeTracker.lastModelDefinitionUpdate>l.MODEL_DEF_CACHE_TIMEOUT&&(this.changeTracker.modelDefinitionDirty=!0),e-this.changeTracker.lastValidationUpdate>l.VALIDATION_CACHE_TIMEOUT&&(this.changeTracker.validationDirty=!0)}async ensureModelDefinition(){if(this.checkCacheTimeouts(),this.changeTracker.modelDefinitionDirty&&this.currentPage){this.log("Rebuilding ModelDefinition due to pending changes:",Array.from(this.changeTracker.pendingChanges));const e=new a.ModelDefinitionPageBuilder(this.storageAdapter);try{const t=e.buildFromConvertedPage(this.currentPage);if(!t)throw new Error("Builder returned null ModelDefinition");if(!(t instanceof o.ModelDefinition))throw new Error("Invalid ModelDefinition type: "+typeof t);if(!t.activities)throw new Error("activities property is undefined");if(!(t.activities instanceof o.ActivityListManager))throw new Error("activities is not an ActivityListManager: "+typeof t.activities);if("function"!=typeof t.activities.add)throw new Error("activities.add is not a function: "+typeof t.activities.add);return this.modelDefinition=t,this.changeTracker.modelDefinitionDirty=!1,this.changeTracker.lastModelDefinitionUpdate=Date.now(),this.changeTracker.pendingChanges.clear(),this.modelDefinition}catch(e){throw this.logError("Error ensuring ModelDefinition:",e),e}}return this.modelDefinition}async initializeModel(e,t){this.currentPage=t,this.markModelDirty(),await this.ensureModelDefinition(),this.storageAdapter.setElementData(t,e,o.SimulationObjectType.Model),await this.validateModel()}async registerElement(e,t){if(e.type===o.SimulationObjectType.Model)return this.modelDefinition=new o.ModelDefinition(e),void this.markModelDirty();const i=await this.ensureModelDefinition();if(!i)throw new Error("Model not initialized");const n=`New ${e.type}`;switch(e.type){case o.SimulationObjectType.Activity:e.name===n&&(e.name=i.activities.getNextName()),i.activities.add(e);break;case o.SimulationObjectType.Connector:e.name===n&&(e.name=i.connectors.getNextName()),i.connectors.add(e);break;case o.SimulationObjectType.Generator:e.name===n&&(e.name=i.generators.getNextName()),i.generators.add(e);break;case o.SimulationObjectType.Resource:e.name===n&&(e.name=i.resources.getNextName());const t=e;i.resources.add(t);const r=o.ResourceRequirement.createForSingleResource(t);i.resourceRequirements.add(r);break;case o.SimulationObjectType.Entity:e.name===n&&(e.name=i.entities.getNextName()),i.entities.add(e);break;default:throw new Error(`Unknown element type: ${e.type}`)}this.markModelDirty(e.id),await this.validateModelIfNeeded()}async updateElement(e){const t=await this.ensureModelDefinition();if(!t||!this.currentPage)throw new Error("Model not initialized");const i=this.findElementProxy(e.id);if(!i)throw new Error(`No element found for ID: ${e.id}`);switch(e.type){case o.SimulationObjectType.Activity:t.activities.add(e);break;case o.SimulationObjectType.Connector:t.connectors.add(e);break;case o.SimulationObjectType.Generator:t.generators.add(e);break;case o.SimulationObjectType.Resource:const i=e,n=o.ResourceRequirement.createForSingleResource(i);t.resources.add(i),t.resourceRequirements.add(n);break;case o.SimulationObjectType.Entity:t.entities.add(e)}this.storageAdapter.updateElementData(i,e),this.markModelDirty(e.id),await this.validateModelIfNeeded()}async removeElement(e){const t=await this.ensureModelDefinition();if(!t||!this.currentPage)return;const i=this.findElementProxy(e);i?(t.activities.remove(e),t.connectors.remove(e),t.generators.remove(e),t.resources.remove(e),t.entities.remove(e),t.resourceRequirements.remove(e),this.storageAdapter.clearElementData(i),this.markModelDirty(e),await this.validateModelIfNeeded()):console.warn(`No element found for ID: ${e}`)}async validateModelIfNeeded(){return this.checkCacheTimeouts(),this.changeTracker.validationDirty?await this.validateModel():this.currentValidationResult}async validateModel(){const e=await this.ensureModelDefinition();if(!e)return this.currentValidationResult={isValid:!1,errorCount:1,warningCount:0,messages:[{type:"error",message:"No model initialized"}]},this.currentValidationResult;const t=await this.validationService.validate(e),i=t.messages.filter((e=>"error"===e.type)).length,n=t.messages.filter((e=>"warning"===e.type)).length;return this.currentValidationResult=Object.assign(Object.assign({},t),{errorCount:i,warningCount:n}),this.changeTracker.validationDirty=!1,this.changeTracker.lastValidationUpdate=Date.now(),this.currentValidationResult}findElementProxy(e){return this.currentPage?this.currentPage.allBlocks.get(e)||this.currentPage.allLines.get(e):null}getModel(){var e,t;return null!==(t=null===(e=this.modelDefinition)||void 0===e?void 0:e.model)&&void 0!==t?t:null}async getModelDefinition(){return await this.ensureModelDefinition()}getCurrentValidation(){return this.currentValidationResult}getElementById(e){if(this.modelDefinition)return this.modelDefinition.activities.get(e)||this.modelDefinition.connectors.get(e)||this.modelDefinition.generators.get(e)||this.modelDefinition.resources.get(e)||this.modelDefinition.resourceRequirements.get(e)||this.modelDefinition.entities.get(e)}getElementsByType(e){if(!this.modelDefinition)return[];switch(e){case o.SimulationObjectType.Activity:return this.modelDefinition.activities.getAll();case o.SimulationObjectType.Connector:return this.modelDefinition.connectors.getAll();case o.SimulationObjectType.Generator:return this.modelDefinition.generators.getAll();case o.SimulationObjectType.Resource:return this.modelDefinition.resources.getAll();case o.SimulationObjectType.ResourceRequirement:return this.modelDefinition.resourceRequirements.getAll();case o.SimulationObjectType.Entity:return this.modelDefinition.entities.getAll();default:return[]}}clear(){if(this.modelDefinition&&this.currentPage){for(const[,e]of this.currentPage.allBlocks)this.storageAdapter.clearElementData(e);for(const[,e]of this.currentPage.allLines)this.storageAdapter.clearElementData(e)}this.modelDefinition=null,this.currentPage=null,this.currentValidationResult=null,this.changeTracker={modelDefinitionDirty:!1,validationDirty:!1,lastModelDefinitionUpdate:0,lastValidationUpdate:0,pendingChanges:new Set}}isQuodsiModel(e){return this.storageAdapter.isQuodsiModel(e)}getElementData(e){return this.storageAdapter.getElementData(e)}getMetadata(e){return this.storageAdapter.getMetadata(e)}setElementData(e,t,i,n){const o=n||{id:e.id,version:this.storageAdapter.CURRENT_VERSION};this.storageAdapter.setElementData(e,t,i,o),this.markModelDirty(e.id)}clearElementData(e){this.storageAdapter.clearElementData(e),this.markModelDirty(e.id)}get CURRENT_VERSION(){return this.storageAdapter.CURRENT_VERSION}setExpandedNodes(e,t){this.storageAdapter.setExpandedNodes(e,t)}getExpandedNodes(e){return this.storageAdapter.getExpandedNodes(e)}removeModelFromPage(e){if(!e)throw new Error("No page provided for model removal");try{this.storageAdapter.clearAllModelData(e),this.clear()}catch(e){throw this.logError("[ModelManager] Error removing model:",e),new Error(`Failed to remove model: ${e instanceof Error?e.message:String(e)}`)}}getStorageAdapter(){return this.storageAdapter}findPathToNode(e,t){const i=new Set;return this.findPathToNodeRecursive(e.elements,t,i),i}findPathToNodeRecursive(e,t,i){var n;for(const o of e){if(o.id===t)return!0;if((null===(n=o.children)||void 0===n?void 0:n.length)&&this.findPathToNodeRecursive(o.children,t,i))return i.add(o.id),!0}return!1}isUnconvertedElement(e){return null===this.getElementData(e)}async saveElementData(e,t,i,n){i!==o.SimulationObjectType.None?!i||t&&0!==Object.keys(t).length?await this.handleDataUpdate(e,t,i,n):await this.handleTypeConversion(e,i,n):this.getElementById(e.id)&&this.removeElement(e.id)}async handleTypeConversion(e,t,i){if(!this.getModel()){const e={id:i.id,name:i.getTitle()||"New Model",type:o.SimulationObjectType.Model};await this.initializeModel(e,i)}const n=this.getDefaultElementName(e),r={id:e.id,type:t,name:n};this.registerElement(r,e),this.setElementData(e,r,t,{id:e.id,version:this.CURRENT_VERSION})}async handleDataUpdate(e,t,i,n){if(!this.getModel()){const e={id:n.id,name:n.getTitle()||"New Model",type:o.SimulationObjectType.Model};await this.initializeModel(e,n)}const r=this.getDefaultElementName(e),a=Object.assign(Object.assign({id:e.id,type:i},t),{name:t&&"object"==typeof t&&!Array.isArray(t)&&"name"in t&&t.name||r});this.registerElement(a,e),this.setElementData(e,a,i,{id:e.id,version:this.CURRENT_VERSION})}getDefaultElementName(e){return e instanceof r.BlockProxy?e.id||"Unnamed Block":"Unnamed Connector"}async getModelStructure(){const e=await this.getModelDefinition();if(e)return s.ModelStructureBuilder.buildModelStructure(e)}}t.ModelManager=l,l.LOG_PREFIX="[ModelManager]",l.VALIDATION_CACHE_TIMEOUT=5e3,l.MODEL_DEF_CACHE_TIMEOUT=1e4},7923:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StorageAdapter=void 0;const n=i(6491);class o{constructor(){this.loggingEnabled=!1,this.log("StorageAdapter initialized")}setLogging(e){this.loggingEnabled=e,this.log("Logging "+(e?"enabled":"disabled"))}isLoggingEnabled(){return this.loggingEnabled}log(e,...t){this.isLoggingEnabled()&&console.log(`${o.LOG_PREFIX} ${e}`,...t)}logError(e,...t){this.isLoggingEnabled()&&console.error(`${o.LOG_PREFIX} ${e}`,...t)}isQuodsiModel(e){try{const t=this.getMetadata(e);return null!==t&&t.type===n.SimulationObjectType.Model}catch(e){return this.logError("Error checking model status:",e),!1}}getExpandedNodes(e){try{this.log("Getting expanded nodes for page:",e.id);const t=e.shapeData.get(o.EXPANDED_NODES_KEY);if(!t||"string"!=typeof t)return this.log("No expanded nodes found"),[];const i=JSON.parse(t);return this.log("Retrieved expanded nodes:",i),i}catch(e){return this.logError("Error getting expanded nodes:",e),[]}}setExpandedNodes(e,t){try{this.log("Setting expanded nodes for page:",{pageId:e.id,nodes:t});const i=JSON.stringify(t);e.shapeData.set(o.EXPANDED_NODES_KEY,i),this.log("Successfully set expanded nodes")}catch(e){throw this.logError("Error setting expanded nodes:",e),e}}setSimulationStatus(e,t){try{this.log("Setting simulation status for page:",{pageId:e.id,status:t});const i=JSON.stringify(t);e.shapeData.set(o.SIMULATION_STATUS_KEY,i),this.log("Successfully set simulation status")}catch(e){throw this.logError("Error setting simulation status:",e),e}}getSimulationStatus(e){try{this.log("Getting simulation status for page:",e.id);const t=e.shapeData.get(o.SIMULATION_STATUS_KEY);if(!t||"string"!=typeof t)return this.log("No simulation status found"),null;const i=JSON.parse(t);return this.log("Retrieved simulation status:",i),i}catch(e){return this.logError("Error getting simulation status:",e),null}}clearSimulationStatus(e){try{e.shapeData.delete(o.SIMULATION_STATUS_KEY),this.log("Successfully cleared simulation status")}catch(e){throw this.logError("Error clearing simulation status:",e),e}}clearExpandedNodes(e){try{e.shapeData.delete(o.EXPANDED_NODES_KEY),this.log("Successfully cleared expanded nodes")}catch(e){throw this.logError("Error clearing expanded nodes:",e),e}}setElementData(e,t,i,n={}){try{const r={type:i,version:n.version||this.CURRENT_VERSION,lastModified:(new Date).toISOString(),id:t.id},a=this.stripMetadataFields(t),s=JSON.stringify(a),l=JSON.stringify(r);e.shapeData.set(o.DATA_KEY,s),e.shapeData.set(o.META_KEY,l),this.log("Successfully set element data:",{elementId:t.id,type:i,dataKeys:Object.keys(a)})}catch(e){throw this.logError("Error setting element data:",e),e}}updateElementData(e,t){try{const i=this.getMetadata(e);if(!i)throw new Error("No metadata found for element");const n=this.stripMetadataFields(t),r=JSON.stringify(n);e.shapeData.set(o.DATA_KEY,r),i.lastModified=(new Date).toISOString();const a=JSON.stringify(i);e.shapeData.set(o.META_KEY,a),this.log("Successfully updated element data:",{elementId:t.id,type:i.type})}catch(e){throw this.logError("Error updating element data:",e),new Error(`Failed to update element data: ${e instanceof Error?e.message:"Unknown error"}`)}}stripMetadataFields(e){const t=Object.assign({},e);return["version","type","lastModified"].forEach((e=>{delete t[e]})),t}getMetadata(e){try{const t=e.shapeData.get(o.META_KEY);return t&&"string"==typeof t?JSON.parse(t):null}catch(e){return this.logError("Error getting metadata:",e),null}}getElementData(e){try{this.log("Getting element data:",{elementId:e.id,elementType:typeof e,contextInfo:"Attempting to retrieve stored data"});const t=e.shapeData.get(o.DATA_KEY);if(this.log("Raw data string:",{exists:!!t,isString:"string"==typeof t,valueType:typeof t,preview:"string"==typeof t?`${t.slice(0,100)}${t.length>100?"...":""}`:String(t)}),!t||"string"!=typeof t)return this.log("No valid data found for element:",e.id),null;const i=JSON.parse(t);return this.log("Successfully parsed element data:",{elementId:e.id,parsedDataKeys:Object.keys(i),timestamp:(new Date).toISOString()}),i}catch(t){return this.logError("Error getting element data:",{elementId:e.id,error:t instanceof Error?t.message:"Unknown error",stack:t instanceof Error?t.stack:void 0,timestamp:(new Date).toISOString()}),null}}getCompleteStorage(e){try{const t=this.getMetadata(e),i=this.getElementData(e);return t&&i?{data:i,meta:t}:null}catch(e){return this.logError("Error getting complete storage:",e),null}}clearElementData(e){try{const t=[o.DATA_KEY,o.META_KEY];for(const i of t)if(void 0!==e.shapeData.get(i)){try{e.shapeData.delete(i)}catch(t){e.shapeData.set(i,"")}this.log(`Cleared ${i} from element:`,e.id)}else this.log(`No ${i} found on element:`,e.id)}catch(e){throw this.logError("Error clearing element data:",e),new Error(`Failed to clear element data: ${e instanceof Error?e.message:"Unknown error"}`)}}validateStorage(e){try{const t=e.shapeData.get(o.DATA_KEY),i=e.shapeData.get(o.META_KEY);return"string"==typeof t&&"string"==typeof i}catch(e){return this.logError("Error validating storage:",e),!1}}get CURRENT_VERSION(){return o.CURRENT_VERSION}clearLegacyData(e){for(const t of o.LEGACY_KEYS)try{if(void 0!==e.shapeData.get(t))try{e.shapeData.delete(t),this.log(`Successfully deleted legacy key '${t}' from element ${e.id}`)}catch(i){e.shapeData.set(t,""),this.log(`Set legacy key '${t}' to empty on element ${e.id} (delete failed)`)}}catch(i){this.logError(`Error handling legacy key '${t}' for element ${e.id}:`,i)}}clearAllModelData(e){try{this.clearExpandedNodes(e),this.clearElementData(e),this.clearSimulationStatus(e);for(const[,t]of e.allBlocks)this.clearElementData(t),this.clearLegacyData(t);for(const[,t]of e.allLines)this.clearElementData(t),this.clearLegacyData(t)}catch(e){throw this.logError("Error clearing model data:",e),e}}}t.StorageAdapter=o,o.LEGACY_KEYS=["q_objecttype","q_data","q_status_current","q_status_prior"],o.DATA_KEY="q_data",o.META_KEY="q_meta",o.EXPANDED_NODES_KEY="q_expanded_nodes",o.SIMULATION_STATUS_KEY="q_simulation_status",o.CURRENT_VERSION="1.0.0",o.LOG_PREFIX="[StorageAdapter]"},3343:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionManager=void 0;const n=i(6491);class o{constructor(e){this.selectionChangeListeners=[],this.loggingEnabled=!1,this.modelManager=e,this.currentSelection={pageId:"",selectedIds:[],selectionType:n.SelectionType.NONE},this.log("SelectionManager initialized")}setLogging(e){this.loggingEnabled=e,this.log("Logging "+(e?"enabled":"disabled"))}isLoggingEnabled(){return this.loggingEnabled}log(e,...t){this.isLoggingEnabled()&&console.log(`${o.LOG_PREFIX} ${e}`,...t)}logError(e,...t){this.isLoggingEnabled()&&console.error(`${o.LOG_PREFIX} ${e}`,...t)}async determineSelectionState(e,t){this.log("Determining selection state",{pageId:e.id,itemCount:t.length,items:t.map((e=>e.id))});const i=await this.determineSelectionType(t),n={pageId:e.id,selectedIds:t.map((e=>e.id)),selectionType:i};return this.log("Selection state determined",n),n}async determineSelectionType(e){if(this.log("Determining selection type",{itemCount:e.length}),0===e.length)return this.log("No items selected, returning NONE"),n.SelectionType.NONE;if(e.length>1)return this.log("Multiple items selected, returning MULTIPLE"),n.SelectionType.MULTIPLE;const t=e[0];if(this.log("Processing single item selection",{itemId:t.id}),this.modelManager.isUnconvertedElement(t))return this.log("Item is unconverted",{itemId:t.id}),n.SelectionType.UNCONVERTED_ELEMENT;const i=await this.modelManager.getMetadata(t);if(this.log("Retrieved metadata",{itemId:t.id,metadata:i}),!(null==i?void 0:i.type)||i.type===n.SimulationObjectType.None)return this.log("Invalid or None type metadata, treating as unconverted",{itemId:t.id}),n.SelectionType.UNCONVERTED_ELEMENT;const o=this.mapElementTypeToSelectionType(i.type);return this.log("Mapped element type to selection type",{itemId:t.id,elementType:i.type,selectionType:o}),o}mapElementTypeToSelectionType(e){var t;this.log("Mapping element type to selection type",{elementType:e});const i=null!==(t={[n.SimulationObjectType.Activity]:n.SelectionType.ACTIVITY,[n.SimulationObjectType.Connector]:n.SelectionType.CONNECTOR,[n.SimulationObjectType.Entity]:n.SelectionType.ENTITY,[n.SimulationObjectType.Generator]:n.SelectionType.GENERATOR,[n.SimulationObjectType.Resource]:n.SelectionType.RESOURCE,[n.SimulationObjectType.Model]:n.SelectionType.MODEL}[e])&&void 0!==t?t:n.SelectionType.UNKNOWN_BLOCK;return this.log("Type mapping result",{elementType:e,result:i}),i}validateSelection(e){this.log("Validating selection state",e);const t=e&&"string"==typeof e.pageId&&Array.isArray(e.selectedIds)&&"number"==typeof e.selectionType;return t||this.logError("Invalid selection state",e),t}onSelectionChange(e){this.log("Adding selection change listener"),this.selectionChangeListeners.push(e)}getCurrentSelection(){return this.log("Getting current selection",this.currentSelection),this.currentSelection}setCurrentSelection(e){this.log("Setting current selection",e),this.validateSelection(e)?(this.currentSelection=e,this.notifySelectionChange()):this.logError("Invalid selection state, not updating",e)}notifySelectionChange(){this.log("Notifying selection change listeners",{listenerCount:this.selectionChangeListeners.length}),this.selectionChangeListeners.forEach(((e,t)=>{try{this.log(`Executing listener ${t}`),e(this.currentSelection)}catch(e){this.logError(`Error in selection change listener ${t}:`,e)}}))}}t.SelectionManager=o,o.LOG_PREFIX="[SelectionManager]"},5086:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TreeStateManager=void 0;class i{constructor(e){this.expandedNodes=new Set,this.stateChangeListeners=[],this.loggingEnabled=!1,this.modelManager=e,this.log("TreeStateManager initialized")}setLogging(e){this.loggingEnabled=e,this.log("Logging "+(e?"enabled":"disabled"))}isLoggingEnabled(){return this.loggingEnabled}log(e,...t){this.isLoggingEnabled()&&console.log(`${i.LOG_PREFIX} ${e}`,...t)}logError(e,...t){this.isLoggingEnabled()&&console.error(`${i.LOG_PREFIX} ${e}`,...t)}handleNodeToggle(e,t,i){this.log("Handling node toggle",{nodeId:e,expanded:t,pageId:null==i?void 0:i.id});try{if(!e)throw new Error("Node ID is required");if(!i)throw new Error("Current page is required");t?(this.expandedNodes.add(e),this.log("Node expanded",{nodeId:e})):(this.expandedNodes.delete(e),this.log("Node collapsed",{nodeId:e}));const n=Array.from(this.expandedNodes);this.log("Saving expanded nodes to storage",{nodes:n}),this.modelManager.setExpandedNodes(i,n),this.notifyStateChange(n)}catch(e){throw this.logError("Error handling node toggle:",e),e}}updateTreeState(e,t){this.log("Updating tree state",{nodeCount:e.length,pageId:null==t?void 0:t.id});try{if(!this.validateState(e))throw new Error("Invalid expanded nodes state");if(!t)throw new Error("Current page is required");this.expandedNodes=new Set(e),this.log("Tree state updated",{nodes:e}),this.modelManager.setExpandedNodes(t,e),this.notifyStateChange(e)}catch(e){throw this.logError("Error updating tree state:",e),e}}expandPath(e,t){this.log("Expanding path to node",{nodeId:t});const i=this.modelManager.findPathToNode(e,t);this.log("Found path nodes",{pathNodes:i}),i.forEach((e=>{this.expandedNodes.add(e),this.log("Added node to expanded set",{nodeId:e})}))}validateState(e){this.log("Validating tree state",{nodeCount:null==e?void 0:e.length});const t=Array.isArray(e)&&e.every((e=>"string"==typeof e));return t||this.logError("Invalid tree state",e),t}getExpandedNodes(){const e=Array.from(this.expandedNodes);return this.log("Getting expanded nodes",{nodes:e}),e}loadSavedState(e){this.log("Loading saved state",{pageId:null==e?void 0:e.id});const t=this.modelManager.getExpandedNodes(e);this.log("Retrieved saved nodes",{savedNodes:t}),(null==t?void 0:t.length)?(this.expandedNodes=new Set(t),this.log("Restored expanded nodes",{nodes:t})):this.log("No saved nodes found")}onStateChange(e){this.log("Adding state change listener"),this.stateChangeListeners.push(e)}notifyStateChange(e){this.log("Notifying state change listeners",{listenerCount:this.stateChangeListeners.length}),this.stateChangeListeners.forEach(((t,i)=>{try{this.log(`Executing listener ${i}`),t(e)}catch(e){this.logError(`Error in state change listener ${i}:`,e)}}))}}t.TreeStateManager=i,i.LOG_PREFIX="[TreeStateManager]"},3048:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),o(i(3343),t),o(i(5086),t)},5686:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ModelPanel=void 0;const n=i(8966),o=i(6491),r=i(6491),a=i(8782),s=i(3048),l=i(362),c=i(1669);class d extends n.Panel{constructor(e,t){super(e,{title:"Quodsi Model",url:"quodsim-react/index.html",location:n.PanelLocation.RightDock,iconUrl:"https://lucid.app/favicon.ico",width:300}),this.loggingEnabled=!1,this.reactAppReady=!1,this.expandedNodes=new Set,this.currentModelStructure=void 0,this.currentSelection={pageId:"",selectedIds:[],selectionType:o.SelectionType.NONE},this.isHandlingSelectionChange=!1;if(this.apiService=(0,r.createLucidApiService)("http://localhost:5000/api/"),!this.apiService)throw new Error("Failed to create API service");this.messaging=o.ExtensionMessaging.getInstance(),this.modelManager=t,this.selectionManager=new s.SelectionManager(t),this.treeStateManager=new s.TreeStateManager(t),this.conversionService=new a.ConversionService(this.modelManager),this.setupModelMessageHandlers(),this.log("Model Panel initialized")}setLogging(e){this.loggingEnabled=e,this.log("Logging "+(e?"enabled":"disabled"))}isLoggingEnabled(){return this.loggingEnabled}log(e,...t){this.isLoggingEnabled()&&console.log(`${d.LOG_PREFIX} ${e}`,...t)}logError(e,...t){this.isLoggingEnabled()&&console.error(`${d.LOG_PREFIX} ${e}`,...t)}setupModelMessageHandlers(){this.logError("Setting up message handlers START"),this.messaging.onMessage(o.MessageTypes.REACT_APP_READY,(()=>{this.logError("REACT_APP_READY message received in handler"),this.handleReactReady()})),this.messaging.onMessage(o.MessageTypes.SIMULATE_MODEL,(()=>this.handleSimulateModel())),this.messaging.onMessage(o.MessageTypes.SIMULATION_STATUS_UPDATE,(e=>this.handleSimulationStatusUpdate(e))),this.messaging.onMessage(o.MessageTypes.ERROR,(e=>{this.logError("Error received:",e)})),this.messaging.onMessage(o.MessageTypes.CONVERT_ELEMENT,(e=>this.handleConvertElement(e))),this.messaging.onMessage(o.MessageTypes.REMOVE_MODEL,(()=>this.handleRemoveModel())),this.messaging.onMessage(o.MessageTypes.CONVERT_PAGE,(()=>this.handlePageConvertRequest())),this.messaging.onMessage(o.MessageTypes.VALIDATE_MODEL,(()=>this.handleValidateModel())),this.messaging.onMessage(o.MessageTypes.UPDATE_ELEMENT_DATA,(e=>this.handleUpdateElementData(e))),this.messaging.onMessage(o.MessageTypes.TREE_NODE_TOGGLE,(e=>this.handleTreeNodeToggle(e.nodeId,e.expanded))),this.messaging.onMessage(o.MessageTypes.TREE_STATE_UPDATE,(e=>this.handleTreeStateUpdate(e.expandedNodes))),this.messaging.onMessage(o.MessageTypes.TREE_NODE_EXPAND_PATH,(e=>this.handleExpandPath(e.nodeId))),this.messaging.onMessage(o.MessageTypes.OUTPUT_CREATE_PAGE,(e=>{this.handleOutputCreatePage(e)})),this.logError("Setting up message handlers END")}async handleOutputCreatePage(e){console.log("[ModelPanel] Output page creation requested:",e.pageName);try{const t=new n.DocumentProxy(this.client),i=new n.UserProxy(this.client),o=t.id,r=i.id;if(!o||!r)throw new Error("Document ID or User ID is missing");const a={title:e.pageName},s=(t.addPage(a),new n.Viewport(this.client).getCurrentPage());console.log("[ModelPanel] ImportSimulationResults"),await this.client.performDataAction({dataConnectorName:"quodsi_data_connector",actionName:"ImportSimulationResults",actionData:{documentId:o,userId:r,pageId:null==s?void 0:s.id},asynchronous:!0}),console.log("[ModelPanel] Successfully called ImportSimulationResults")}catch(e){console.error("[ModelPanel] Error creating output page:",e),this.messaging.sendMessage(o.MessageTypes.ERROR,{error:e instanceof Error?e.message:"Unknown error occurred"})}}async handleOutputCreatePageOld(e){var t,i,a;console.log("[ModelPanel] Output page creation requested:",e.pageName);try{const o=new n.DocumentProxy(this.client),s=new n.UserProxy(this.client),l=o.id,c=s.id;if(!l||!c)throw new Error("Document ID or User ID is missing");const d={title:e.pageName},u=o.addPage(d),p=new n.Viewport(this.client).getCurrentPage();console.log("[ModelPanel] Fetching CSV data through performDataAction"),await this.client.performDataAction({dataConnectorName:"quodsi_data_connector",actionName:"ImportSimulationResults",actionData:{documentId:l,userId:c,pageId:null==p?void 0:p.id},asynchronous:!0});const h={status:200,json:{error:"blah",csvData:"dan"}};if(console.log("[ModelPanel] GetActivityUtilization",h),200!==h.status||!(null===(t=h.json)||void 0===t?void 0:t.csvData))throw new Error((null===(i=h.json)||void 0===i?void 0:i.error)||"Failed to fetch CSV data");console.log("[ModelPanel]  Parse the CSV string"),console.log("[ModelPanel]  Parse the CSV string");const g=await(0,r.parseCsvBlob)(new Blob([h.json.csvData],{type:"text/csv"}));if(!g||!g.length)throw new Error("No data found in CSV");console.log("[ModelPanel] Calculating table dimensions...");const{width:m,height:y}=(0,r.calculateTableDimensions)(g);console.log("[ModelPanel] Loading Table block class..."),await this.client.loadBlockClasses(["TableBlock"]);const f={className:"TableBlock",boundingBox:{x:100,y:100,w:m,h:y}};console.log("[ModelPanel] Adding TableBlock to page...");const S=u.addBlock(f),E=g.length,v=(null===(a=g[0])||void 0===a?void 0:a.length)||0,T=S.getRows();let C=T[0].getCells()[0];console.log("[ModelPanel] Adding rows...");for(let e=1;e<E;e++)C=S.addRow(C).getCells()[0];C=T[0].getCells()[0],console.log("[ModelPanel] Adding columns...");for(let e=1;e<v;e++)C=S.addColumn(C).getCells()[0];console.log("[ModelPanel] Populating table data...");const b=S.getRows();g.forEach(((e,t)=>{const i=b[t].getCells();e.forEach(((e,t)=>{i[t].setText(String(e))}))})),console.log("[ModelPanel] Successfully created output page with data")}catch(e){console.error("[ModelPanel] Error creating output page:",e),this.messaging.sendMessage(o.MessageTypes.ERROR,{error:e instanceof Error?e.message:"Unknown error occurred"})}}async handleSimulationStatusUpdate(e){try{const t=new n.Viewport(this.client).getCurrentPage();if(!t)throw new Error("No active page found");this.modelManager.getStorageAdapter().setSimulationStatus(t,e.pageStatus),this.sendTypedMessage(o.MessageTypes.SIMULATION_STATUS_UPDATE,{pageStatus:e.pageStatus})}catch(e){this.logError("Failed to update page status:",e),this.sendTypedMessage(o.MessageTypes.ERROR,{error:`Failed to update simulation status: ${e instanceof Error?e.message:String(e)}`})}}async updateModelStructure(){this.currentModelStructure=await this.modelManager.getModelStructure(),this.log("Model structure updated:",this.currentModelStructure);const e=await this.modelManager.validateModel();this.log("Model validation result:",e),this.isHandlingSelectionChange||this.sendTypedMessage(o.MessageTypes.VALIDATION_RESULT,e)}async createSimulationObjectPayload(e,t,i){const r=this.modelManager.getMetadata(t);if(!r)throw new Error("No metadata found for item");const a=await this.buildModelItemData(t),s={pageId:e.id,selectedId:t.id,objectType:r.type,diagramElementType:t instanceof n.BlockProxy?o.DiagramElementType.BLOCK:o.DiagramElementType.LINE};this.log("DEBUG - Before Generator check:",{itemId:t.id,metadata:r,type:null==r?void 0:r.type,isGenerator:(null==r?void 0:r.type)===o.SimulationObjectType.Generator});let l={};if(r.type===o.SimulationObjectType.Generator){const e=await this.modelManager.getModelDefinition();if(e){const t=e.entities.getAll();l.entities=t.map((e=>(this.log("Mapping entity:",e),{id:e.id,name:e.name})))}}if(r.type===o.SimulationObjectType.Activity||r.type===o.SimulationObjectType.Connector){const e=await this.modelManager.getModelDefinition();if(e){const t=e.resourceRequirements.getAll();l.resourceRequirements=t}}return Object.assign(Object.assign({},i),{simulationSelection:s,modelItemData:a,modelStructure:this.currentModelStructure,referenceData:l})}async handleConvertElement(e){try{const t=new n.Viewport(this.client),i=t.getCurrentPage();if(!i)throw new Error("No active page found");const r=t.getSelectedItems().find((t=>t.id===e.elementId));if(!r)throw new Error(`Element not found in selection: ${e.elementId}`);const a=await this.modelManager.getModelDefinition();if(!a)throw new Error("Model definition not found");let s;switch(e.type){case o.SimulationObjectType.Activity:s=a.activities.getNextName();break;case o.SimulationObjectType.Connector:s=a.connectors.getNextName();break;case o.SimulationObjectType.Generator:s=a.generators.getNextName();break;case o.SimulationObjectType.Resource:s=a.resources.getNextName();break;case o.SimulationObjectType.ResourceRequirement:s=a.resourceRequirements.getNextName();break;case o.SimulationObjectType.Entity:s=a.entities.getNextName();break;default:s=`New ${e.type}`}const l=o.SimulationObjectTypeFactory.createElement(e.type,e.elementId);if(l.name=s,await this.modelManager.saveElementData(r,l,e.type,i),await this.updateModelStructure(),!this.currentModelStructure)throw new Error("Failed to update model structure after conversion");const c=await this.createSimulationObjectPayload(i,r,{selectionState:{pageId:i.id,selectedIds:[e.elementId],selectionType:o.SelectionType.ACTIVITY}});this.sendTypedMessage(o.MessageTypes.SELECTION_CHANGED_SIMULATION_OBJECT,c)}catch(e){this.logError("Error converting element:",e),this.sendTypedMessage(o.MessageTypes.ERROR,{error:`Failed to convert element: ${e instanceof Error?e.message:String(e)}`})}}handleTreeNodeToggle(e,t){const i=new n.Viewport(this.client).getCurrentPage();i&&(this.treeStateManager.handleNodeToggle(e,t,i),this.sendTreeStateUpdate())}handleTreeStateUpdate(e){this.log("Tree state update:",{expandedNodes:e}),this.expandedNodes=new Set(e);const t=new n.Viewport(this.client).getCurrentPage();t&&(this.log("Saving expanded nodes to storage:",e),this.modelManager.setExpandedNodes(t,e)),this.sendTreeStateUpdate()}handleExpandPath(e){this.currentModelStructure&&(this.modelManager.findPathToNode(this.currentModelStructure,e).forEach((e=>this.expandedNodes.add(e))),this.sendTreeStateUpdate())}sendTreeStateUpdate(){const e=new n.Viewport(this.client).getCurrentPage();e&&this.sendTypedMessage(o.MessageTypes.TREE_STATE_SYNC,{expandedNodes:Array.from(this.expandedNodes),pageId:e.id})}async initializeModelManager(){const e=new n.Viewport(this.client).getCurrentPage();if(e&&this.modelManager.isQuodsiModel(e))try{const t=this.modelManager.getElementData(e);t&&(await this.modelManager.initializeModel(t,e),this.log("Model initialization complete"))}catch(e){throw this.logError("Error initializing model:",e),new Error(`Failed to initialize model: ${e instanceof Error?e.message:"Unknown error"}`)}else this.log("Page is not a Quodsi model, skipping initialization")}show(){this.log("Show called");const e=new n.Viewport(this.client).getCurrentPage();this.log("Current page at show:",e),this.initializeModelManager(),super.show()}hide(){this.log("Hide called"),super.hide()}async handleValidateRequest(){const e=await this.modelManager.validateModel();this.sendTypedMessage(o.MessageTypes.VALIDATION_RESULT,e)}async handleSelectionChange(e){this.isHandlingSelectionChange=!0;try{const t=new n.Viewport(this.client).getCurrentPage();if(!t)return;await this.updateModelStructure();const i=await this.selectionManager.determineSelectionState(t,e);this.selectionManager.setCurrentSelection(i),this.reactAppReady&&await this.sendSelectionBasedMessage(i,e,t)}catch(e){this.handleError("Error handling selection change:",e)}finally{this.isHandlingSelectionChange=!1}}async sendSelectionBasedMessage(e,t,i){if(this.log("DEBUG - sendSelectionBasedMessage START - Selection Type:",e.selectionType),1===t.length){const e=t[0];this.log("DEBUG - Item metadata:",this.modelManager.getMetadata(e))}const r=new n.PageProxy(i.id,this.client);if(!this.modelManager.isQuodsiModel(r))return void this.sendTypedMessage(o.MessageTypes.SELECTION_CHANGED_PAGE_NO_MODEL,{pageId:r.id});const a=this.currentModelStructure||{elements:[],hierarchy:{}},s={selectionState:e,modelStructure:a,expandedNodes:this.treeStateManager.getExpandedNodes(),validationResult:await this.modelManager.validateModel(),documentId:new n.DocumentProxy(this.client).id};switch(e.selectionType){case o.SelectionType.NONE:{const e=await this.buildModelItemData(r),t=Object.assign(Object.assign({},s),{pageSelection:{pageId:i.id},modelStructure:a,modelItemData:e});this.sendTypedMessage(o.MessageTypes.SELECTION_CHANGED_PAGE_WITH_MODEL,t);break}case o.SelectionType.MULTIPLE:{const e=await Promise.all(t.map((e=>this.buildModelItemData(e)))),n=Object.assign(Object.assign({},s),{multipleSelection:{pageId:i.id,selectedIds:t.map((e=>e.id))},modelItemData:e});this.sendTypedMessage(o.MessageTypes.SELECTION_CHANGED_MULTIPLE,n);break}case o.SelectionType.UNCONVERTED_ELEMENT:if(1===t.length){const e=t[0],r=await this.buildModelItemData(e);r.isUnconverted=!0;const a={pageId:i.id,selectedId:e.id,diagramElementType:e instanceof n.BlockProxy?o.DiagramElementType.BLOCK:o.DiagramElementType.LINE},l=Object.assign(Object.assign({},s),{unconvertedSelection:a,modelItemData:r});this.sendTypedMessage(o.MessageTypes.SELECTION_CHANGED_UNCONVERTED,l)}break;case o.SelectionType.ACTIVITY:case o.SelectionType.CONNECTOR:case o.SelectionType.ENTITY:case o.SelectionType.GENERATOR:case o.SelectionType.RESOURCE:case o.SelectionType.MODEL:if(1===t.length){const e=t[0];if(this.modelManager.getMetadata(e)){const t=await this.createSimulationObjectPayload(i,e,s);this.sendTypedMessage(o.MessageTypes.SELECTION_CHANGED_SIMULATION_OBJECT,t)}}break;default:{const e=await this.buildModelItemData(r),t=Object.assign(Object.assign({},s),{pageSelection:{pageId:i.id},modelStructure:a,modelItemData:e});this.sendTypedMessage(o.MessageTypes.SELECTION_CHANGED_PAGE_WITH_MODEL,t);break}}}handleError(e,t){this.logError(`${e}`,t),this.sendTypedMessage(o.MessageTypes.ERROR,{error:t instanceof Error?t.message:"Unknown error"})}async buildModelItemData(e){const t=this.modelManager.getElementData(e),i=this.modelManager.getMetadata(e);let r;r=e instanceof n.PageProxy?e.getTitle()||"Untitled Model":e instanceof n.BlockProxy?e.id||"Unnamed Block":"Unnamed Connector";const a=Object.assign({type:e instanceof n.PageProxy?o.SimulationObjectType.Model:o.SimulationObjectType.None,version:this.modelManager.CURRENT_VERSION,lastModified:(new Date).toISOString(),id:e.id},i||{});e instanceof n.ItemProxy&&this.modelManager.isUnconvertedElement(e)&&(a.isUnconverted=!0);const s=t?JSON.parse(JSON.stringify(t)):{};return{id:e.id,data:s,metadata:a,name:r}}async buildModelItemDataArray(e){return Promise.all(e.map((e=>this.buildModelItemData(e))))}async handleRemoveModel(){try{const e=new n.Viewport(this.client).getCurrentPage();if(!e)return;await this.modelManager.removeModelFromPage(e),this.sendTypedMessage(o.MessageTypes.SELECTION_CHANGED_PAGE_NO_MODEL,{pageId:e.id})}catch(e){this.handleError("Error removing model:",e)}}async handleReactReady(){if(this.reactAppReady)return void this.logError("React app already ready, skipping initialization");this.logError("handleReactReady"),this.reactAppReady=!0;const e=new n.Viewport(this.client),t=e.getCurrentPage();if(new n.DocumentProxy(this.client),t)try{await this.initializeModelManager();const t=e.getSelectedItems();await this.handleSelectionChange(t)}catch(e){this.handleError("Error during React ready initialization:",e)}else this.logError("No active page found during React ready")}async handlePageConvertRequest(){this.log("Handling convert request");const e=new n.Viewport(this.client),t=e.getCurrentPage();if(new n.DocumentProxy(this.client),t)try{this.log("Creating dataProxy");const i=new n.DataProxy(this.client);this.log("Creating modelDataSource");const o=new c.ModelDataSource(i);this.log("Creating pageSchemaConversionService");const r=new l.PageSchemaConversionService(o);this.log("pageSchemaConversionService.convertPage"),await r.convertPage(t),await this.conversionService.convertPage(t);const a=e.getSelectedItems();await this.handleSelectionChange(a)}catch(e){this.logError("Conversion error:",e),this.sendTypedMessage(o.MessageTypes.CONVERSION_ERROR,{error:e instanceof Error?e.message:"Unknown error"})}else this.sendTypedMessage(o.MessageTypes.CONVERSION_ERROR,{error:"No active page found"})}async handleUpdateElementData(e){this.log("Received element update data:",e);try{const t=new n.Viewport(this.client),i=t.getCurrentPage();if(!i)throw new Error("No active page found");const r=t.getSelectedItems();this.currentSelection={pageId:i.id,selectedIds:r.map((e=>e.id)),selectionType:this.currentSelection.selectionType};const a=r.find((t=>t.id===e.elementId));if(!a)throw new Error(`Element not found in selection: ${e.elementId}`);await this.modelManager.saveElementData(a,e.data,e.type,i),this.sendTypedMessage(o.MessageTypes.UPDATE_SUCCESS,{elementId:e.elementId}),this.log("Debug - Selection state:",{currentSelectionIds:this.currentSelection.selectedIds,updatedElementId:e.elementId,isElementInSelection:this.currentSelection.selectedIds.includes(e.elementId),selectedItems:r.map((e=>e.id))}),await this.modelManager.validateModel(),this.currentSelection.selectedIds.includes(e.elementId)&&await this.handleSelectionChange(r)}catch(e){this.logError("Error updating element:",e),this.sendTypedMessage(o.MessageTypes.ERROR,{error:`Failed to update element: ${e instanceof Error?e.message:String(e)}`})}}async handleSimulateModel(){this.log("Handling simulate model request");try{const e=new n.DocumentProxy(this.client).id,t=new n.Viewport(this.client),i=new n.UserProxy(this.client),r=t.getCurrentPage();let a="undefined",s="undefined";i&&(s=i.id),r&&(a=r.id),r?this.log(`Active page ID: ${r.id}`):this.log("No active page found"),this.log(`Extension: docId=${e}, pageId=${a}, userId=${s}`),await this.client.performDataAction({dataConnectorName:"quodsi_data_connector",actionName:"Simulate",actionData:{documentId:e,pageId:a,userId:s},asynchronous:!0}),this.sendTypedMessage(o.MessageTypes.SIMULATION_STARTED,{documentId:e})}catch(e){this.logError("Error starting simulation:",e),this.sendTypedMessage(o.MessageTypes.ERROR,{error:`Failed to start simulation: ${e instanceof Error?e.message:String(e)}`})}}async handleValidateModel(){this.log("Handling validate model");const e=await this.modelManager.validateModel();this.sendTypedMessage(o.MessageTypes.VALIDATION_RESULT,e)}handleModelSaved(e){this.log("Handling model saved");const t=new n.Viewport(this.client).getCurrentPage();if(t)try{this.modelManager.setElementData(t,e,o.SimulationObjectType.Model),this.modelManager.updateElement(Object.assign({id:t.id,type:o.SimulationObjectType.Model},e)),this.sendTypedMessage(o.MessageTypes.UPDATE_SUCCESS,{elementId:t.id})}catch(e){this.sendTypedMessage(o.MessageTypes.ERROR,{error:`Failed to save model: ${e}`})}}sendTypedMessage(e,t){const i={messagetype:e,data:null!=t?t:null};this.sendMessage(i)}messageFromFrame(e){if(!(0,o.isValidMessage)(e))return this.logError("Invalid message format:",e),void this.sendTypedMessage(o.MessageTypes.ERROR,{error:"Invalid message format"});this.messaging.handleIncomingMessage(e)}}t.ModelPanel=d,d.LOG_PREFIX="[ModelPanel]"},8348:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ModelStructureBuilder=void 0;const n=i(6491);t.ModelStructureBuilder=class{static buildModelStructure(e){if(console.group("ModelStructureBuilder.buildModelStructure"),!e)return console.warn("Empty model data"),console.groupEnd(),{elements:[],hierarchy:{}};const t=[],i={},o={id:e.id,name:e.name,type:n.SimulationObjectType.Model,hasChildren:!0,children:[]};return t.push(o),[{id:"activities",name:"Activities",type:n.SimulationObjectType.Activity,items:e.activities},{id:"connectors",name:"Connectors",type:n.SimulationObjectType.Connector,items:e.connectors},{id:"resources",name:"Resources",type:n.SimulationObjectType.Resource,items:e.resources},{id:"generators",name:"Generators",type:n.SimulationObjectType.Generator,items:e.generators},{id:"entities",name:"Entities",type:n.SimulationObjectType.Entity,items:e.entities},{id:"requirements",name:"Requirements",type:n.SimulationObjectType.ResourceRequirement,items:e.resourceRequirements}].forEach((n=>{const o=`${e.id}_${n.id}`,r={id:o,name:n.name,type:n.type,hasChildren:n.items.getAll().length>0,children:[]};t.push(r),i[e.id]=i[e.id]||[],i[e.id].push(o),n.items.getAll().forEach((e=>{const r={id:e.id,name:e.name,type:n.type,hasChildren:!1,children:[]};t.push(r),i[o]=i[o]||[],i[o].push(e.id)}))})),console.debug("Build complete:",{totalElements:t.length}),console.groupEnd(),{elements:t,hierarchy:i}}}},8782:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversionService=void 0;const n=i(6491),o=i(6491);class r extends n.QuodsiLogger{constructor(e){super(),this.modelManager=e,this.LOG_PREFIX="[ConversionService]",this.storageAdapter=e.getStorageAdapter(),this.setLogging(!1)}canConvertPage(e){return!!(e&&e.allBlocks&&e.allLines)&&!this.storageAdapter.isQuodsiModel(e)&&e.allBlocks.size>0}async convertPage(e){this.log("[ConversionService] Starting page conversion");try{this.storageAdapter.isQuodsiModel(e)&&(this.log("[ConversionService] Removing existing model data"),this.modelManager.removeModelFromPage(e));const t=n.Model.createDefault(e.id);if(this.storageAdapter.setElementData(e,t,n.SimulationObjectType.Model),await this.modelManager.initializeModel(t,e),!this.storageAdapter.isQuodsiModel(e))throw new Error("Failed to initialize model on page");const i=this.analyzePage(e),o=await this.convertBlocks(e,i);this.log("[ConversionService] Blocks converted:",o);const r=await this.convertConnections(e,i);this.log("[ConversionService] Connectors converted:",r);const a=await this.modelManager.validateModel();return this.log("[ConversionService] Validation result:",a),{success:!0,modelId:e.id,elementCount:{activities:o.activities,generators:o.generators,resources:o.resources,connectors:r}}}catch(e){throw this.logError("[ConversionService] Conversion failed:",e),e}}analyzePage(e){var t,i;this.log("Analyzing page structure");const n=new Map;this.log("All blocks:",Array.from(e.allBlocks.keys())),this.log("All lines:",Array.from(e.allLines.keys()));for(const[o,r]of e.allLines){const e=r.getEndpoint1(),a=r.getEndpoint2();if(this.log(`Analyzing line ${o}:`,{hasEndpoint1Connection:!!(null==e?void 0:e.connection),hasEndpoint2Connection:!!(null==a?void 0:a.connection),endpoint1Id:null===(t=null==e?void 0:e.connection)||void 0===t?void 0:t.id,endpoint2Id:null===(i=null==a?void 0:a.connection)||void 0===i?void 0:i.id}),e.connection&&a.connection){const t=e.connection.id,i=a.connection.id;this.updateBlockAnalysis(n,t,"outgoing"),this.updateBlockAnalysis(n,i,"incoming")}}return this.log("Pre-type determination analysis:",Array.from(n.entries()).map((([e,t])=>({id:e,incomingCount:t.incomingCount,outgoingCount:t.outgoingCount,currentType:t.elementType})))),this.determineElementTypes(n,e),{blockAnalysis:n}}async initializeModel(e){this.log("Initializing model");const t=new n.Model(e.id,e.getTitle()||"New Model",n.ModelDefaults.DEFAULT_REPS,n.ModelDefaults.DEFAULT_FORECAST_DAYS,n.ModelDefaults.DEFAULT_SEED,n.ModelDefaults.DEFAULT_CLOCK_UNIT,n.ModelDefaults.DEFAULT_SIMULATION_TIME_TYPE,n.ModelDefaults.DEFAULT_WARMUP_PERIOD,n.ModelDefaults.DEFAULT_CLOCK_UNIT,n.ModelDefaults.DEFAULT_RUN_PERIOD,n.ModelDefaults.DEFAULT_CLOCK_UNIT,null,null,null);this.modelManager.initializeModel(t,e)}async convertBlocks(e,t){this.log("Starting block conversion");let i=0,r=0,a=0;for(const[s,l]of e.allBlocks){const e=t.blockAnalysis.get(s);if(null==e?void 0:e.elementType)try{this.log(`Creating element for block ${s}:`,{type:e.elementType,blockClass:l.getClassName()});const t=o.SimulationObjectTypeFactory.createElement(e.elementType,s);t.name=this.getBlockName(l),this.storageAdapter.setElementData(l,t,e.elementType);const c=this.storageAdapter.getElementData(l);switch(this.log(`Stored element data verification for ${s}:`,c),await this.modelManager.registerElement(t,l),e.elementType){case n.SimulationObjectType.Activity:i++;break;case n.SimulationObjectType.Generator:r++;break;case n.SimulationObjectType.Resource:a++}this.log(`Successfully converted block ${s}:`,{type:t.type,name:t.name,stored:!!c})}catch(e){throw this.logError(`Failed to convert block ${s}:`,e),e}else this.logError(`Missing element type for block ${s}`)}return{activities:i,generators:r,resources:a}}async convertConnections(e,t){this.log("Converting connections");let i=0;const r=new Map;for(const[t,i]of e.allLines){const e=i.getEndpoint1();if(null==e?void 0:e.connection){const t=e.connection.id;r.set(t,(r.get(t)||0)+1)}}this.log("Outgoing connection counts:",Array.from(r).reduce(((e,[t,i])=>(e[t]=i,e)),{}));for(const[t,a]of e.allLines)try{this.log(`Processing line ${t}`);const e=a.getEndpoint1(),s=a.getEndpoint2();if(!(null==e?void 0:e.connection)||!(null==s?void 0:s.connection)){console.warn(`Line ${t} has invalid endpoints`);continue}const l=e.connection.id,c=1/(r.get(l)||1),d=o.SimulationObjectTypeFactory.createElement(n.SimulationObjectType.Connector,t);d.name=`Connector ${t}`,d.sourceId=l,d.targetId=s.connection.id,d.probability=c,d.connectType=n.ConnectType.Probability,this.storageAdapter.setElementData(a,d,n.SimulationObjectType.Connector);const u=this.storageAdapter.getElementData(a);this.log(`Stored connector data verification for ${t}:`,{sourceId:d.sourceId,targetId:d.targetId,probability:d.probability,stored:!!u}),await this.modelManager.registerElement(d,a),i++}catch(e){throw this.logError(`Failed to convert connection ${t}:`,e),e}return this.log(`Converted ${i} connections`),i}updateBlockAnalysis(e,t,i){let n=e.get(t);n||(n={incomingCount:0,outgoingCount:0,elementType:void 0},e.set(t,n)),"incoming"===i?n.incomingCount++:n.outgoingCount++}blockSpecificLogic(e,t){const i=e.getClassName();i&&("TerminatorBlockV2"===i?t.elementType=n.SimulationObjectType.Generator:"ProcessBlock"!==i&&"DecisionBlock"!==i&&"ActionBlock"!==i||(t.elementType=n.SimulationObjectType.Activity))}determineElementTypes(e,t){this.log("Starting element type determination");for(const[i,n]of t.allBlocks){const t=e.get(i)||{incomingCount:0,outgoingCount:0,elementType:void 0};e.set(i,t)}for(const[t,i]of e)i.elementType||(0===i.incomingCount&&i.outgoingCount>0?i.elementType=n.SimulationObjectType.Generator:i.incomingCount>0&&(i.elementType=n.SimulationObjectType.Activity));for(const[t,i]of e)this.log(`Final type for block ${t}:`,{elementType:i.elementType,incomingCount:i.incomingCount,outgoingCount:i.outgoingCount})}getBlockName(e){if(e.textAreas&&e.textAreas.size>0)for(const t of e.textAreas.values())if(t&&t.trim())return t.trim();return`New ${e.getClassName()||"Block"}`}}t.ConversionService=r},362:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PageSchemaConversionService=void 0;const n=i(6491),o=i(1669);class r extends n.QuodsiLogger{constructor(e){super(),this.modelDataSource=e,this.LOG_PREFIX="[PageSchemaConversionService]",this.collectionIds={},this.setLogging(!0)}analyzePage(e){this.log("Starting page analysis");const t=new Map;for(const[i,n]of e.allLines){const e=n.getEndpoint1(),o=n.getEndpoint2();if(e.connection&&o.connection){const n=e.connection.id,r=o.connection.id;this.log(`Line ${i}: ${n} -> ${r}`),this.updateBlockAnalysis(t,n,"outgoing"),this.updateBlockAnalysis(t,r,"incoming")}}return this.determineElementTypes(t,e),{blockAnalysis:t}}canConvertPage(e){if(this.log("Checking if page can be converted"),!e||!e.allBlocks||!e.allLines)return this.log("Page invalid - missing required properties"),!1;const t=e.allBlocks.size;return this.log(`Page has ${t} blocks`),t>0}async convertPage(e){var t;this.log("========== Starting Page Conversion =========="),this.log(`Page ID: ${e.id}`);try{const i=this.modelDataSource.createModelDataSource(e.id);if(!(null==i?void 0:i.source))throw new Error("Failed to create model data source");const{source:r,collectionIds:a}=i;this.collectionIds=a,this.log("Collection IDs:",this.collectionIds);const s=n.Model.createDefault(e.id);this.log("Model defaults created:",s),this.log("Adding model to collection");const l=this.collectionIds[o.MODEL_COLLECTIONS.MODEL];this.log(`Using model collection ID: ${l}`),await(null===(t=r.collections.get(l))||void 0===t?void 0:t.patchItems({added:[{id:s.id,name:s.name,reps:s.reps,forecastDays:s.forecastDays,seed:s.seed,oneClockUnit:s.oneClockUnit,simulationTimeType:s.simulationTimeType,warmupClockPeriod:s.warmupClockPeriod,warmupClockPeriodUnit:s.warmupClockPeriodUnit,runClockPeriod:s.runClockPeriod,runClockPeriodUnit:s.runClockPeriodUnit,type:n.SimulationObjectType.Model}]}));const c=this.analyzePage(e),d=await this.convertBlocks(e,c,r),u=await this.convertConnections(e,c,r);return{success:!0,modelId:e.id,elementCount:{activities:d.activities,generators:d.generators,resources:d.resources,connectors:u}}}catch(e){throw this.logError("========== Conversion Failed =========="),this.logError("Error details:",e),e}}async createOperationSteps(e,t,i){var n;const r=this.collectionIds[o.MODEL_COLLECTIONS.OPERATION_STEPS];this.log(`Adding operation steps for ${e}`,{steps:t});const a=t.map(((t,i)=>({id:`${e}_step_${i}`,activityId:e,requirementId:t.requirementId,quantity:t.quantity,duration:JSON.stringify(t.duration)})));await(null===(n=i.collections.get(r))||void 0===n?void 0:n.patchItems({added:a})),this.log(`Added ${a.length} operation steps`)}async convertBlocks(e,t,i){var r,a,s;let l=0,c=0,d=0;for(const[u,p]of e.allBlocks){const e=t.blockAnalysis.get(u);if(null==e?void 0:e.elementType)try{const t=this.getBlockName(p),h=n.SimulationObjectTypeFactory.createElement(e.elementType,u);switch(h.name=t,e.elementType){case n.SimulationObjectType.Activity:{const e=h,t=this.collectionIds[o.MODEL_COLLECTIONS.ACTIVITIES];await(null===(r=i.collections.get(t))||void 0===r?void 0:r.patchItems({added:[{id:e.id,name:e.name,capacity:e.capacity,inputBufferCapacity:e.inputBufferCapacity,outputBufferCapacity:e.outputBufferCapacity,type:n.SimulationObjectType.Activity}]})),await this.createOperationSteps(e.id,e.operationSteps,i),p.setReferenceKey("simulation_object",{collectionId:t,primaryKey:e.id,readonly:!0}),l++;break}case n.SimulationObjectType.Generator:{const e=h,t=this.collectionIds[o.MODEL_COLLECTIONS.GENERATORS];await(null===(a=i.collections.get(t))||void 0===a?void 0:a.patchItems({added:[{id:e.id,name:e.name,activityKeyId:e.activityKeyId,entityId:e.entityId,periodicOccurrences:e.periodicOccurrences,periodIntervalDuration:JSON.stringify(e.periodIntervalDuration),entitiesPerCreation:e.entitiesPerCreation,periodicStartDuration:JSON.stringify(e.periodicStartDuration),maxEntities:e.maxEntities,type:n.SimulationObjectType.Generator}]})),p.setReferenceKey("simulation_object",{collectionId:t,primaryKey:e.id,readonly:!0}),c++;break}case n.SimulationObjectType.Resource:{const e=h,t=this.collectionIds[o.MODEL_COLLECTIONS.RESOURCES];await(null===(s=i.collections.get(t))||void 0===s?void 0:s.patchItems({added:[{id:e.id,name:e.name,capacity:e.capacity,type:n.SimulationObjectType.Resource}]})),p.setReferenceKey("simulation_object",{collectionId:t,primaryKey:e.id,readonly:!0}),d++;break}}}catch(e){throw this.logError(`Failed to convert block ${u}:`,e),e}}return{activities:l,generators:c,resources:d}}async convertConnections(e,t,i){var r;let a=0;const s=new Map;for(const[t,i]of e.allLines){const e=i.getEndpoint1();if(null==e?void 0:e.connection){const t=e.connection.id;s.set(t,(s.get(t)||0)+1)}}const l=this.collectionIds[o.MODEL_COLLECTIONS.CONNECTORS];for(const[t,o]of e.allLines)try{const e=o.getEndpoint1(),c=o.getEndpoint2();if(!(null==e?void 0:e.connection)||!(null==c?void 0:c.connection))continue;const d=e.connection.id,u=n.SimulationObjectTypeFactory.createElement(n.SimulationObjectType.Connector,t);u.sourceId=d,u.targetId=c.connection.id,u.probability=1/(s.get(d)||1),await(null===(r=i.collections.get(l))||void 0===r?void 0:r.patchItems({added:[{id:u.id,name:u.name,sourceId:u.sourceId,targetId:u.targetId,probability:u.probability,connectType:u.connectType,type:n.SimulationObjectType.Connector}]})),u.operationSteps.length>0&&await this.createOperationSteps(u.id,u.operationSteps,i),o.setReferenceKey("simulation_object",{collectionId:l,primaryKey:u.id,readonly:!0}),a++}catch(e){throw this.logError(`Failed to convert connection ${t}:`,e),e}return a}updateBlockAnalysis(e,t,i){let n=e.get(t);n||(n={incomingCount:0,outgoingCount:0,elementType:void 0},e.set(t,n)),"incoming"===i?n.incomingCount++:n.outgoingCount++}determineElementTypes(e,t){this.log("Starting element type determination"),this.log("First pass - Block class identification");for(const[i,n]of t.allBlocks){const t=e.get(i)||{incomingCount:0,outgoingCount:0,elementType:void 0};e.set(i,t),this.log(`Block ${i} initial analysis:`,{incomingCount:t.incomingCount,outgoingCount:t.outgoingCount,elementType:t.elementType})}this.log("Second pass - Connection pattern analysis");for(const[t,i]of e)if(!i.elementType){const e=i.elementType;0===i.incomingCount&&i.outgoingCount>0?i.elementType=n.SimulationObjectType.Generator:i.incomingCount>0&&(i.elementType=n.SimulationObjectType.Activity),this.log(`Block ${t} type determination:`,{from:e,to:i.elementType,incomingCount:i.incomingCount,outgoingCount:i.outgoingCount})}}getBlockName(e){if(e.textAreas&&e.textAreas.size>0)for(const t of e.textAreas.values())if(t&&t.trim())return t.trim();return`New ${e.getClassName()||"Block"}`}}t.PageSchemaConversionService=r},4818:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ActivityValidation=void 0;const n=i(665),o=i(9843);class r extends n.ValidationRule{validate(e,t){e.modelDefinition.activities.getAll().forEach((i=>{this.validateActivityConnectivity(i.id,e,t),this.validateActivityData(i,t),this.validateOperationSequence(i,e,t),this.validateBufferConstraints(i,e,t)})),this.validateActivityInteractions(e,t)}validateActivityConnectivity(e,t,i){this.log(`Validating connectivity for Activity ID: ${e}`);const n=t.activityRelationships.get(e);if(!n)return this.log(`Activity ID ${e} is isolated.`),void i.push(o.ValidationMessages.isolatedElement("Activity",e));0===n.incomingConnectors.size&&0===n.outgoingConnectors.size&&(this.log(`Activity ID ${e} has no incoming or outgoing connections.`),i.push(o.ValidationMessages.isolatedElement("Activity",e))),0===n.incomingConnectors.size&&(this.log(`Activity ID ${e} has no incoming connections.`),i.push(o.ValidationMessages.noConnections("Activity",e,"incoming"))),0===n.outgoingConnectors.size&&(this.log(`Activity ID ${e} has no outgoing connections.`),i.push(o.ValidationMessages.noConnections("Activity",e,"outgoing")))}validateActivityData(e,t){var i;this.log(`Validating data for Activity ID: ${e.id}`),(null===(i=e.name)||void 0===i?void 0:i.trim())||(this.log(`Activity ID ${e.id} has a missing name.`),t.push(o.ValidationMessages.missingName("Activity",e.id))),("number"!=typeof e.capacity||e.capacity<1)&&(this.log(`Activity ID ${e.id} has an invalid capacity: ${e.capacity}`),t.push(o.ValidationMessages.invalidCapacity("Activity",e.id))),this.validateBufferCapacities(e,t),this.validateOperationSteps(e,t)}validateBufferCapacities(e,t){this.log(`Validating buffer capacities for Activity ID: ${e.id}`),"number"!=typeof e.inputBufferCapacity||e.inputBufferCapacity<0?(this.log(`Activity ID ${e.id} has an invalid input buffer capacity: ${e.inputBufferCapacity}`),t.push(o.ValidationMessages.invalidBufferCapacity("Activity",e.id,"input"))):e.inputBufferCapacity>r.MAX_BUFFER_SIZE&&(this.log(`Activity ID ${e.id} has a large input buffer capacity: ${e.inputBufferCapacity}`),t.push(o.ValidationMessages.largeBufferCapacity("Activity",e.id,"input"))),"number"!=typeof e.outputBufferCapacity||e.outputBufferCapacity<0?(this.log(`Activity ID ${e.id} has an invalid output buffer capacity: ${e.outputBufferCapacity}`),t.push(o.ValidationMessages.invalidBufferCapacity("Activity",e.id,"output"))):e.outputBufferCapacity>r.MAX_BUFFER_SIZE&&(this.log(`Activity ID ${e.id} has a large output buffer capacity: ${e.outputBufferCapacity}`),t.push(o.ValidationMessages.largeBufferCapacity("Activity",e.id,"output")))}validateOperationSteps(e,t){return this.log(`Validating operation steps for Activity ID: ${e.id}`),Array.isArray(e.operationSteps)?0===e.operationSteps.length?(this.log(`Activity ID ${e.id} has an empty operation step list.`),void t.push(o.ValidationMessages.noOperationSteps(e.id))):void e.operationSteps.forEach(((i,n)=>{this.validateOperationStep(e.id,i,n,t)})):(this.log(`Activity ID ${e.id} has no operation steps defined.`),void t.push(o.ValidationMessages.missingOperationSteps(e.id)))}validateOperationStep(e,t,i,n){var a;if(this.log(`Validating operation step ${i+1} for Activity ID: ${e}`),null===(a=t.duration)||void 0===a?void 0:a.durationLength){const a=t.duration.durationLength;(a<r.MIN_CYCLE_TIME||a>r.MAX_CYCLE_TIME)&&(this.log(`Operation step ${i+1} for Activity ID ${e} has an unusual duration: ${a}`),n.push(o.ValidationMessages.unusualStepDuration(e,i+1,a)))}else this.log(`Operation step ${i+1} for Activity ID ${e} has an invalid duration.`),n.push(o.ValidationMessages.invalidStepDuration(e,i+1));t.requirementId&&this.validateResourceRequirement(e,t.requirementId,t.quantity,i,n)}validateResourceRequirement(e,t,i,n,o){i<1&&o.push({type:"error",message:`Operation step ${n+1} has invalid quantity: ${i}`,elementId:e})}validateOperationSequence(e,t,i){var n,r;if(this.log(`Validating operation sequence for Activity ID: ${e.id}`),!(null===(n=e.operationSteps)||void 0===n?void 0:n.length))return;const a=(null===(r=t.modelDefinition.resourceRequirements)||void 0===r?void 0:r.getAll())||[],s=new Map(a.map((e=>[e.id,e])));let l=!1;e.operationSteps.forEach((e=>{if(e.requirementId){const t=s.get(e.requirementId);null==t||t.rootClauses.forEach((e=>{e&&e.requests.length>0&&(l=!0)}))}})),l&&(this.log(`Resource requests detected but no release logic for Activity ID: ${e.id}`),i.push(o.ValidationMessages.resourceLeak(e.id)))}validateBufferConstraints(e,t,i){this.log(`Validating buffer constraints for Activity ID: ${e.id}`);const n=t.activityRelationships.get(e.id);n&&Array.from(n.incomingConnectors).reduce(((e,i)=>{const n=t.connections.get(i);if(n){const i=t.modelDefinition.activities.get(n.sourceId);i&&(e+=i.capacity)}return e}),0)>2*e.inputBufferCapacity&&(this.log(`Activity ID ${e.id} has insufficient input buffer capacity.`),i.push(o.ValidationMessages.smallInputBuffer(e.id)))}validateActivityInteractions(e,t){this.log("Validating activity interactions for potential deadlocks.");const i=e.modelDefinition.activities.getAll(),n=new Set,o=new Set;i.forEach((i=>{n.has(i.id)||this.detectCycles(i.id,e,n,o,t)}))}detectCycles(e,t,i,n,r){i.add(e),n.add(e);const a=t.activityRelationships.get(e);a&&a.outgoingConnectors.forEach((a=>{const s=t.connections.get(a);if(s){const a=s.targetId;i.has(a)?n.has(a)&&(this.log(`Circular dependency detected involving Activity ID ${e}`),r.push(o.ValidationMessages.circularDependency(e))):this.detectCycles(a,t,i,n,r)}})),n.delete(e)}}t.ActivityValidation=r,r.MAX_BUFFER_SIZE=1e4,r.MIN_CYCLE_TIME=.001,r.MAX_CYCLE_TIME=86400},1030:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectorValidation=void 0;const n=i(665),o=i(9843),r=i(6491);class a extends n.ValidationRule{validate(e,t){const i=e.modelDefinition.connectors.getAll(),n=this.groupConnectorsBySource(i);this.log("Starting validation of individual connectors."),i.forEach((i=>{this.validateConnectorEndpoints(i,e,t),this.validateConnectorData(i,t),this.validateConnectorType(i,t)})),this.log("Validating probability distributions for connector groups."),n.forEach(((e,i)=>{this.validateProbabilityGroup(i,e,t)})),this.log("Detecting circular references in connectors."),this.detectCircularReferences(e,t),this.log("Completed validation of connectors.")}groupConnectorsBySource(e){const t=new Map;return e.forEach((e=>{const i=t.get(e.sourceId)||[];i.push(e),t.set(e.sourceId,i)})),t}validateConnectorEndpoints(e,t,i){this.log(`Validating endpoints for Connector ID: ${e.id}`),t.modelDefinition.activities.get(e.sourceId)||(this.log(`Connector ID ${e.id} has an invalid source ID: ${e.sourceId}`),i.push(o.ValidationMessages.invalidConnection(e.id,"source",e.sourceId))),t.modelDefinition.activities.get(e.targetId)||(this.log(`Connector ID ${e.id} has an invalid target ID: ${e.targetId}`),i.push(o.ValidationMessages.invalidConnection(e.id,"target",e.targetId))),e.sourceId===e.targetId&&(this.log(`Connector ID ${e.id} is self-referencing.`),i.push(o.ValidationMessages.isolatedElement("Connector",e.id)))}validateConnectorData(e,t){this.log(`Validating data for Connector ID: ${e.id}`),e.name&&0!==e.name.trim().length||(this.log(`Connector ID ${e.id} has a missing name.`),t.push(o.ValidationMessages.missingName("Connector",e.id))),("number"!=typeof e.probability||e.probability<0||e.probability>1)&&(this.log(`Connector ID ${e.id} has an invalid probability: ${e.probability}`),t.push({type:"error",message:`Connector ${e.id} has invalid probability (must be between 0 and 1)`,elementId:e.id})),e.operationSteps&&e.operationSteps.length>0&&e.operationSteps.forEach(((i,n)=>{i.duration||(this.log(`Connector ID ${e.id} operation step ${n+1} has no duration.`),t.push({type:"error",message:`Connector ${e.id} operation step ${n+1} has no duration specified`,elementId:e.id}))}))}validateConnectorType(e,t){this.log(`Validating type for Connector ID: ${e.id}`),Object.values(r.ConnectType).includes(e.connectType)||(this.log(`Connector ID ${e.id} has an invalid connect type: ${e.connectType}`),t.push({type:"error",message:`Connector ${e.id} has invalid connect type: ${e.connectType}`,elementId:e.id}))}validateProbabilityGroup(e,t,i){this.log(`Validating probability group for Source ID: ${e}`);const n=t.filter((e=>e.connectType===r.ConnectType.Probability));if(n.length>0){const t=n.reduce(((e,t)=>e+t.probability),0);Math.abs(t-1)>a.PROBABILITY_TOLERANCE&&(this.log(`Probability sum for Source ID ${e} is invalid: ${t.toFixed(4)}`),i.push({type:"error",message:`Outgoing connection probabilities from activity ${e} sum to ${t.toFixed(4)} (should be 1.0)`,elementId:e}))}t.length>a.MAX_OUTGOING_CONNECTIONS&&(this.log(`Source ID ${e} has too many outgoing connections: ${t.length}`),i.push({type:"warning",message:`Activity ${e} has unusually high number of outgoing connections (${t.length})`,elementId:e}))}detectCircularReferences(e,t){this.log("Detecting circular references in connectors.");const i=new Set,n=new Set,o=(r,a=[])=>{if(n.has(r))return this.log(`Circular reference detected: ${[...a,r].join(" -> ")}`),t.push({type:"warning",message:`Circular reference detected: ${[...a,r].join(" -> ")}`,elementId:r}),!0;if(i.has(r))return!1;i.add(r),n.add(r);const s=e.modelDefinition.connectors.getAll().filter((e=>e.sourceId===r));for(const e of s)if(o(e.targetId,[...a,r]))return!0;return n.delete(r),!1};e.modelDefinition.activities.getAll().forEach((e=>{i.has(e.id)||o(e.id)}))}}t.ConnectorValidation=a,a.PROBABILITY_TOLERANCE=1e-4,a.MAX_OUTGOING_CONNECTIONS=20},9357:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ElementCountsValidation=void 0;const n=i(665);class o extends n.ValidationRule{validate(e,t){const{modelDefinition:i}=e;this.log("Starting validation of element counts."),0===i.generators.size()&&(this.log("Validation failed: Model has no generators."),t.push({type:"error",message:"Model must have at least one generator"})),0===i.activities.size()&&(this.log("Validation failed: Model has no activities."),t.push({type:"error",message:"Model must have at least one activity"})),0===i.entities.size()&&(this.log("Validation failed: Model has no entities."),t.push({type:"error",message:"Model must have at least one entity"})),this.log("Completed validation of element counts.")}}t.ElementCountsValidation=o},4900:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EntityValidation=void 0;const n=i(665),o=i(9843);class r extends n.ValidationRule{validate(e,t){const i=e.modelDefinition.entities.getAll();if(this.log("Starting validation of entities."),0===i.length)return this.log("Validation failed: No entities defined."),void t.push(o.ValidationMessages.missingRequiredElement("entity"));i.forEach((i=>{this.validateEntityData(i,t),this.validateEntityUsage(i,e,t)})),this.log("Completed validation of entities.")}validateEntityData(e,t){this.log(`Validating data for Entity ID: ${e.id}`),e.name&&0!==e.name.trim().length||(this.log(`Entity ID ${e.id} has a missing name.`),t.push(o.ValidationMessages.missingName("Entity",e.id))),e.id&&0!==e.id.trim().length||(this.log(`Entity ID ${e.id} has missing or invalid ID.`),t.push({type:"error",message:"Entity has missing or invalid ID",elementId:e.id})),"New Entity"===e.name&&(this.log(`Entity ID ${e.id} is using the default name.`),t.push({type:"warning",message:`Entity ${e.id} is using default name`,elementId:e.id}))}validateEntityUsage(e,t,i){this.log(`Validating usage for Entity ID: ${e.id}`),t.modelDefinition.generators.getAll().some((t=>t.entityId===e.id))||(this.log(`Entity ID ${e.id} is not used by any generator.`),i.push({type:"warning",message:`Entity ${e.id} is not used by any generator`,elementId:e.id})),t.modelDefinition.entities.getAll().filter((t=>t.id!==e.id&&t.name.trim().toLowerCase()===e.name.trim().toLowerCase())).length>0&&(this.log(`Entity ID ${e.id} has a name conflict with other entities.`),i.push({type:"warning",message:`Entity ${e.id} has a name that conflicts with other entities`,elementId:e.id}))}}t.EntityValidation=r},916:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GeneratorValidation=void 0;const n=i(665),o=i(9843);class r extends n.ValidationRule{validate(e,t){const i=e.modelDefinition.generators.getAll();i.forEach((i=>{this.validateGeneratorConnectivity(i,e,t),this.validateGeneratorData(i,e,t),this.validateDurationSettings(i,t),this.validateEntitySettings(i,e,t)})),this.validateGeneratorInteractions(i,t)}validateGeneratorConnectivity(e,t,i){this.log(`Starting connectivity validation for Generator ID: ${e.id}, Name: ${e.name}`),Array.from(t.connections.values()).some((t=>t.sourceId===e.id))?this.log(`Validation passed: Generator ID ${e.id} has outgoing connections.`):(this.log(`Validation failed: Generator ID ${e.id} has no outgoing connections.`),i.push(o.ValidationMessages.isolatedElement("Generator",e.id))),this.log(`Completed connectivity validation for Generator ID: ${e.id}`)}validateGeneratorData(e,t,i){this.log(`Starting validation for Generator ID: ${e.id}, Name: ${e.name}`),e.name&&0!==e.name.trim().length||(this.log(`Validation failed: Generator ID ${e.id} has an empty or missing name.`),i.push(o.ValidationMessages.missingName("Generator",e.id))),("number"!=typeof e.entitiesPerCreation||e.entitiesPerCreation<r.MIN_ENTITIES_PER_CREATION||e.entitiesPerCreation>r.MAX_ENTITIES_PER_CREATION)&&(this.log(`Validation failed: Generator ID ${e.id} has invalid entitiesPerCreation (${e.entitiesPerCreation}).`),i.push(o.ValidationMessages.generatorValidation("entities per creation",e.id,`Must be between ${r.MIN_ENTITIES_PER_CREATION} and ${r.MAX_ENTITIES_PER_CREATION}`))),e.periodicOccurrences!==1/0&&("number"!=typeof e.periodicOccurrences||e.periodicOccurrences<r.MIN_PERIODIC_OCCURRENCES)&&(this.log(`Validation failed: Generator ID ${e.id} has invalid periodicOccurrences (${e.periodicOccurrences}).`),i.push(o.ValidationMessages.generatorValidation("periodic occurrences",e.id,"Must be Infinity or a number greater than 0"))),e.maxEntities!==1/0&&("number"!=typeof e.maxEntities||e.maxEntities<r.MIN_MAX_ENTITIES||e.maxEntities>r.MAX_MAX_ENTITIES)&&(this.log(`Validation failed: Generator ID ${e.id} has invalid maxEntities (${e.maxEntities}).`),i.push(o.ValidationMessages.generatorValidation("maximum entities limit",e.id,`Must be Infinity or between ${r.MIN_MAX_ENTITIES} and ${r.MAX_MAX_ENTITIES}`))),e.activityKeyId&&(t.modelDefinition.activities.get(e.activityKeyId)||(this.log(`Validation failed: Generator ID ${e.id} references a non-existent activity (${e.activityKeyId}).`),i.push({type:"error",message:`Generator ${e.id} references non-existent activity ${e.activityKeyId}`,elementId:e.id}))),this.log(`Completed validation for Generator ID: ${e.id}`)}validateDurationSettings(e,t){var i,n;this.log(`Starting duration settings validation for Generator ID: ${e.id}`),e.periodIntervalDuration&&e.periodIntervalDuration.durationLength||(this.log(`Validation failed: Generator ID ${e.id} has invalid period interval duration.`),t.push(o.ValidationMessages.generatorValidation("period interval duration",e.id,"Must have a valid duration length"))),e.periodicStartDuration&&e.periodicStartDuration.durationLength||(this.log(`Validation failed: Generator ID ${e.id} has invalid periodic start duration.`),t.push(o.ValidationMessages.generatorValidation("periodic start duration",e.id,"Must have a valid duration length"))),(null===(i=e.periodIntervalDuration)||void 0===i?void 0:i.durationLength)&&(null===(n=e.periodicStartDuration)||void 0===n?void 0:n.durationLength)&&e.periodicStartDuration.durationLength>e.periodIntervalDuration.durationLength&&(this.log(`Warning: Generator ID ${e.id} has start duration longer than interval duration.`),t.push({type:"warning",message:`Generator ${e.id} has start duration longer than interval duration`,elementId:e.id})),this.log(`Completed duration settings validation for Generator ID: ${e.id}`)}validateEntitySettings(e,t,i){this.log(`Starting entity settings validation for Generator ID: ${e.id}`),e.entityId?t.modelDefinition.entities.get(e.entityId)||(this.log(`Validation failed: Generator ID ${e.id} references a non-existent entity (${e.entityId}).`),i.push(o.ValidationMessages.generatorValidation("entity reference",e.id,`References non-existent entity ${e.entityId}`))):(this.log(`Validation failed: Generator ID ${e.id} does not specify an entity ID.`),i.push(o.ValidationMessages.generatorValidation("entity reference",e.id,"Must specify an entity ID"))),e.periodicOccurrences!==1/0&&e.maxEntities!==1/0&&e.periodicOccurrences*e.entitiesPerCreation>e.maxEntities&&(this.log(`Warning: Generator ID ${e.id} may exceed maximum entities limit.`),i.push({type:"warning",message:`Generator ${e.id} may reach maximum entities limit before completing all periodic occurrences`,elementId:e.id})),this.log(`Completed entity settings validation for Generator ID: ${e.id}`)}validateGeneratorInteractions(e,t){var i;this.log("Starting generator interactions validation.");const n=new Map;e.forEach((e=>{var t;const i=(null===(t=e.periodicStartDuration)||void 0===t?void 0:t.durationLength)||0,o=n.get(i)||[];o.push(e),n.set(i,o)})),n.forEach(((e,i)=>{e.length>1&&(this.log(`Warning: Overlapping start times detected for Generators: ${e.map((e=>e.id)).join(", ")} at time ${i}.`),t.push({type:"warning",message:`Multiple generators (${e.map((e=>e.id)).join(", ")}) start at the same time (${i})`,elementId:e[0].id}))}));let o=0;e.forEach((e=>{var t;if(null===(t=e.periodIntervalDuration)||void 0===t?void 0:t.durationLength){const t=e.entitiesPerCreation/e.periodIntervalDuration.durationLength;o+=t}})),o>1e3&&(this.log(`Warning: High entity generation rate detected (${o.toFixed(2)} entities/second).`),t.push({type:"warning",message:`High entity generation rate detected (${o.toFixed(2)} entities/second)`,elementId:null===(i=e[0])||void 0===i?void 0:i.id})),this.log("Completed generator interactions validation.")}}t.GeneratorValidation=r,r.MIN_ENTITIES_PER_CREATION=1,r.MAX_ENTITIES_PER_CREATION=1e3,r.MIN_PERIODIC_OCCURRENCES=1,r.MIN_MAX_ENTITIES=1,r.MAX_MAX_ENTITIES=1e6},7597:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ModelValidationService=void 0;const n=i(6491),o=i(4818),r=i(1030),a=i(9357),s=i(916),l=i(1511),c=i(9843),d=i(4900);class u extends n.QuodsiLogger{constructor(){super(),this.LOG_PREFIX="[ModelValidation]",this.cachedState=null,this.lastModelDefinitionHash=null,this.rules=[new a.ElementCountsValidation,new o.ActivityValidation,new r.ConnectorValidation,new s.GeneratorValidation,new l.ResourceValidation,new d.EntityValidation],this.setLogging(!1)}validate(e){const t=[];try{const i=this.generateModelHash(e),n=this.getModelState(e,i);this.batchValidate(n,t),0===t.length&&t.push(c.ValidationMessages.validationSuccess());const o=this.calculateValidationMetrics(t);return this.logValidationResults(o),o}catch(e){return this.logError("[ModelValidation] Validation error:",e),{isValid:!1,errorCount:1,warningCount:0,messages:[c.ValidationMessages.validationError(e)]}}}setRuleLogging(e,t){const i=this.rules.find((t=>t.constructor.name===e));i?(i.setLogging(t),this.log(`[ModelValidationService] Logging for ${e} set to ${t}`)):console.warn(`[ModelValidationService] Validation rule ${e} not found.`)}generateModelHash(e){return`${e.activities.size()}-${e.connectors.size()}-${e.resources.size()}-${e.generators.size()}`}getModelState(e,t){if(this.cachedState&&this.lastModelDefinitionHash===t)return this.cachedState;const i={modelDefinition:e,connections:new Map(e.connectors.getAll().map((e=>[e.id,e]))),activityRelationships:this.buildActivityRelationships(e)};return this.cachedState=i,this.lastModelDefinitionHash=t,i}batchValidate(e,t){this.log("[ModelValidation] Starting batch validation.");const i=this.rules.map((i=>new Promise((n=>{i.validate(e,t),n()}))));Promise.all(i).then((()=>{this.log("[ModelValidation] Batch validation completed.")}))}calculateValidationMetrics(e){const t=e.filter((e=>"error"===e.type)).length;return{isValid:0===t,errorCount:t,warningCount:e.filter((e=>"warning"===e.type)).length,messages:e}}logValidationResults(e){this.log("[ModelValidation] Validation results:",{isValid:e.isValid,errorCount:e.errorCount,warningCount:e.warningCount,messageCount:e.messages.length,messages:e.messages})}buildActivityRelationships(e){var t;const i=new Map,n=(null===(t=e.resourceRequirements)||void 0===t?void 0:t.getAll())||[],o=new Map(n.map((e=>[e.id,e]))),r=e.activities.getAll(),a=e.connectors.getAll();return r.forEach((e=>{i.set(e.id,{incomingConnectors:new Set,outgoingConnectors:new Set,assignedResources:new Set})})),a.forEach((e=>{const t=i.get(e.sourceId),n=i.get(e.targetId);t&&t.outgoingConnectors.add(e.id),n&&n.incomingConnectors.add(e.id)})),r.forEach((e=>{const t=i.get(e.id);t&&e.operationSteps&&e.operationSteps.forEach((e=>{if(e.requirementId){const i=o.get(e.requirementId);i&&i.rootClauses.forEach((e=>{e.requests.forEach((e=>{t.assignedResources.add(e.resourceId)}))}))}}))})),i}}t.ModelValidationService=u},1511:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceValidation=void 0;const n=i(665),o=i(6491);class r extends n.ValidationRule{validate(e,t){const i=e.modelDefinition.resources.getAll();this.log("Starting validation of resources."),i.forEach((e=>{this.validateResourceData(e,t)})),this.validateResourceUsage(e,t),this.log("Completed validation of resources.")}validateResourceData(e,t){this.log(`Validating data for Resource ID: ${e.id}`),e.name&&0!==e.name.trim().length||(this.log(`Resource ID ${e.id} has no name.`),t.push({type:"warning",message:`Resource ${e.id} has no name`,elementId:e.id})),("number"!=typeof e.capacity||e.capacity<1)&&(this.log(`Resource ID ${e.id} has invalid capacity: ${e.capacity}`),t.push({type:"error",message:`Resource ${e.id} has invalid capacity (must be >= 1)`,elementId:e.id})),Math.floor(e.capacity)!==e.capacity&&(this.log(`Resource ID ${e.id} has non-integer capacity: ${e.capacity}`),t.push({type:"error",message:`Resource ${e.id} capacity must be a whole number`,elementId:e.id})),e.capacity>1e6&&(this.log(`Resource ID ${e.id} has unusually high capacity: ${e.capacity}`),t.push({type:"warning",message:`Resource ${e.id} has unusually high capacity (${e.capacity})`,elementId:e.id}))}validateResourceUsage(e,t){var i;this.log("Validating resource usage across activities.");const n=e.modelDefinition.resources.getAll(),o=e.modelDefinition.activities.getAll(),r=(null===(i=e.modelDefinition.resourceRequirements)||void 0===i?void 0:i.getAll())||[],a=new Map(r.map((e=>[e.id,e]))),s=new Map;n.forEach((e=>{s.set(e.id,new Set)})),o.forEach((e=>{e.operationSteps&&e.operationSteps.forEach((i=>{if(i.requirementId){const n=a.get(i.requirementId);n?this.processResourceRequirement(n,e,s,t):t.push({type:"error",message:`Invalid resource requirement reference: ${i.requirementId}`,elementId:e.id})}}))})),s.forEach(((e,i)=>{0===e.size&&(this.log(`Resource ID ${i} is not used by any activity.`),t.push({type:"warning",message:`Resource ${i} is not used by any activity`,elementId:i}))})),this.checkResourceConflicts(e,s,t)}processResourceRequirement(e,t,i,n){e.rootClauses.forEach((e=>{(e.mode===o.RequirementMode.REQUIRE_ALL||e.mode===o.RequirementMode.REQUIRE_ANY)&&e.requests.forEach((e=>{this.addResourceUsage(e.resourceId,t,i)}))}))}addResourceUsage(e,t,i){const n=i.get(e);n?n.add(t.id):this.log(`Warning: Reference to non-existent resource ID: ${e}`)}processResourceRequests(e,t,i,n){e.forEach((e=>{if(e.requests)this.processResourceRequests(e.requests,t,i,n);else if(e.resource){const o=e.resource.id,r=i.get(o);r?(r.add(t.id),("number"!=typeof e.quantity||e.quantity<1)&&(this.log(`Activity ID ${t.id} has invalid resource quantity for Resource ID ${o}`),n.push({type:"error",message:`Invalid resource quantity in activity ${t.id} for resource ${o}`,elementId:t.id}))):(this.log(`Activity ID ${t.id} references non-existent Resource ID ${o}`),n.push({type:"error",message:`Activity ${t.id} references non-existent resource ${o}`,elementId:t.id}))}}))}checkResourceConflicts(e,t,i){this.log("Checking for resource usage conflicts."),e.modelDefinition.resources.getAll().forEach((n=>{const o=t.get(n.id);o&&o.size>1&&this.validateConcurrentResourceUsage(e,n,Array.from(o),i)}))}validateConcurrentResourceUsage(e,t,i,n){this.log(`Validating concurrent usage for Resource ID: ${t.id}`);const o=i.map((t=>e.modelDefinition.activities.get(t))).filter((e=>void 0!==e));let r=0;o.forEach((e=>{const i=this.calculateMaxResourceDemand(e,t.id);r+=i})),r>t.capacity&&(this.log(`Resource ID ${t.id} might be overutilized. Capacity: ${t.capacity}, Demand: ${r}`),n.push({type:"warning",message:`Potential resource conflict: Resource ${t.id} (capacity: ${t.capacity}) might be overutilized. Maximum possible demand: ${r}`,elementId:t.id}))}calculateMaxResourceDemand(e,t){var i;let n=0;return null===(i=e.operationSteps)||void 0===i||i.forEach((e=>{var i;(null===(i=e.resourceSetRequest)||void 0===i?void 0:i.requests)&&e.resourceSetRequest.requests.forEach((e=>{var i;(null===(i=e.resource)||void 0===i?void 0:i.id)===t&&(n=Math.max(n,e.quantity||0))}))})),n}}t.ResourceValidation=r},9843:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ValidationMessages=void 0,t.ValidationMessages=class{static missingName(e,t){return{type:"warning",message:`${e} ${t} has no name`,elementId:t}}static isolatedElement(e,t){return{type:"error",message:`${e} ${t} is isolated (no connections)`,elementId:t}}static invalidConnection(e,t,i){return{type:"error",message:`Connector ${e} has invalid ${t} (${i})`,elementId:e}}static invalidCapacity(e,t,i=1){return{type:"error",message:`${e} ${t} has invalid capacity (must be >= ${i})`,elementId:t}}static noConnections(e,t,i){return{type:"warning",message:`${e} ${t} has no ${i} connections (potential ${"incoming"===i?"start":"end"} activity)`,elementId:t}}static largeBufferCapacity(e,t,i){return{type:"warning",message:`${e} ${t} has unusually large ${i} buffer capacity`,elementId:t}}static invalidBufferCapacity(e,t,i){return{type:"error",message:`${e} ${t} has invalid ${i} buffer capacity`,elementId:t}}static missingOperationSteps(e){return{type:"error",message:`Activity ${e} is missing operation steps property`,elementId:e}}static noOperationSteps(e){return{type:"warning",message:`Activity ${e} has no operation steps defined`,elementId:e}}static invalidStepDuration(e,t){return{type:"error",message:`Activity ${e} operation step ${t} has invalid duration`,elementId:e}}static unusualStepDuration(e,t,i){return{type:"warning",message:`Activity ${e} operation step ${t} has unusual duration (${i} seconds)`,elementId:e}}static duplicateResourceRequest(e,t){return{type:"warning",message:`Activity ${e} operation step ${t} requests the same resource multiple times`,elementId:e}}static invalidResourceQuantity(e,t){return{type:"error",message:`Activity ${e} operation step ${t} has invalid resource quantity`,elementId:e}}static unusualCycleTime(e,t,i){return{type:"warning",message:`Activity ${e} has unusually ${t} ${"short"===t?"minimum":"maximum"} cycle time (${i} seconds)`,elementId:e}}static bufferOverflowRisk(e){return{type:"warning",message:`Activity ${e} may experience input buffer overflow at maximum throughput`,elementId:e}}static smallInputBuffer(e){return{type:"warning",message:`Activity ${e} input buffer may be too small for incoming flow capacity`,elementId:e}}static circularDependency(e){return{type:"warning",message:`Potential circular dependency detected involving activity ${e}`,elementId:e}}static resourceLeak(e){return{type:"warning",message:`Activity ${e} requests resources but never releases them`,elementId:e}}static validationSuccess(){return{type:"info",message:"Model validation passed successfully"}}static validationError(e){return{type:"error",message:`Validation failed: ${e instanceof Error?e.message:"Unknown error"}`}}static generatorValidation(e,t,i){return{type:"error",message:`Generator ${t} has invalid ${e}: ${i}`,elementId:t}}static missingRequiredElement(e){return{type:"error",message:`Model must have at least one ${e}`}}}},665:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ValidationRule=void 0,t.ValidationRule=class{constructor(){this.loggingEnabled=!1}setLogging(e){this.loggingEnabled=e}isLoggingEnabled(){return this.loggingEnabled}log(e){this.isLoggingEnabled()&&console.log(`[${this.constructor.name}] ${e}`)}}},5412:function(e,t){var i=this&&this.__spreadArray||function(e,t,i){if(i||2===arguments.length)for(var n,o=0,r=t.length;o<r;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.QuodsiLogger=void 0;var n=function(){function e(){this.loggingEnabled=!1}return e.prototype.setLogging=function(t){e.instanceMap.has(this.LOG_PREFIX),e.instanceMap.set(this.LOG_PREFIX,t),this.loggingEnabled=t,t&&this.log("Logging enabled")},e.prototype.isLoggingEnabled=function(){return e.instanceMap.has(this.LOG_PREFIX)||(e.instanceMap.set(this.LOG_PREFIX,!1),this.loggingEnabled=!1),this.loggingEnabled},e.prototype.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.isLoggingEnabled()&&console.log.apply(console,i(["".concat(this.LOG_PREFIX," ").concat(e)],t,!1))},e.prototype.logError=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.isLoggingEnabled()&&console.error.apply(console,i(["".concat(this.LOG_PREFIX," ").concat(e)],t,!1))},e.prototype.logWarning=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.isLoggingEnabled()&&console.warn.apply(console,i(["".concat(this.LOG_PREFIX," ").concat(e)],t,!1))},e.prototype.logDebug=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.isLoggingEnabled()&&console.debug.apply(console,i(["".concat(this.LOG_PREFIX," ").concat(e)],t,!1))},e.instanceMap=new Map,e}();t.QuodsiLogger=n},5904:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationObjectTypeFactory=void 0;var n=i(6491);!function(e){function t(e){return n.Activity.createDefault(e)}function i(e){return n.Connector.createDefault(e)}function o(e){return n.Generator.createDefault(e)}function r(e){return n.Resource.createDefault(e)}function a(e){return n.Entity.createDefault(e)}e.createActivity=t,e.createConnector=i,e.createGenerator=o,e.createResource=r,e.createEntity=a,e.createElement=function(e,s){switch(e){case n.SimulationObjectType.Activity:return t(s);case n.SimulationObjectType.Connector:return i(s);case n.SimulationObjectType.Generator:return o(s);case n.SimulationObjectType.Resource:return r(s);case n.SimulationObjectType.Entity:return a(s);default:return{id:s,name:"New ".concat(e),type:e}}}}(t.SimulationObjectTypeFactory||(t.SimulationObjectTypeFactory={}))},6491:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),o(i(5412),t),o(i(8357),t),o(i(6690),t),o(i(7496),t),o(i(7967),t),o(i(9150),t),o(i(4992),t),o(i(351),t),o(i(6898),t),o(i(9619),t),o(i(9419),t),o(i(8092),t),o(i(2800),t),o(i(5817),t),o(i(8305),t),o(i(1540),t),o(i(3349),t),o(i(3494),t),o(i(9458),t),o(i(3323),t),o(i(6861),t),o(i(2836),t),o(i(8105),t),o(i(2373),t),o(i(2601),t),o(i(6601),t),o(i(9283),t),o(i(2603),t),o(i(9780),t),o(i(2105),t),o(i(8548),t),o(i(3922),t),o(i(3627),t),o(i(2754),t),o(i(2448),t),o(i(4491),t),o(i(3045),t),o(i(7932),t),o(i(2372),t),o(i(7199),t),o(i(3951),t),o(i(5164),t),o(i(2258),t),o(i(6448),t),o(i(2305),t),o(i(2439),t),o(i(3215),t),o(i(9181),t),o(i(5904),t),o(i(5725),t),o(i(1120),t),o(i(6708),t),o(i(7053),t),o(i(3655),t),o(i(1429),t),o(i(1056),t)},1429:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var i,n,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(s){return function(l){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;r&&(r=0,s[0]&&(a=0)),a;)try{if(i=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{i=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createLucidApiService=t.LucidApiService=void 0;var a=r(i(7764)),s=function(){function e(e){if(!e)throw new Error("baseUrl is required for LucidApiService");this.baseURL=e}return e.prototype.simulateDocument=function(e,t,i,r){return n(this,void 0,void 0,(function(){var n,s,l,c;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),n="".concat(this.baseURL,"Lucid/simulate/").concat(e,"?pageId=").concat(t,"&userId=").concat(i),s={Accept:"application/json","Content-Type":"application/json"},r&&(s.Authorization="Bearer ".concat(r)),[4,(0,a.default)({method:"POST",url:n,headers:s})];case 1:if(200!==(l=o.sent()).status)throw new Error("HTTP error! status: ".concat(l.status));return[2,!0];case 2:throw c=o.sent(),console.error("Error in simulateDocument:",c),c;case 3:return[2]}}))}))},e.prototype.getActivityUtilization=function(e,t){return n(this,void 0,void 0,(function(){var i,n,r,s;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),i="".concat(t,"/activity_utilization.csv"),n="".concat(this.baseURL,"Lucid/files/").concat(e,"/").concat(i),[4,(0,a.default)({method:"GET",url:n,responseType:"text"})];case 1:if(200!==(r=o.sent()).status)throw new Error("HTTP error! status: ".concat(r.status));return[2,r.data];case 2:throw s=o.sent(),console.error("Error in getActivityUtilization:",s),s;case 3:return[2]}}))}))},e.prototype.getSimulationStatus=function(e){return n(this,void 0,void 0,(function(){var t,i,n;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t="".concat(this.baseURL,"Lucid/status/").concat(e),[4,(0,a.default)({method:"GET",url:t,headers:{Accept:"application/json"}})];case 1:if(200!==(i=o.sent()).status)throw new Error("HTTP error! status: ".concat(i.status));return[2,i.data];case 2:throw n=o.sent(),console.error("Error in getSimulationStatus:",n),n;case 3:return[2]}}))}))},e}();t.LucidApiService=s,t.createLucidApiService=function(e){return new s(e)}},8357:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},6690:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},7496:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},3494:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.DiagramElementType=void 0,(i=t.DiagramElementType||(t.DiagramElementType={})).BLOCK="block",i.LINE="line"},7967:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},1540:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},4992:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},351:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},6898:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},9619:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionType=void 0,(i=t.SelectionType||(t.SelectionType={})).NONE="none",i.UNCONVERTED_ELEMENT="unconverted_element",i.MULTIPLE="multiple",i.UNKNOWN_BLOCK="unknown_block",i.UNKNOWN_LINE="unknown_line",i.ACTIVITY="activity",i.CONNECTOR="connector",i.ENTITY="entity",i.GENERATOR="generator",i.RESOURCE="resource",i.MODEL="model"},8092:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},2800:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationElementFactory=void 0;var n=i(2754),o=i(9458),r=i(2836),a=i(3951),s=i(3922),l=i(9780),c=i(3215),d=i(2373),u=i(9283),p=i(5817);t.SimulationElementFactory={createElement:function(e,t){switch(e.type){case c.SimulationObjectType.Model:return new p.SimulationElementWrapper(this.createModel(t));case c.SimulationObjectType.Activity:return new p.SimulationElementWrapper(this.createActivity(t));case c.SimulationObjectType.Connector:return new p.SimulationElementWrapper(this.createConnector(t));case c.SimulationObjectType.Resource:return new p.SimulationElementWrapper(this.createResource(t));case c.SimulationObjectType.Generator:return new p.SimulationElementWrapper(this.createGenerator(t));case c.SimulationObjectType.Entity:return new p.SimulationElementWrapper(this.createEntity(t));default:throw new Error("Unknown element type: ".concat(e.type))}},createModel:function(e){return new n.Model(e.id,e.name||"New Model",e.reps||1,e.forecastDays||30,e.seed,e.oneClockUnit,e.simulationTimeType,e.warmupClockPeriod,e.warmupClockPeriodUnit,e.runClockPeriod,e.runClockPeriodUnit,e.warmupDateTime?new Date(e.warmupDateTime):null,e.startDateTime?new Date(e.startDateTime):null,e.finishDateTime?new Date(e.finishDateTime):null)},createActivity:function(e){var t,i;return new o.Activity(e.id,e.name||"New Activity",e.capacity||1,null!==(t=e.inputBufferCapacity)&&void 0!==t?t:1/0,null!==(i=e.outputBufferCapacity)&&void 0!==i?i:1/0,e.operationSteps||[])},createConnector:function(e){return new r.Connector(e.id,e.name||"New Connector",e.sourceId,e.targetId,e.probability||1,e.connectType||d.ConnectType.Probability,e.operationSteps||[])},createResource:function(e){return new a.Resource(e.id,e.name||"New Resource",e.capacity||1)},createGenerator:function(e){var t,i;return new s.Generator(e.id,e.name||"New Generator",e.activityKeyId||"",e.entityType||"All",null!==(t=e.periodicOccurrences)&&void 0!==t?t:1/0,e.periodIntervalDuration||new u.Duration,e.entitiesPerCreation||1,e.periodicStartDuration||new u.Duration,null!==(i=e.maxEntities)&&void 0!==i?i:1/0)},createEntity:function(e){return new l.Entity(e.id,e.name||"New Entity")}}},5817:function(e,t,i){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationElementWrapper=void 0;var o=i(3215),r=function(){function e(e,t){void 0===t&&(t="1.0.0"),this.id=e.id,this.type=e.type,this.name=e.name,this.version=t,this.data=e}return e.prototype.validate=function(){var e=[];switch(this.type){case o.SimulationObjectType.Model:this.validateModel(this.data,e);break;case o.SimulationObjectType.Activity:this.validateActivity(this.data,e);break;case o.SimulationObjectType.Connector:this.validateConnector(this.data,e);break;case o.SimulationObjectType.Resource:this.validateResource(this.data,e);break;case o.SimulationObjectType.Generator:this.validateGenerator(this.data,e);break;case o.SimulationObjectType.Entity:this.validateEntity(this.data,e)}var t=e.filter((function(e){return"error"===e.type})).length;return{isValid:0===t,errorCount:t,warningCount:e.filter((function(e){return"warning"===e.type})).length,messages:e}},e.prototype.toStorage=function(){return n(n({},this.data),{version:this.version})},e.prototype.fromStorage=function(t){return new e(t,t.version)},e.prototype.validateModel=function(e,t){e.reps<1&&t.push({type:"error",message:"Model must have at least 1 replication",elementId:e.id}),e.forecastDays<1&&t.push({type:"error",message:"Forecast days must be at least 1",elementId:e.id})},e.prototype.validateActivity=function(e,t){e.capacity<1&&t.push({type:"error",message:"Activity capacity must be at least 1",elementId:e.id}),e.operationSteps&&0!==e.operationSteps.length||t.push({type:"warning",message:"Activity has no operation steps",elementId:e.id})},e.prototype.validateConnector=function(e,t){(e.probability<0||e.probability>1)&&t.push({type:"error",message:"Connector probability must be between 0 and 1",elementId:e.id})},e.prototype.validateResource=function(e,t){e.capacity<1&&t.push({type:"error",message:"Resource capacity must be at least 1",elementId:e.id})},e.prototype.validateGenerator=function(e,t){e.entitiesPerCreation<1&&t.push({type:"error",message:"Generator must create at least 1 entity per creation",elementId:e.id}),e.periodIntervalDuration||t.push({type:"error",message:"Generator must have a period interval duration",elementId:e.id})},e.prototype.validateEntity=function(e,t){e.name&&0!==e.name.trim().length||t.push({type:"warning",message:"Entity has no name",elementId:e.id})},e}();t.SimulationElementWrapper=r},7053:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},5725:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},1120:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},6708:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},9458:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Activity=void 0;var n=i(3215),o=i(7932),r=i(9283),a=i(2372),s=i(2603),l=function(){function e(e,t,i,o,r,a){void 0===i&&(i=1),void 0===o&&(o=1),void 0===r&&(r=1),void 0===a&&(a=[]),this.id=e,this.name=t,this.capacity=i,this.inputBufferCapacity=o,this.outputBufferCapacity=r,this.operationSteps=a,this.type=n.SimulationObjectType.Activity}return e.createDefault=function(t){var i=new r.Duration(1,a.PeriodUnit.MINUTES,s.DurationType.CONSTANT);return new e(t,"New Activity",1,1,1,[(0,o.createOperationStep)(i)])},e}();t.Activity=l},3323:function(e,t,i){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.ActivityListManager=void 0;var r=i(6861),a=i(3215),s=function(e){function t(){return e.call(this,a.SimulationObjectType.Activity)||this}return o(t,e),t}(r.ComponentListManager);t.ActivityListManager=s},6861:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ComponentListManager=void 0;var i=function(){function e(e){this.items=new Map,this.type=e}return e.prototype.getNextName=function(){return"".concat(this.type," ").concat(this.items.size+1)},e.prototype.add=function(e){this.items.set(e.id,e)},e.prototype.remove=function(e){this.items.delete(e)},e.prototype.get=function(e){return this.items.get(e)},e.prototype.getAll=function(){return Array.from(this.items.values())},e.prototype.clear=function(){this.items.clear()},e.prototype.size=function(){return this.items.size},e}();t.ComponentListManager=i},2373:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectTypeUtils=t.ConnectType=void 0,function(e){e.Probability="Probability",e.AttributeValue="AttributeValue"}(i=t.ConnectType||(t.ConnectType={}));var n=function(){function e(){}return e.stringToConnectRule=function(e){var t=e.toLowerCase(),n={percentage:i.Probability,attributevalue:i.AttributeValue};if(t in n)return n[t];throw new Error("Unknown ConnectType: '".concat(e,"'"))},e}();t.ConnectTypeUtils=n},2836:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Connector=void 0;var n=i(3215),o=i(2373),r=function(){function e(e,t,i,r,a,s,l){void 0===a&&(a=1),void 0===s&&(s=o.ConnectType.Probability),void 0===l&&(l=[]),this.id=e,this.name=t,this.sourceId=i,this.targetId=r,this.probability=a,this.connectType=s,this.operationSteps=l,this.type=n.SimulationObjectType.Connector}return e.createDefault=function(t){return new e(t,"New Connector","","",1,o.ConnectType.Probability,[])},e}();t.Connector=r},8105:function(e,t,i){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectorListManager=void 0;var r=i(6861),a=i(3215),s=function(e){function t(){return e.call(this,a.SimulationObjectType.Connector)||this}return o(t,e),t}(r.ComponentListManager);t.ConnectorListManager=s},2601:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Distribution=void 0;t.Distribution=function(e,t,i){void 0===i&&(i=""),this.distributionType=e,this.parameters=t,this.description=i}},6601:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.DistributionType=void 0,(i=t.DistributionType||(t.DistributionType={})).MULTINOMIAL="multinomial",i.UNIFORM="uniform",i.TRIANGULAR="triangular",i.EXPONENTIAL="exponential",i.NORMAL="normal",i.LOGNORMAL="lognormal",i.BETA="beta",i.GAMMA="gamma",i.WEIBULL="weibull",i.DISCRETE="discrete",i.POISSON="poisson",i.BINOMIAL="binomial",i.BERNOULLI="bernoulli",i.GEOMETRIC="geometric",i.NEGATIVE_BINOMIAL="negative_binomial",i.SAMPLE_MULTINOMIAL="sample_multinomial",i.SAMPLE_MULTINOMIAL_ONE="sample_multinomial_one",i.PROBABILITY_VALUES="probability_values",i.SAMPLE_NEXT_SERVICE_INDEX="sample_next_service_index",i.CHI_SQUARE="chisquare",i.F_DISTRIBUTION="f_distribution",i.HYPERGEOMETRIC="hypergeometric",i.LAPLACE="laplace",i.LOGISTIC="logistic",i.LOG_SERIES="logseries",i.PARETO="pareto",i.RAYLEIGH="rayleigh",i.T_DISTRIBUTION="t_distribution",i.VON_MISES="vonmises",i.WALD="wald",i.ZIPF="zipf"},9283:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Duration=void 0;var n=i(2372),o=i(2603);t.Duration=function(e,t,i,r){void 0===e&&(e=0),void 0===t&&(t=n.PeriodUnit.MINUTES),void 0===i&&(i=o.DurationType.CONSTANT),void 0===r&&(r=null),this.durationLength=e,this.durationPeriodUnit=t,this.durationType=i,this.distribution=r}},2603:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.DurationType=void 0,(i=t.DurationType||(t.DurationType={})).CONSTANT="CONSTANT",i.DISTRIBUTION="DISTRIBUTION"},9780:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Entity=void 0;var n=i(3215),o=function(){function e(e,t){this.id=e,this.name=t,this.type=n.SimulationObjectType.Entity}return e.createDefault=function(t){return new e(t,"New Entity")},e}();t.Entity=o},2105:function(e,t,i){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.EntityListManager=void 0;var r=i(6861),a=i(3215),s=function(e){function t(){return e.call(this,a.SimulationObjectType.Entity)||this}return o(t,e),t}(r.ComponentListManager);t.EntityListManager=s},8548:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},3922:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Generator=void 0;var n=i(3215),o=i(9283),r=i(2448),a=i(2372),s=i(2603),l=function(){function e(e,t,i,a,s,l,c,d,u){void 0===i&&(i=""),void 0===a&&(a=r.ModelDefaults.DEFAULT_ENTITY_ID),void 0===s&&(s=1/0),void 0===l&&(l=new o.Duration),void 0===c&&(c=1),void 0===d&&(d=new o.Duration),void 0===u&&(u=1/0),this.id=e,this.name=t,this.activityKeyId=i,this.entityId=a,this.periodicOccurrences=s,this.periodIntervalDuration=l,this.entitiesPerCreation=c,this.periodicStartDuration=d,this.maxEntities=u,this.type=n.SimulationObjectType.Generator}return e.createDefault=function(t){return new e(t,"New Generator","{SomeActivityName}",r.ModelDefaults.DEFAULT_ENTITY_ID,10,new o.Duration(1,a.PeriodUnit.HOURS,s.DurationType.CONSTANT),1,new o.Duration(0,a.PeriodUnit.HOURS,s.DurationType.CONSTANT),999)},e}();t.Generator=l},3627:function(e,t,i){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.GeneratorListManager=void 0;var r=i(6861),a=i(3215),s=function(e){function t(){return e.call(this,a.SimulationObjectType.Generator)||this}return o(t,e),t}(r.ComponentListManager);t.GeneratorListManager=s},2754:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Model=void 0;var n=i(3215),o=i(2372),r=i(9181),a=i(2448),s=function(){function e(e,t,i,o,r,a,s,l,c,d,u,p,h,g){void 0===p&&(p=null),void 0===h&&(h=null),void 0===g&&(g=null),this.id=e,this.name=t,this.reps=i,this.forecastDays=o,this.seed=r,this.oneClockUnit=a,this.simulationTimeType=s,this.warmupClockPeriod=l,this.warmupClockPeriodUnit=c,this.runClockPeriod=d,this.runClockPeriodUnit=u,this.warmupDateTime=p,this.startDateTime=h,this.finishDateTime=g,this.type=n.SimulationObjectType.Model}return e.createDefault=function(t){return new e(t,"New Model",a.ModelDefaults.DEFAULT_REPS,a.ModelDefaults.DEFAULT_FORECAST_DAYS,a.ModelDefaults.DEFAULT_SEED,a.ModelDefaults.DEFAULT_CLOCK_UNIT,r.SimulationTimeType.Clock,0,o.PeriodUnit.HOURS,24,o.PeriodUnit.HOURS,null,null,null)},e}();t.Model=s},2448:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ModelDefaults=void 0;var n,o=i(2372),r=i(9181);(n=t.ModelDefaults||(t.ModelDefaults={})).DEFAULT_SEED=12345,n.DEFAULT_CLOCK_UNIT=o.PeriodUnit.MINUTES,n.DEFAULT_SIMULATION_TIME_TYPE=r.SimulationTimeType.Clock,n.DEFAULT_WARMUP_PERIOD=0,n.DEFAULT_RUN_PERIOD=0,n.DEFAULT_REPS=1,n.DEFAULT_FORECAST_DAYS=30,n.DEFAULT_ENTITY_ID="00000000-0000-0000-0000-000000000000",n.DEFAULT_ENTITY_NAME="Default Entity"},4491:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ModelDefinition=void 0;var n=i(3323),o=i(8105),r=i(9780),a=i(2105),s=i(3627),l=i(2448),c=i(5164),d=i(7853),u=function(){function e(e){this.model=e,this.activities=new n.ActivityListManager,this.connectors=new o.ConnectorListManager,this.resources=new c.ResourceListManager,this.resourceRequirements=new d.ResourceRequirementListManager,this.generators=new s.GeneratorListManager,this.entities=new a.EntityListManager;var t=new r.Entity(l.ModelDefaults.DEFAULT_ENTITY_ID,l.ModelDefaults.DEFAULT_ENTITY_NAME);this.entities.add(t)}return Object.defineProperty(e.prototype,"id",{get:function(){return this.model.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.model.name},enumerable:!1,configurable:!0}),e}();t.ModelDefinition=u},3655:function(e,t,i){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.ModelDefinitionLogger=void 0;var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.LOG_PREFIX="[ModelDefinitionLogger]",t}return o(t,e),t.logModelDefinition=function(e){var i=new t;i.setLogging(!1),i.logDefinition(e)},t.prototype.logDefinition=function(e){this.log("\nLogging Model Definition:");try{this.log("Model ID: ".concat(e.id)),this.log("Model Name: ".concat(e.name)),this.logActivities(e),this.logConnectors(e),this.logResources(e),this.logGenerators(e),this.logEntities(e)}catch(e){this.logError("An error occurred while logging the model definition:",e)}},t.prototype.logActivities=function(e){var t=this;this.log("\nActivities:"),e.activities.getAll().forEach((function(e){return t.safeExecute((function(){return t.logActivity(e)}),"Activity ID: ".concat(null==e?void 0:e.id))}))},t.prototype.logConnectors=function(e){var t=this;this.log("\nConnectors:"),e.connectors.getAll().forEach((function(e){return t.safeExecute((function(){return t.logConnector(e)}),"Connector ID: ".concat(null==e?void 0:e.id))}))},t.prototype.logResources=function(e){var t=this;this.log("\nResources:"),e.resources.getAll().forEach((function(e){return t.safeExecute((function(){return t.logResource(e)}),"Resource ID: ".concat(null==e?void 0:e.id))}))},t.prototype.logResourceRequirements=function(e){var t=this;this.log("ResourceRequirement:"),e.resourceRequirements.getAll().forEach((function(e){return t.safeExecute((function(){return t.logResourceRequirement(e)}),"Resource ID: ".concat(null==e?void 0:e.id))}))},t.prototype.logGenerators=function(e){var t=this;this.log("\nGenerators:"),e.generators.getAll().forEach((function(e){return t.safeExecute((function(){return t.logGenerator(e)}),"Generator ID: ".concat(null==e?void 0:e.id))}))},t.prototype.logEntities=function(e){var t=this;this.log("\nEntities:"),e.entities.getAll().forEach((function(e){return t.safeExecute((function(){return t.logEntity(e)}),"Entity ID: ".concat(null==e?void 0:e.id))}))},t.prototype.safeExecute=function(e,t){try{e()}catch(e){this.logError("Failed to log ".concat(t,":"),e)}},t.prototype.logActivity=function(e){var t,i,n=this;this.log("  Activity ID: ".concat(e.id)),this.log("    Name: ".concat(e.name)),this.log("    Capacity: ".concat(e.capacity)),this.log("    Input Buffer Capacity: ".concat(e.inputBufferCapacity)),this.log("    Output Buffer Capacity: ".concat(e.outputBufferCapacity)),this.log("    Number of Operation Steps: ".concat((null===(t=e.operationSteps)||void 0===t?void 0:t.length)||0)),null===(i=e.operationSteps)||void 0===i||i.forEach((function(e,t){var i;n.log("      Operation Step ".concat(t+1,":")),n.log("        Duration: ".concat((null===(i=e.duration)||void 0===i?void 0:i.durationLength)||"Not defined")),e.requirementId&&(n.log("        Resource Requirement ID: ".concat(e.requirementId)),n.log("        Quantity: ".concat(e.quantity)))}))},t.prototype.logConnector=function(e){var t=this;this.log("  Connector ID: ".concat(e.id)),this.log("    Name: ".concat(e.name||"Unnamed")),this.log("    Source ID: ".concat(e.sourceId||"Not defined")),this.log("    Target ID: ".concat(e.targetId||"Not defined")),this.log("    Probability: ".concat(void 0!==e.probability?e.probability:"Not defined")),this.log("    Connection Type: ".concat(e.connectType||"Not defined"));var i=e.operationSteps;this.log("    Number of Operation Steps: ".concat((null==i?void 0:i.length)||0)),null==i||i.forEach((function(e,i){var n;t.log("      Operation Step ".concat(i+1,":")),t.log("        Duration: ".concat((null===(n=e.duration)||void 0===n?void 0:n.durationLength)||"Not defined")),e.requirementId&&(t.log("        Resource Requirement ID: ".concat(e.requirementId)),t.log("        Quantity: ".concat(e.quantity)))}))},t.prototype.logResource=function(e){this.log("  Resource ID: ".concat(e.id)),this.log("    Name: ".concat(e.name)),this.log("    Capacity: ".concat(e.capacity))},t.prototype.logResourceRequirement=function(e){this.log("  Resource ID: ".concat(e.id)),this.log("    Name: ".concat(e.name))},t.prototype.logGenerator=function(e){var t,i;this.log("  Generator ID: ".concat(e.id)),this.log("    Name: ".concat(e.name||"Unnamed")),this.log("    Activity Key ID: ".concat(e.activityKeyId||"Not defined")),this.log("    Entity ID: ".concat(e.entityId||"Not defined")),this.log("    Periodic Occurrences: ".concat(e.periodicOccurrences||"Not defined"));var n=null===(t=e.periodIntervalDuration)||void 0===t?void 0:t.durationLength;this.log("    Period Interval Duration: ".concat(void 0!==n?n:"Not defined")),this.log("    Entities Per Creation: ".concat(e.entitiesPerCreation||"Not defined"));var o=null===(i=e.periodicStartDuration)||void 0===i?void 0:i.durationLength;this.log("    Periodic Start Duration: ".concat(void 0!==o?o:"Not defined")),this.log("    Max Entities: ".concat(e.maxEntities||"Not defined"))},t.prototype.logEntity=function(e){this.log("  Entity ID: ".concat(e.id)),this.log("    Name: ".concat(e.name))},t}(i(5412).QuodsiLogger);t.ModelDefinitionLogger=r},3045:function(e,t,i){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ModelUtils=void 0;var o=i(9181),r=i(3215),a=i(2448),s=function(){function e(){}return e.generateUUID=function(){var e;try{if("undefined"!=typeof window&&(null===(e=null===window||void 0===window?void 0:window.crypto)||void 0===e?void 0:e.randomUUID))return window.crypto.randomUUID()}catch(e){}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},e.createNew=function(t){return void 0===t&&(t="New Model"),e.createWithDefaults({name:t})},e.createWithDefaults=function(e){var t={id:e.id,name:e.name||"New Model",type:r.SimulationObjectType.Model,reps:a.ModelDefaults.DEFAULT_REPS,forecastDays:a.ModelDefaults.DEFAULT_FORECAST_DAYS,seed:a.ModelDefaults.DEFAULT_SEED,oneClockUnit:a.ModelDefaults.DEFAULT_CLOCK_UNIT,simulationTimeType:a.ModelDefaults.DEFAULT_SIMULATION_TIME_TYPE,warmupClockPeriod:a.ModelDefaults.DEFAULT_WARMUP_PERIOD,warmupClockPeriodUnit:a.ModelDefaults.DEFAULT_CLOCK_UNIT,runClockPeriod:a.ModelDefaults.DEFAULT_RUN_PERIOD,runClockPeriodUnit:a.ModelDefaults.DEFAULT_CLOCK_UNIT,warmupDateTime:null,startDateTime:null,finishDateTime:null};return n(n({},t),e)},e.validate=function(t){var i=n({},t);return i.id||(i.id=e.generateUUID()),i.reps=Math.max(1,t.reps),i.forecastDays=Math.max(1,t.forecastDays),void 0!==i.warmupClockPeriod&&(i.warmupClockPeriod=Math.max(0,i.warmupClockPeriod)),void 0!==i.runClockPeriod&&(i.runClockPeriod=Math.max(0,i.runClockPeriod)),i.simulationTimeType===o.SimulationTimeType.Clock?(i.warmupDateTime=null,i.startDateTime=null,i.finishDateTime=null):i.simulationTimeType===o.SimulationTimeType.CalendarDate&&(i.warmupClockPeriod=void 0,i.runClockPeriod=void 0,i.warmupClockPeriodUnit=void 0,i.runClockPeriodUnit=void 0),i},e.isComplete=function(e){return"string"==typeof e.id&&e.id.length>0&&"string"==typeof e.name&&"number"==typeof e.reps&&"number"==typeof e.forecastDays&&e.type===r.SimulationObjectType.Model},e}();t.ModelUtils=s},7932:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createOperationStep=void 0,t.createOperationStep=function(e,t){var i,n;return void 0===t&&(t={}),{requirementId:null!==(i=t.requirementId)&&void 0!==i?i:null,quantity:null!==(n=t.quantity)&&void 0!==n?n:1,duration:e}}},2372:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.PeriodUnit=void 0,(i=t.PeriodUnit||(t.PeriodUnit={})).SECONDS="SECONDS",i.MINUTES="MINUTES",i.HOURS="HOURS",i.DAYS="DAYS"},2125:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RequirementClause=void 0;var n=i(7199),o=i(2258),r=function(){function e(e,t,i,n,o){void 0===n&&(n=[]),void 0===o&&(o=[]),this.clauseId=e,this.mode=t,this.parentClauseId=i,this.requests=n,this.subClauses=o}return e.prototype.addSubClause=function(e){this.subClauses.push(e)},e.prototype.addRequest=function(e){this.requests.push(e)},e.prototype.validate=function(){if(!this.requests.length&&!this.subClauses.length)throw new Error("RequirementClause ".concat(this.clauseId," must have at least one request or sub-clause."))},e.createSingleRequestClause=function(t,i,r,a,s,l,c){return void 0===r&&(r=1),void 0===a&&(a=n.RequirementMode.REQUIRE_ALL),new e(t,a,s,[o.ResourceRequest.create(i,{quantity:r,priority:l,keepResource:c})])},e.createMultiRequestClause=function(t,i,r,a){return void 0===r&&(r=n.RequirementMode.REQUIRE_ALL),new e(t,r,a,i.map((function(e){return o.ResourceRequest.create(e.resourceId,{quantity:e.quantity,priority:e.priority,keepResource:e.keepResource})})))},e}();t.RequirementClause=r},7199:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.RequirementMode=void 0,(i=t.RequirementMode||(t.RequirementMode={})).REQUIRE_ALL="REQUIRE_ALL",i.REQUIRE_ANY="REQUIRE_ANY"},3951:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Resource=void 0;var n=i(3215),o=function(){function e(e,t,i){void 0===i&&(i=1),this.id=e,this.name=t,this.capacity=i,this.type=n.SimulationObjectType.Resource}return e.createDefault=function(t){return new e(t,"New Resource",1)},e}();t.Resource=o},5164:function(e,t,i){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceListManager=void 0;var r=i(6861),a=i(3215),s=function(e){function t(){return e.call(this,a.SimulationObjectType.Resource)||this}return o(t,e),t}(r.ComponentListManager);t.ResourceListManager=s},2258:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceRequest=void 0;var i=function(){function e(e,t,i,n){void 0===t&&(t=1),void 0===i&&(i=1),void 0===n&&(n=!1),this.resourceId=e,this.quantity=t,this.priority=i,this.keepResource=n}return e.create=function(t,i){var n,o,r;return void 0===i&&(i={}),new e(t,null!==(n=i.quantity)&&void 0!==n?n:1,null!==(o=i.priority)&&void 0!==o?o:1,null!==(r=i.keepResource)&&void 0!==r&&r)},e.prototype.validate=function(){if(this.quantity<=0)throw new Error("Quantity must be greater than 0.");if(this.priority<1)throw new Error("Priority must be at least 1.")},e.prototype.toJSON=function(){return{resourceId:this.resourceId,quantity:this.quantity,priority:this.priority,keepResource:this.keepResource}},e}();t.ResourceRequest=i},6448:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceRequirement=void 0;var n=i(2125),o=i(7199),r=i(3215),a=i(2258),s=function(){function e(e,t,i){void 0===i&&(i=[]),this.type=r.SimulationObjectType.ResourceRequirement,this.id=e,this.name=t,this.rootClauses=i}return e.prototype.validate=function(){if(!this.rootClauses.length)throw new Error("ResourceRequirement must have at least one root clause.");return!0},e.prototype.addClause=function(e){this.rootClauses.push(e)},e.prototype.removeClause=function(e){this.rootClauses=this.rootClauses.filter((function(t){return t.clauseId!==e}))},e.prototype.toJSON=function(){return{id:this.id,name:this.name,type:this.type,rootClauses:this.rootClauses}},e.createForSingleResource=function(t,i,r,s){void 0===i&&(i={}),void 0===r&&(r="clause-1"),void 0===s&&(s=o.RequirementMode.REQUIRE_ALL);var l="".concat(t.id),c="".concat(t.name),d=a.ResourceRequest.create(t.id,i);return new e(l,c,[new n.RequirementClause(r,s,void 0,[d],[])])},e}();t.ResourceRequirement=s},7853:function(e,t,i){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceRequirementListManager=void 0;var r=i(6861),a=i(3215),s=function(e){function t(){return e.call(this,a.SimulationObjectType.ResourceRequirement)||this}return o(t,e),t}(r.ComponentListManager);t.ResourceRequirementListManager=s},3349:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.RunState=void 0,(i=t.RunState||(t.RunState={})).NotRun="NOT_RUN",i.Running="RUNNING",i.RanWithErrors="RAN_WITH_ERRORS",i.RanSuccessfully="RAN_SUCCESSFULLY"},2305:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},2439:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},3215:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationObjectType=void 0,(i=t.SimulationObjectType||(t.SimulationObjectType={})).Entity="Entity",i.Activity="Activity",i.Connector="Connector",i.Generator="Generator",i.Resource="Resource",i.ResourceRequirement="ResourceRequirement",i.Scenario="Scenario",i.Experiment="Experiment",i.Model="Model",i.None="None"},9181:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationTimeType=void 0,(i=t.SimulationTimeType||(t.SimulationTimeType={})).Clock="Clock",i.CalendarDate="CalendarDate"},3029:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},5836:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.MessageTypes=void 0,(i=t.MessageTypes||(t.MessageTypes={})).REACT_APP_READY="reactAppReady",i.SELECTION_CHANGED_PAGE_NO_MODEL="selectionPageNoModel",i.SELECTION_CHANGED_PAGE_WITH_MODEL="selectionPageWithModel",i.SELECTION_CHANGED_SIMULATION_OBJECT="selectionSimObject",i.SELECTION_CHANGED_MULTIPLE="selectionMultiple",i.SELECTION_CHANGED_UNCONVERTED="selectionUnconverted",i.CONVERT_PAGE="convertPage",i.CONVERSION_ERROR="conversionError",i.GET_ELEMENT_DATA="getElementData",i.UPDATE_ELEMENT_DATA="updateElementData",i.UPDATE_SUCCESS="updateSuccess",i.CONVERT_ELEMENT="convertElement",i.VALIDATE_MODEL="validateModel",i.VALIDATION_RESULT="validationResult",i.ERROR="error",i.REMOVE_MODEL="removeModel",i.MODEL_REMOVED="modelRemoved",i.SIMULATE_MODEL="simulateModel",i.SIMULATION_STARTED="SIMULATION_STARTED",i.SIMULATION_STATUS_UPDATE="SIMULATION_STATUS_UPDATE",i.SIMULATION_STATUS_CHECK="SIMULATION_STATUS_CHECK",i.SIMULATION_STATUS_ERROR="SIMULATION_STATUS_ERROR",i.OUTPUT_CREATE_PAGE="outputCreatePage",i.TREE_STATE_UPDATE="treeStateUpdate",i.TREE_NODE_TOGGLE="treeNodeToggle",i.TREE_NODE_EXPAND_PATH="treeNodeExpandPath",i.TREE_STATE_SYNC="treeStateSync"},9150:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),o(i(3029),t),o(i(5836),t),o(i(5956),t),o(i(4164),t),o(i(6021),t)},8080:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),i(5836)},9617:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},7902:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},821:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),i(5836)},5670:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),i(5836)},18:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),i(5836)},3433:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),i(5836)},2054:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),i(5836)},5956:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),o(i(7902),t),o(i(9617),t),o(i(8080),t),o(i(5670),t),o(i(821),t),o(i(2054),t),o(i(18),t),o(i(3433),t)},6021:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionMessaging=void 0;var i=function(){function e(){this.handlers=new Map}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.createSerializableMessage=function(e,t){return{messagetype:e,data:null!=t?t:null}},e.prototype.handleIncomingMessage=function(e){if(console.log("[ExtensionMessaging] Received incoming message:",e),null==e?void 0:e.messagetype){var t=this.handlers.get(e.messagetype);t?(console.log("[ExtensionMessaging] Found ".concat(t.size," handlers for incoming message type: ").concat(e.messagetype)),t.forEach((function(t){return t(e.data)}))):console.warn("[ExtensionMessaging] No handlers found for incoming message type: ".concat(e.messagetype))}else console.warn("[ExtensionMessaging] Message missing messagetype:",e)},e.prototype.onMessage=function(e,t){var i=this;return this.handlers.has(e)||this.handlers.set(e,new Set),this.handlers.get(e).add(t),function(){var n;null===(n=i.handlers.get(e))||void 0===n||n.delete(t)}},e.prototype.sendMessage=function(e,t){console.log("[ExtensionMessaging] Sending message:",{type:e,payload:t});try{var i=this.handlers.get(e);i&&i.forEach((function(e){return e(t)}));var n=this.createSerializableMessage(e,t);window.parent.postMessage(n,"*"),console.log("[ExtensionMessaging] Message posted to parent window")}catch(e){throw console.error("[ExtensionMessaging] Failed to send message:",e),e}},e}();t.ExtensionMessaging=i},4164:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isValidMessage=void 0;var n=i(5836);t.isValidMessage=function(e){return e&&"object"==typeof e&&"messagetype"in e&&Object.values(n.MessageTypes).includes(e.messagetype)}},9419:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.SimComponentType=void 0,(i=t.SimComponentType||(t.SimComponentType={})).ACTIVITY="activity",i.GENERATOR="generator",i.CONNECTOR="connector",i.MODEL="model",i.ENTITY="entity",i.RESOURCE="resource",i.NONE="none"},321:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},8305:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),o(i(321),t)},1056:function(e,t){var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function s(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}l((n=n.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var i,n,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(s){return function(l){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;r&&(r=0,s[0]&&(a=0)),a;)try{if(i=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{i=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.calculateTableDimensions=t.parseCsvBlob=void 0,t.parseCsvBlob=function(e){return i(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return[4,e.text()];case 1:return[2,t.sent().split("\n").map((function(e){return e.split(",")}))]}}))}))},t.calculateTableDimensions=function(e){var t;return{width:120*((null===(t=e[0])||void 0===t?void 0:t.length)||0)+40,height:30*e.length+40}}},7764:(e,t,i)=>{function n(e,t){return function(){return e.apply(t,arguments)}}const{toString:o}=Object.prototype,{getPrototypeOf:r}=Object,a=(s=Object.create(null),e=>{const t=o.call(e);return s[t]||(s[t]=t.slice(8,-1).toLowerCase())});var s;const l=e=>(e=e.toLowerCase(),t=>a(t)===e),c=e=>t=>typeof t===e,{isArray:d}=Array,u=c("undefined"),p=l("ArrayBuffer"),h=c("string"),g=c("function"),m=c("number"),y=e=>null!==e&&"object"==typeof e,f=e=>{if("object"!==a(e))return!1;const t=r(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},S=l("Date"),E=l("File"),v=l("Blob"),T=l("FileList"),C=l("URLSearchParams"),[b,O,I,D]=["ReadableStream","Request","Response","Headers"].map(l);function M(e,t,{allOwnKeys:i=!1}={}){if(null==e)return;let n,o;if("object"!=typeof e&&(e=[e]),d(e))for(n=0,o=e.length;n<o;n++)t.call(null,e[n],n,e);else{const o=i?Object.getOwnPropertyNames(e):Object.keys(e),r=o.length;let a;for(n=0;n<r;n++)a=o[n],t.call(null,e[a],a,e)}}function P(e,t){t=t.toLowerCase();const i=Object.keys(e);let n,o=i.length;for(;o-- >0;)if(n=i[o],t===n.toLowerCase())return n;return null}const w="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:i.g,_=e=>!u(e)&&e!==w,A=(R="undefined"!=typeof Uint8Array&&r(Uint8Array),e=>R&&e instanceof R);var R;const N=l("HTMLFormElement"),L=(({hasOwnProperty:e})=>(t,i)=>e.call(t,i))(Object.prototype),x=l("RegExp"),k=(e,t)=>{const i=Object.getOwnPropertyDescriptors(e),n={};M(i,((i,o)=>{let r;!1!==(r=t(i,o,e))&&(n[o]=r||i)})),Object.defineProperties(e,n)},F="abcdefghijklmnopqrstuvwxyz",U="0123456789",j={DIGIT:U,ALPHA:F,ALPHA_DIGIT:F+F.toUpperCase()+U},B=l("AsyncFunction"),z=(V="function"==typeof setImmediate,$=g(w.postMessage),V?setImmediate:$?(G=`axios@${Math.random()}`,q=[],w.addEventListener("message",(({source:e,data:t})=>{e===w&&t===G&&q.length&&q.shift()()}),!1),e=>{q.push(e),w.postMessage(G,"*")}):e=>setTimeout(e));var V,$,G,q;const K="undefined"!=typeof queueMicrotask?queueMicrotask.bind(w):"undefined"!=typeof process&&process.nextTick||z;var H={isArray:d,isArrayBuffer:p,isBuffer:function(e){return null!==e&&!u(e)&&null!==e.constructor&&!u(e.constructor)&&g(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||g(e.append)&&("formdata"===(t=a(e))||"object"===t&&g(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&p(e.buffer),t},isString:h,isNumber:m,isBoolean:e=>!0===e||!1===e,isObject:y,isPlainObject:f,isReadableStream:b,isRequest:O,isResponse:I,isHeaders:D,isUndefined:u,isDate:S,isFile:E,isBlob:v,isRegExp:x,isFunction:g,isStream:e=>y(e)&&g(e.pipe),isURLSearchParams:C,isTypedArray:A,isFileList:T,forEach:M,merge:function e(){const{caseless:t}=_(this)&&this||{},i={},n=(n,o)=>{const r=t&&P(i,o)||o;f(i[r])&&f(n)?i[r]=e(i[r],n):f(n)?i[r]=e({},n):d(n)?i[r]=n.slice():i[r]=n};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&M(arguments[e],n);return i},extend:(e,t,i,{allOwnKeys:o}={})=>(M(t,((t,o)=>{i&&g(t)?e[o]=n(t,i):e[o]=t}),{allOwnKeys:o}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,i,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,t,i,n)=>{let o,a,s;const l={};if(t=t||{},null==e)return t;do{for(o=Object.getOwnPropertyNames(e),a=o.length;a-- >0;)s=o[a],n&&!n(s,e,t)||l[s]||(t[s]=e[s],l[s]=!0);e=!1!==i&&r(e)}while(e&&(!i||i(e,t))&&e!==Object.prototype);return t},kindOf:a,kindOfTest:l,endsWith:(e,t,i)=>{e=String(e),(void 0===i||i>e.length)&&(i=e.length),i-=t.length;const n=e.indexOf(t,i);return-1!==n&&n===i},toArray:e=>{if(!e)return null;if(d(e))return e;let t=e.length;if(!m(t))return null;const i=new Array(t);for(;t-- >0;)i[t]=e[t];return i},forEachEntry:(e,t)=>{const i=(e&&e[Symbol.iterator]).call(e);let n;for(;(n=i.next())&&!n.done;){const i=n.value;t.call(e,i[0],i[1])}},matchAll:(e,t)=>{let i;const n=[];for(;null!==(i=e.exec(t));)n.push(i);return n},isHTMLForm:N,hasOwnProperty:L,hasOwnProp:L,reduceDescriptors:k,freezeMethods:e=>{k(e,((t,i)=>{if(g(e)&&-1!==["arguments","caller","callee"].indexOf(i))return!1;const n=e[i];g(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))}))},toObjectSet:(e,t)=>{const i={},n=e=>{e.forEach((e=>{i[e]=!0}))};return d(e)?n(e):n(String(e).split(t)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,i){return t.toUpperCase()+i})),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:P,global:w,isContextDefined:_,ALPHABET:j,generateString:(e=16,t=j.ALPHA_DIGIT)=>{let i="";const{length:n}=t;for(;e--;)i+=t[Math.random()*n|0];return i},isSpecCompliantForm:function(e){return!!(e&&g(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),i=(e,n)=>{if(y(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;const o=d(e)?[]:{};return M(e,((e,t)=>{const r=i(e,n+1);!u(r)&&(o[t]=r)})),t[n]=void 0,o}}return e};return i(e,0)},isAsyncFn:B,isThenable:e=>e&&(y(e)||g(e))&&g(e.then)&&g(e.catch),setImmediate:z,asap:K};function W(e,t,i,n,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),i&&(this.config=i),n&&(this.request=n),o&&(this.response=o,this.status=o.status?o.status:null)}H.inherits(W,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:H.toJSONObject(this.config),code:this.code,status:this.status}}});const X=W.prototype,Y={};function J(e){return H.isPlainObject(e)||H.isArray(e)}function Q(e){return H.endsWith(e,"[]")?e.slice(0,-2):e}function Z(e,t,i){return e?e.concat(t).map((function(e,t){return e=Q(e),!i&&t?"["+e+"]":e})).join(i?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{Y[e]={value:e}})),Object.defineProperties(W,Y),Object.defineProperty(X,"isAxiosError",{value:!0}),W.from=(e,t,i,n,o,r)=>{const a=Object.create(X);return H.toFlatObject(e,a,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),W.call(a,e.message,t,i,n,o),a.cause=e,a.name=e.name,r&&Object.assign(a,r),a};const ee=H.toFlatObject(H,{},null,(function(e){return/^is[A-Z]/.test(e)}));function te(e,t,i){if(!H.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(i=H.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!H.isUndefined(t[e])}))).metaTokens,o=i.visitor||c,r=i.dots,a=i.indexes,s=(i.Blob||"undefined"!=typeof Blob&&Blob)&&H.isSpecCompliantForm(t);if(!H.isFunction(o))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(H.isDate(e))return e.toISOString();if(!s&&H.isBlob(e))throw new W("Blob is not supported. Use a Buffer instead.");return H.isArrayBuffer(e)||H.isTypedArray(e)?s&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,i,o){let s=e;if(e&&!o&&"object"==typeof e)if(H.endsWith(i,"{}"))i=n?i:i.slice(0,-2),e=JSON.stringify(e);else if(H.isArray(e)&&function(e){return H.isArray(e)&&!e.some(J)}(e)||(H.isFileList(e)||H.endsWith(i,"[]"))&&(s=H.toArray(e)))return i=Q(i),s.forEach((function(e,n){!H.isUndefined(e)&&null!==e&&t.append(!0===a?Z([i],n,r):null===a?i:i+"[]",l(e))})),!1;return!!J(e)||(t.append(Z(o,i,r),l(e)),!1)}const d=[],u=Object.assign(ee,{defaultVisitor:c,convertValue:l,isVisitable:J});if(!H.isObject(e))throw new TypeError("data must be an object");return function e(i,n){if(!H.isUndefined(i)){if(-1!==d.indexOf(i))throw Error("Circular reference detected in "+n.join("."));d.push(i),H.forEach(i,(function(i,r){!0===(!(H.isUndefined(i)||null===i)&&o.call(t,i,H.isString(r)?r.trim():r,n,u))&&e(i,n?n.concat(r):[r])})),d.pop()}}(e),t}function ie(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function ne(e,t){this._pairs=[],e&&te(e,this,t)}const oe=ne.prototype;function re(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ae(e,t,i){if(!t)return e;const n=i&&i.encode||re;H.isFunction(i)&&(i={serialize:i});const o=i&&i.serialize;let r;if(r=o?o(t,i):H.isURLSearchParams(t)?t.toString():new ne(t,i).toString(n),r){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e}oe.append=function(e,t){this._pairs.push([e,t])},oe.toString=function(e){const t=e?function(t){return e.call(this,t,ie)}:ie;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};var se=class{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){H.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},le={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ce={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:ne,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]};const de="undefined"!=typeof window&&"undefined"!=typeof document,ue="object"==typeof navigator&&navigator||void 0,pe=de&&(!ue||["ReactNative","NativeScript","NS"].indexOf(ue.product)<0),he="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,ge=de&&window.location.href||"http://localhost";var me={...Object.freeze({__proto__:null,hasBrowserEnv:de,hasStandardBrowserWebWorkerEnv:he,hasStandardBrowserEnv:pe,navigator:ue,origin:ge}),...ce};function ye(e){function t(e,i,n,o){let r=e[o++];if("__proto__"===r)return!0;const a=Number.isFinite(+r),s=o>=e.length;return r=!r&&H.isArray(n)?n.length:r,s?(H.hasOwnProp(n,r)?n[r]=[n[r],i]:n[r]=i,!a):(n[r]&&H.isObject(n[r])||(n[r]=[]),t(e,i,n[r],o)&&H.isArray(n[r])&&(n[r]=function(e){const t={},i=Object.keys(e);let n;const o=i.length;let r;for(n=0;n<o;n++)r=i[n],t[r]=e[r];return t}(n[r])),!a)}if(H.isFormData(e)&&H.isFunction(e.entries)){const i={};return H.forEachEntry(e,((e,n)=>{t(function(e){return H.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),n,i,0)})),i}return null}const fe={transitional:le,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const i=t.getContentType()||"",n=i.indexOf("application/json")>-1,o=H.isObject(e);if(o&&H.isHTMLForm(e)&&(e=new FormData(e)),H.isFormData(e))return n?JSON.stringify(ye(e)):e;if(H.isArrayBuffer(e)||H.isBuffer(e)||H.isStream(e)||H.isFile(e)||H.isBlob(e)||H.isReadableStream(e))return e;if(H.isArrayBufferView(e))return e.buffer;if(H.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let r;if(o){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return te(e,new me.classes.URLSearchParams,Object.assign({visitor:function(e,t,i,n){return me.isNode&&H.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((r=H.isFileList(e))||i.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return te(r?{"files[]":e}:e,t&&new t,this.formSerializer)}}return o||n?(t.setContentType("application/json",!1),function(e,t,i){if(H.isString(e))try{return(0,JSON.parse)(e),H.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||fe.transitional,i=t&&t.forcedJSONParsing,n="json"===this.responseType;if(H.isResponse(e)||H.isReadableStream(e))return e;if(e&&H.isString(e)&&(i&&!this.responseType||n)){const i=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw W.from(e,W.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:me.classes.FormData,Blob:me.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};H.forEach(["delete","get","head","post","put","patch"],(e=>{fe.headers[e]={}}));var Se=fe;const Ee=H.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ve=Symbol("internals");function Te(e){return e&&String(e).trim().toLowerCase()}function Ce(e){return!1===e||null==e?e:H.isArray(e)?e.map(Ce):String(e)}function be(e,t,i,n,o){return H.isFunction(n)?n.call(this,t,i):(o&&(t=i),H.isString(t)?H.isString(n)?-1!==t.indexOf(n):H.isRegExp(n)?n.test(t):void 0:void 0)}class Oe{constructor(e){e&&this.set(e)}set(e,t,i){const n=this;function o(e,t,i){const o=Te(t);if(!o)throw new Error("header name must be a non-empty string");const r=H.findKey(n,o);(!r||void 0===n[r]||!0===i||void 0===i&&!1!==n[r])&&(n[r||t]=Ce(e))}const r=(e,t)=>H.forEach(e,((e,i)=>o(e,i,t)));if(H.isPlainObject(e)||e instanceof this.constructor)r(e,t);else if(H.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))r((e=>{const t={};let i,n,o;return e&&e.split("\n").forEach((function(e){o=e.indexOf(":"),i=e.substring(0,o).trim().toLowerCase(),n=e.substring(o+1).trim(),!i||t[i]&&Ee[i]||("set-cookie"===i?t[i]?t[i].push(n):t[i]=[n]:t[i]=t[i]?t[i]+", "+n:n)})),t})(e),t);else if(H.isHeaders(e))for(const[t,n]of e.entries())o(n,t,i);else null!=e&&o(t,e,i);return this}get(e,t){if(e=Te(e)){const i=H.findKey(this,e);if(i){const e=this[i];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=i.exec(e);)t[n[1]]=n[2];return t}(e);if(H.isFunction(t))return t.call(this,e,i);if(H.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Te(e)){const i=H.findKey(this,e);return!(!i||void 0===this[i]||t&&!be(0,this[i],i,t))}return!1}delete(e,t){const i=this;let n=!1;function o(e){if(e=Te(e)){const o=H.findKey(i,e);!o||t&&!be(0,i[o],o,t)||(delete i[o],n=!0)}}return H.isArray(e)?e.forEach(o):o(e),n}clear(e){const t=Object.keys(this);let i=t.length,n=!1;for(;i--;){const o=t[i];e&&!be(0,this[o],o,e,!0)||(delete this[o],n=!0)}return n}normalize(e){const t=this,i={};return H.forEach(this,((n,o)=>{const r=H.findKey(i,o);if(r)return t[r]=Ce(n),void delete t[o];const a=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,i)=>t.toUpperCase()+i))}(o):String(o).trim();a!==o&&delete t[o],t[a]=Ce(n),i[a]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return H.forEach(this,((i,n)=>{null!=i&&!1!==i&&(t[n]=e&&H.isArray(i)?i.join(", "):i)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const i=new this(e);return t.forEach((e=>i.set(e))),i}static accessor(e){const t=(this[ve]=this[ve]={accessors:{}}).accessors,i=this.prototype;function n(e){const n=Te(e);t[n]||(function(e,t){const i=H.toCamelCase(" "+t);["get","set","has"].forEach((n=>{Object.defineProperty(e,n+i,{value:function(e,i,o){return this[n].call(this,t,e,i,o)},configurable:!0})}))}(i,e),t[n]=!0)}return H.isArray(e)?e.forEach(n):n(e),this}}Oe.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),H.reduceDescriptors(Oe.prototype,(({value:e},t)=>{let i=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[i]=e}}})),H.freezeMethods(Oe);var Ie=Oe;function De(e,t){const i=this||Se,n=t||i,o=Ie.from(n.headers);let r=n.data;return H.forEach(e,(function(e){r=e.call(i,r,o.normalize(),t?t.status:void 0)})),o.normalize(),r}function Me(e){return!(!e||!e.__CANCEL__)}function Pe(e,t,i){W.call(this,null==e?"canceled":e,W.ERR_CANCELED,t,i),this.name="CanceledError"}function we(e,t,i){const n=i.config.validateStatus;i.status&&n&&!n(i.status)?t(new W("Request failed with status code "+i.status,[W.ERR_BAD_REQUEST,W.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}H.inherits(Pe,W,{__CANCEL__:!0});const _e=(e,t,i=3)=>{let n=0;const o=function(e,t){e=e||10;const i=new Array(e),n=new Array(e);let o,r=0,a=0;return t=void 0!==t?t:1e3,function(s){const l=Date.now(),c=n[a];o||(o=l),i[r]=s,n[r]=l;let d=a,u=0;for(;d!==r;)u+=i[d++],d%=e;if(r=(r+1)%e,r===a&&(a=(a+1)%e),l-o<t)return;const p=c&&l-c;return p?Math.round(1e3*u/p):void 0}}(50,250);return function(e,t){let i,n,o=0,r=1e3/t;const a=(t,r=Date.now())=>{o=r,i=null,n&&(clearTimeout(n),n=null),e.apply(null,t)};return[(...e)=>{const t=Date.now(),s=t-o;s>=r?a(e,t):(i=e,n||(n=setTimeout((()=>{n=null,a(i)}),r-s)))},()=>i&&a(i)]}((i=>{const r=i.loaded,a=i.lengthComputable?i.total:void 0,s=r-n,l=o(s);n=r,e({loaded:r,total:a,progress:a?r/a:void 0,bytes:s,rate:l||void 0,estimated:l&&a&&r<=a?(a-r)/l:void 0,event:i,lengthComputable:null!=a,[t?"download":"upload"]:!0})}),i)},Ae=(e,t)=>{const i=null!=e;return[n=>t[0]({lengthComputable:i,total:e,loaded:n}),t[1]]},Re=e=>(...t)=>H.asap((()=>e(...t)));var Ne=me.hasStandardBrowserEnv?((e,t)=>i=>(i=new URL(i,me.origin),e.protocol===i.protocol&&e.host===i.host&&(t||e.port===i.port)))(new URL(me.origin),me.navigator&&/(msie|trident)/i.test(me.navigator.userAgent)):()=>!0,Le=me.hasStandardBrowserEnv?{write(e,t,i,n,o,r){const a=[e+"="+encodeURIComponent(t)];H.isNumber(i)&&a.push("expires="+new Date(i).toGMTString()),H.isString(n)&&a.push("path="+n),H.isString(o)&&a.push("domain="+o),!0===r&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function xe(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const ke=e=>e instanceof Ie?{...e}:e;function Fe(e,t){t=t||{};const i={};function n(e,t,i,n){return H.isPlainObject(e)&&H.isPlainObject(t)?H.merge.call({caseless:n},e,t):H.isPlainObject(t)?H.merge({},t):H.isArray(t)?t.slice():t}function o(e,t,i,o){return H.isUndefined(t)?H.isUndefined(e)?void 0:n(void 0,e,0,o):n(e,t,0,o)}function r(e,t){if(!H.isUndefined(t))return n(void 0,t)}function a(e,t){return H.isUndefined(t)?H.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function s(i,o,r){return r in t?n(i,o):r in e?n(void 0,i):void 0}const l={url:r,method:r,data:r,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s,headers:(e,t,i)=>o(ke(e),ke(t),0,!0)};return H.forEach(Object.keys(Object.assign({},e,t)),(function(n){const r=l[n]||o,a=r(e[n],t[n],n);H.isUndefined(a)&&r!==s||(i[n]=a)})),i}var Ue=e=>{const t=Fe({},e);let i,{data:n,withXSRFToken:o,xsrfHeaderName:r,xsrfCookieName:a,headers:s,auth:l}=t;if(t.headers=s=Ie.from(s),t.url=ae(xe(t.baseURL,t.url),e.params,e.paramsSerializer),l&&s.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),H.isFormData(n))if(me.hasStandardBrowserEnv||me.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(!1!==(i=s.getContentType())){const[e,...t]=i?i.split(";").map((e=>e.trim())).filter(Boolean):[];s.setContentType([e||"multipart/form-data",...t].join("; "))}if(me.hasStandardBrowserEnv&&(o&&H.isFunction(o)&&(o=o(t)),o||!1!==o&&Ne(t.url))){const e=r&&a&&Le.read(a);e&&s.set(r,e)}return t},je="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,i){const n=Ue(e);let o=n.data;const r=Ie.from(n.headers).normalize();let a,s,l,c,d,{responseType:u,onUploadProgress:p,onDownloadProgress:h}=n;function g(){c&&c(),d&&d(),n.cancelToken&&n.cancelToken.unsubscribe(a),n.signal&&n.signal.removeEventListener("abort",a)}let m=new XMLHttpRequest;function y(){if(!m)return;const n=Ie.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders());we((function(e){t(e),g()}),(function(e){i(e),g()}),{data:u&&"text"!==u&&"json"!==u?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:n,config:e,request:m}),m=null}m.open(n.method.toUpperCase(),n.url,!0),m.timeout=n.timeout,"onloadend"in m?m.onloadend=y:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(y)},m.onabort=function(){m&&(i(new W("Request aborted",W.ECONNABORTED,e,m)),m=null)},m.onerror=function(){i(new W("Network Error",W.ERR_NETWORK,e,m)),m=null},m.ontimeout=function(){let t=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const o=n.transitional||le;n.timeoutErrorMessage&&(t=n.timeoutErrorMessage),i(new W(t,o.clarifyTimeoutError?W.ETIMEDOUT:W.ECONNABORTED,e,m)),m=null},void 0===o&&r.setContentType(null),"setRequestHeader"in m&&H.forEach(r.toJSON(),(function(e,t){m.setRequestHeader(t,e)})),H.isUndefined(n.withCredentials)||(m.withCredentials=!!n.withCredentials),u&&"json"!==u&&(m.responseType=n.responseType),h&&([l,d]=_e(h,!0),m.addEventListener("progress",l)),p&&m.upload&&([s,c]=_e(p),m.upload.addEventListener("progress",s),m.upload.addEventListener("loadend",c)),(n.cancelToken||n.signal)&&(a=t=>{m&&(i(!t||t.type?new Pe(null,e,m):t),m.abort(),m=null)},n.cancelToken&&n.cancelToken.subscribe(a),n.signal&&(n.signal.aborted?a():n.signal.addEventListener("abort",a)));const f=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(n.url);f&&-1===me.protocols.indexOf(f)?i(new W("Unsupported protocol "+f+":",W.ERR_BAD_REQUEST,e)):m.send(o||null)}))},Be=(e,t)=>{const{length:i}=e=e?e.filter(Boolean):[];if(t||i){let i,n=new AbortController;const o=function(e){if(!i){i=!0,a();const t=e instanceof Error?e:this.reason;n.abort(t instanceof W?t:new Pe(t instanceof Error?t.message:t))}};let r=t&&setTimeout((()=>{r=null,o(new W(`timeout ${t} of ms exceeded`,W.ETIMEDOUT))}),t);const a=()=>{e&&(r&&clearTimeout(r),r=null,e.forEach((e=>{e.unsubscribe?e.unsubscribe(o):e.removeEventListener("abort",o)})),e=null)};e.forEach((e=>e.addEventListener("abort",o)));const{signal:s}=n;return s.unsubscribe=()=>H.asap(a),s}};const ze=function*(e,t){let i=e.byteLength;if(!t||i<t)return void(yield e);let n,o=0;for(;o<i;)n=o+t,yield e.slice(o,n),o=n},Ve=(e,t,i,n)=>{const o=async function*(e,t){for await(const i of async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:i}=await t.read();if(e)break;yield i}}finally{await t.cancel()}}(e))yield*ze(i,t)}(e,t);let r,a=0,s=e=>{r||(r=!0,n&&n(e))};return new ReadableStream({async pull(e){try{const{done:t,value:n}=await o.next();if(t)return s(),void e.close();let r=n.byteLength;if(i){let e=a+=r;i(e)}e.enqueue(new Uint8Array(n))}catch(e){throw s(e),e}},cancel:e=>(s(e),o.return())},{highWaterMark:2})},$e="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,Ge=$e&&"function"==typeof ReadableStream,qe=$e&&("function"==typeof TextEncoder?(Ke=new TextEncoder,e=>Ke.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var Ke;const He=(e,...t)=>{try{return!!e(...t)}catch(e){return!1}},We=Ge&&He((()=>{let e=!1;const t=new Request(me.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),Xe=Ge&&He((()=>H.isReadableStream(new Response("").body))),Ye={stream:Xe&&(e=>e.body)};var Je;$e&&(Je=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!Ye[e]&&(Ye[e]=H.isFunction(Je[e])?t=>t[e]():(t,i)=>{throw new W(`Response type '${e}' is not supported`,W.ERR_NOT_SUPPORT,i)})})));const Qe={http:null,xhr:je,fetch:$e&&(async e=>{let{url:t,method:i,data:n,signal:o,cancelToken:r,timeout:a,onDownloadProgress:s,onUploadProgress:l,responseType:c,headers:d,withCredentials:u="same-origin",fetchOptions:p}=Ue(e);c=c?(c+"").toLowerCase():"text";let h,g=Be([o,r&&r.toAbortSignal()],a);const m=g&&g.unsubscribe&&(()=>{g.unsubscribe()});let y;try{if(l&&We&&"get"!==i&&"head"!==i&&0!==(y=await(async(e,t)=>{const i=H.toFiniteNumber(e.getContentLength());return null==i?(async e=>{if(null==e)return 0;if(H.isBlob(e))return e.size;if(H.isSpecCompliantForm(e)){const t=new Request(me.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return H.isArrayBufferView(e)||H.isArrayBuffer(e)?e.byteLength:(H.isURLSearchParams(e)&&(e+=""),H.isString(e)?(await qe(e)).byteLength:void 0)})(t):i})(d,n))){let e,i=new Request(t,{method:"POST",body:n,duplex:"half"});if(H.isFormData(n)&&(e=i.headers.get("content-type"))&&d.setContentType(e),i.body){const[e,t]=Ae(y,_e(Re(l)));n=Ve(i.body,65536,e,t)}}H.isString(u)||(u=u?"include":"omit");const o="credentials"in Request.prototype;h=new Request(t,{...p,signal:g,method:i.toUpperCase(),headers:d.normalize().toJSON(),body:n,duplex:"half",credentials:o?u:void 0});let r=await fetch(h);const a=Xe&&("stream"===c||"response"===c);if(Xe&&(s||a&&m)){const e={};["status","statusText","headers"].forEach((t=>{e[t]=r[t]}));const t=H.toFiniteNumber(r.headers.get("content-length")),[i,n]=s&&Ae(t,_e(Re(s),!0))||[];r=new Response(Ve(r.body,65536,i,(()=>{n&&n(),m&&m()})),e)}c=c||"text";let f=await Ye[H.findKey(Ye,c)||"text"](r,e);return!a&&m&&m(),await new Promise(((t,i)=>{we(t,i,{data:f,headers:Ie.from(r.headers),status:r.status,statusText:r.statusText,config:e,request:h})}))}catch(t){if(m&&m(),t&&"TypeError"===t.name&&/fetch/i.test(t.message))throw Object.assign(new W("Network Error",W.ERR_NETWORK,e,h),{cause:t.cause||t});throw W.from(t,t&&t.code,e,h)}})};H.forEach(Qe,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));const Ze=e=>`- ${e}`,et=e=>H.isFunction(e)||null===e||!1===e;var tt=e=>{e=H.isArray(e)?e:[e];const{length:t}=e;let i,n;const o={};for(let r=0;r<t;r++){let t;if(i=e[r],n=i,!et(i)&&(n=Qe[(t=String(i)).toLowerCase()],void 0===n))throw new W(`Unknown adapter '${t}'`);if(n)break;o[t||"#"+r]=n}if(!n){const e=Object.entries(o).map((([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build")));throw new W("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(Ze).join("\n"):" "+Ze(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n};function it(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Pe(null,e)}function nt(e){return it(e),e.headers=Ie.from(e.headers),e.data=De.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),tt(e.adapter||Se.adapter)(e).then((function(t){return it(e),t.data=De.call(e,e.transformResponse,t),t.headers=Ie.from(t.headers),t}),(function(t){return Me(t)||(it(e),t&&t.response&&(t.response.data=De.call(e,e.transformResponse,t.response),t.response.headers=Ie.from(t.response.headers))),Promise.reject(t)}))}const ot={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{ot[e]=function(i){return typeof i===e||"a"+(t<1?"n ":" ")+e}}));const rt={};ot.transitional=function(e,t,i){function n(e,t){return"[Axios v1.7.9] Transitional option '"+e+"'"+t+(i?". "+i:"")}return(i,o,r)=>{if(!1===e)throw new W(n(o," has been removed"+(t?" in "+t:"")),W.ERR_DEPRECATED);return t&&!rt[o]&&(rt[o]=!0,console.warn(n(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,o,r)}},ot.spelling=function(e){return(t,i)=>(console.warn(`${i} is likely a misspelling of ${e}`),!0)};var at={assertOptions:function(e,t,i){if("object"!=typeof e)throw new W("options must be an object",W.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let o=n.length;for(;o-- >0;){const r=n[o],a=t[r];if(a){const t=e[r],i=void 0===t||a(t,r,e);if(!0!==i)throw new W("option "+r+" must be "+i,W.ERR_BAD_OPTION_VALUE)}else if(!0!==i)throw new W("Unknown option "+r,W.ERR_BAD_OPTION)}},validators:ot};const st=at.validators;class lt{constructor(e){this.defaults=e,this.interceptors={request:new se,response:new se}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=new Error;const i=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?i&&!String(e.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+i):e.stack=i}catch(e){}}throw e}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Fe(this.defaults,t);const{transitional:i,paramsSerializer:n,headers:o}=t;void 0!==i&&at.assertOptions(i,{silentJSONParsing:st.transitional(st.boolean),forcedJSONParsing:st.transitional(st.boolean),clarifyTimeoutError:st.transitional(st.boolean)},!1),null!=n&&(H.isFunction(n)?t.paramsSerializer={serialize:n}:at.assertOptions(n,{encode:st.function,serialize:st.function},!0)),at.assertOptions(t,{baseUrl:st.spelling("baseURL"),withXsrfToken:st.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let r=o&&H.merge(o.common,o[t.method]);o&&H.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete o[e]})),t.headers=Ie.concat(r,o);const a=[];let s=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,a.unshift(e.fulfilled,e.rejected))}));const l=[];let c;this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)}));let d,u=0;if(!s){const e=[nt.bind(this),void 0];for(e.unshift.apply(e,a),e.push.apply(e,l),d=e.length,c=Promise.resolve(t);u<d;)c=c.then(e[u++],e[u++]);return c}d=a.length;let p=t;for(u=0;u<d;){const e=a[u++],t=a[u++];try{p=e(p)}catch(e){t.call(this,e);break}}try{c=nt.call(this,p)}catch(e){return Promise.reject(e)}for(u=0,d=l.length;u<d;)c=c.then(l[u++],l[u++]);return c}getUri(e){return ae(xe((e=Fe(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}H.forEach(["delete","get","head","options"],(function(e){lt.prototype[e]=function(t,i){return this.request(Fe(i||{},{method:e,url:t,data:(i||{}).data}))}})),H.forEach(["post","put","patch"],(function(e){function t(t){return function(i,n,o){return this.request(Fe(o||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:i,data:n}))}}lt.prototype[e]=t(),lt.prototype[e+"Form"]=t(!0)}));var ct=lt;class dt{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const i=this;this.promise.then((e=>{if(!i._listeners)return;let t=i._listeners.length;for(;t-- >0;)i._listeners[t](e);i._listeners=null})),this.promise.then=e=>{let t;const n=new Promise((e=>{i.subscribe(e),t=e})).then(e);return n.cancel=function(){i.unsubscribe(t)},n},e((function(e,n,o){i.reason||(i.reason=new Pe(e,n,o),t(i.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new dt((function(t){e=t})),cancel:e}}}var ut=dt;const pt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(pt).forEach((([e,t])=>{pt[t]=e}));var ht=pt;const gt=function e(t){const i=new ct(t),o=n(ct.prototype.request,i);return H.extend(o,ct.prototype,i,{allOwnKeys:!0}),H.extend(o,i,null,{allOwnKeys:!0}),o.create=function(i){return e(Fe(t,i))},o}(Se);gt.Axios=ct,gt.CanceledError=Pe,gt.CancelToken=ut,gt.isCancel=Me,gt.VERSION="1.7.9",gt.toFormData=te,gt.AxiosError=W,gt.Cancel=gt.CanceledError,gt.all=function(e){return Promise.all(e)},gt.spread=function(e){return function(t){return e.apply(null,t)}},gt.isAxiosError=function(e){return H.isObject(e)&&!0===e.isAxiosError},gt.mergeConfig=Fe,gt.AxiosHeaders=Ie,gt.formToJSON=e=>ye(H.isHTMLForm(e)?new FormData(e):e),gt.getAdapter=tt,gt.HttpStatusCode=ht,gt.default=gt,e.exports=gt}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,i),r.exports}i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{const e=i(8966),t=i(3019),n=i(5686),o=i(7923),r=new e.EditorClient,a=new e.Viewport(r),s=new o.StorageAdapter,l=new t.ModelManager(s);console.info("[extension] About to create ModelPanel");const c=new n.ModelPanel(r,l);c.setLogging(!0),console.info("[extension] Created ModelPanel2"),a.hookSelection((e=>{c.handleSelectionChange(e)}));const d=new e.Menu(r);r.registerAction("import",(async()=>{await r.oauthXhr("lucid",{url:"https://api.lucid.co/folders/search",headers:{"Lucid-Api-Version":"1","Content-Type":"application/json"},data:"{}",method:"POST"});const e=await r.performDataAction({dataConnectorName:"data-connector-1",actionName:"Import",actionData:{message:"ImportFolders"},asynchronous:!0});console.log(e)})),d.addMenuItem({label:"Import",action:"import",menuType:e.MenuType.Main})})()})();